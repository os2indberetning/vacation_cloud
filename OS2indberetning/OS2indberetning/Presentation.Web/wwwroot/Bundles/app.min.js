var __extends,app;(function(){"use strict";var n={preprocess:function(n){return moment.unix(n)},timezone:"Europe/Copenhagen"};angular.module("app",["kendo.directives","ui.router","ui.bootstrap","ui.bootstrap.tooltip","ngResource","angularMoment","cgBusy","app.core","app.drive","app.vacation"]).config(["cfpLoadingBarProvider",function(n){n.includeSpinner=!1}]).run(["Person","$rootScope","HelpText","$state","$stateParams","Authorization","Principal",function(n,t,i,r,u,f,e){t.hasAccess=!0;t.HelpTexts==undefined&&i.getAll().$promise.then(function(n){t.helpLink=n.InformationHelpLink;t.HelpTexts=n});t.$on("$stateChangeStart",function(n,i,r){t.toState=i;t.toStateParams=r;e.isIdentityResolved()&&f.authorize()})}]).constant("moment",moment).constant("angularMomentConfig",n).value("cgBusyDefaults",{message:"Vent venligst..",backdrop:!0,templateUrl:"template/loading-template.html",delay:100,minDuration:700})})(app||(app={})),function(n){"use strict";var t=function(){function n(){}return n.init=function(n,t){n.state("default",{url:"/",templateUrl:"/App/app.html",resolve:{authorize:["Authorization",function(n){return n.authorize()}]}});n.state("drive",{url:"/drive",templateUrl:"/App/Drive/app.drive.html",abstract:!0,resolve:{authorize:["Authorization",function(n){return n.authorize()}]}});n.state("vacation",{url:"/vacation",templateUrl:"/App/Vacation/app.vacation.html",abstract:!0,resolve:{authorize:["Authorization",function(n){return n.authorize()}]}});t.when("/drive","/drive/driving");t.when("/vacation","/vacation/report");t.otherwise("/");t.rule(function(n,t){var i=t.path(),r=i[i.length-1]==="/";return r?i.substr(0,i.length-1):i})},n.$inject=["$stateProvider","$urlRouterProvider"],n}();n.routes=t;angular.module("app").config(t.init)}(app||(app={}));angular.module("app.core",["kendo.directives","app.drive","app.vacation","ui.router","ui.bootstrap","ui.bootstrap.tooltip","ngResource","template/modal/window.html","template/modal/window.html","template/modal/backdrop.html","template/tabs/tab.html","template/tabs/tabset.html","angularMoment","template/popover/popover.html","kendo-ie-fix","angular-loading-bar"]);angular.module("app.core").controller("AddNewMailNotificationController",["$scope","$modalInstance","NotificationService","StandardAddress","AddressFormatter","SmartAdresseSource",function(n,t,i){n.repeatMonthly="";n.dateOptions={format:"dd/MM/yyyy"};n.notificationDate=new Date;n.confirmSave=function(){var u=!1,r;n.repeatErrorMessage="";n.repeatMonthly==""&&(u=!0,n.repeatErrorMessage="* Du skal udfylde 'Gentag månedligt'.");n.dateErrorMessage="";n.notificationDate==undefined&&(u=!0,n.dateErrorMessage="* Du skal vælge en gyldig adviseringsdato.");n.payDateErrorMessage="";n.payRoleDate==undefined&&(u=!0,n.payDateErrorMessage="* Du skal vælge en gyldig lønkørselsdato.");r={};r.repeatMonthly=n.repeatMonthly=="true"?!0:!1;r.notificationDate=moment(n.notificationDate).unix();r.payDate=moment(n.payRoleDate).unix();u||(t.close(r),i.AutoFadeNotification("success","","Email-adviseringen blev oprettet."))};n.cancel=function(){t.dismiss("cancel");i.AutoFadeNotification("warning","","Oprettelse af email adviseringen blev annulleret.")}}]);angular.module("app.core").controller("AdminNewSubstituteModalInstanceController",["$scope","$modalInstance","OrgUnit","leader","Substitute","Person","NotificationService","$timeout","persons","Autocomplete","leader","ReportType",function(n,t,i,r,u,f,e,o,s,h,r,c){n.persons=s;n.loadingPromise=null;var l=9999999999;n.autoCompleteOptions={filter:"contains"};n.leaders=h.leaders();n.substituteFromDate=new Date;n.substituteToDate=new Date;n.orgUnits=h.orgUnitsThatHaveALeader();n.clearSelections=function(){n.personFor=[];n.personForString="";n.orgUnits=h.orgUnitsThatHaveALeader();n.orgUnit={LongDescription:"Nope",Id:""}};n.orgUnitOptions={filter:"contains",select:function(){o(function(){i.getLeaderOfOrg({id:n.orgUnit.Id},function(t){n.personForString=t.FullName;n.personFor=[];n.personFor.push(t)})},0)}};n.personForOptions={filter:"contains",select:function(){o(function(){i.getWhereUserIsLeader({id:n.personFor[0].Id},function(t){n.orgUnits=t;n.orgUnits.length>0&&(n.orgUnit=n.orgUnits[0])})},0)}};n.saveNewSubstitute=function(){if(n.person==undefined){e.AutoFadeNotification("danger","","Du skal vælge en stedfortræder");return}if(n.personFor==undefined){e.AutoFadeNotification("danger","","Du skal vælge en person der skal stedfortrædes for");return}if(n.orgUnit==undefined){e.AutoFadeNotification("danger","","Du skal vælge en organisationsenhed.");return}var i=new u({StartDateTimestamp:Math.floor(n.substituteFromDate.getTime()/1e3),EndDateTimestamp:Math.floor(n.substituteToDate.getTime()/1e3),LeaderId:n.personFor[0].Id,SubId:n.person[0].Id,OrgUnitId:n.orgUnit.Id,PersonId:n.personFor[0].Id,CreatedById:r.Id,Type:c===0?"Drive":"Vacation"});n.infinitePeriod&&(i.EndDateTimestamp=l);n.showSpinner=!0;n.loadingPromise=i.$post(function(){e.AutoFadeNotification("success","","Stedfortræder blev oprettet");t.close()},function(){e.AutoFadeNotification("danger","","Kunne ikke oprette stedfortræder (Du kan ikke oprette 2 stedfortrædere for samme organisation i samme periode)");n.showSpinner=!1})};n.cancelNewSubstitute=function(){t.dismiss("cancel")}}]),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(n,t,i,r,u,f,e){var o=this;this.$scope=n;this.Person=t;this.$rootScope=i;this.Autocomplete=r;this.$modal=u;this.moment=f;this.reportType=e;this.infinitePeriod=9999999999;this.isGridLoaded=!1;this.collapseSubstitute=!1;this.collapsePersonalApprover=!1;this.orgUnits=[];this.people=[];this.currentPerson={};this.substituteOrgUnit="";this.personalApproverHelpText=i.HelpTexts.PersonalApproverHelpText.text;this.personId=i.CurrentUser.Id;this.currentPerson=i.CurrentUser;this.people=r.activeUsers();this.orgUnits=r.orgUnits();this.showSubstituteSettings=i.CurrentUser.IsLeader;this.substitutes={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"odata/Substitutes/Service.Substitute(Type="+this.reportType+")?$expand=OrgUnit,Sub,Person,Leader &$filter=PersonId eq "+this.personId,dataType:"json",cache:!1}},pageSize:20},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} ",empty:"Ingen stedfortrædere at vise",page:"Side",of:"af {0}",itemsPerPage:"stedfortrædere pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"Sub.FullName",title:"Stedfortræder"},{field:"Person.FullName",title:"Stedfortræder for"},{field:"OrgUnit.LongDescription",title:"Organisationsenhed"},{field:"Leader.FullName",title:"Opsat af"},{field:"StartDateTimestamp",title:"Fra",template:function(n){var t=o.moment.unix(n.StartDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{title:"Til",field:"EndDateTimestamp",template:function(n){if(n.EndDateTimestamp===o.infinitePeriod)return"På ubestemt tid";var t=o.moment.unix(n.EndDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{title:"Muligheder",template:function(n){return"<a ng-click='arsCtrl.openEditSubstitute("+n.Id+")'>Rediger<\/a> | <a ng-click='arsCtrl.openDeleteSubstitute("+n.Id+")'>Slet<\/a>"}}],scrollable:!1};this.personalApprovers={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"odata/Substitutes/Service.Personal(Type="+this.reportType+")?$expand=OrgUnit,Sub,Leader,Person&$filter=LeaderId eq "+this.personId,dataType:"json",cache:!1}},pageSize:20},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} ",empty:"Ingen personlige godkendere at vise",page:"Side",of:"af {0}",itemsPerPage:"personlige godkendere pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"Sub.FullName",title:"Godkender"},{field:"Person.FullName",title:"Godkender for"},{field:"Leader.FullName",title:"Opsat af"},{field:"StartDateTimestamp",title:"Fra",template:function(n){var t=o.moment.unix(n.StartDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{field:"EndDateTimestamp",title:"Til",template:function(n){if(n.EndDateTimestamp===o.infinitePeriod)return"På ubestemt tid";var t=o.moment.unix(n.EndDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{title:"Muligheder",template:function(n){return"<a ng-click='arsCtrl.openEditApprover("+n.Id+")'>Rediger<\/a> | <a ng-click='arsCtrl.openDeleteApprover("+n.Id+")'>Slet<\/a>"}}],scrollable:!1};this.mySubstitutes={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"odata/Substitutes/Service.Substitute(Type="+this.reportType+")?$expand=Sub,Person,Leader,OrgUnit &$filter=PersonId eq LeaderId and SubId eq "+this.personId,dataType:"json",cache:!1}},pageSize:20},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} ",empty:"Ingen stedfortrædere at vise",page:"Side",of:"af {0}",itemsPerPage:"stedfortrædere pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"Sub.FullName",title:"Stedfortræder"},{field:"Person.FullName",title:"Stedfortræder for"},{field:"OrgUnit.LongDescription",title:"Organisationsenhed"},{field:"Leader.FullName",title:"Opsat af"},{field:"StartDateTimestamp",title:"Fra",template:function(n){var t=f.unix(n.StartDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{title:"Til",field:"EndDateTimestamp",template:function(n){if(n.EndDateTimestamp===o.infinitePeriod)return"På ubestemt tid";var t=f.unix(n.EndDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}}],scrollable:!1};this.$scope.$on("kendoRendered",function(){o.isGridLoaded||(o.isGridLoaded=!0,o.refreshGrids())})}return n.prototype.refreshGrids=function(){this.isGridLoaded&&(this.substituteGrid.dataSource.read(),this.mySubstitutesGrid.dataSource.read(),this.personalApproverGrid.dataSource.read())},n.prototype.openDeleteApprover=function(n){var t=this,i=this.$modal.open({templateUrl:"App/Core/Views/Modals/ConfirmDeleteApproverModal.html",controller:"ConfirmDeleteApproverModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return t.people},orgUnits:function(){return t.orgUnits},leader:function(){return t.currentPerson},substituteId:function(){return n},ReportType:function(){return t.reportType}}});i.result.then(function(){t.refreshGrids()})},n.prototype.openDeleteSubstitute=function(n){var t=this,i=this.$modal.open({templateUrl:"App/Core/Views/Modals/ConfirmDeleteSubstituteModal.html",controller:"ConfirmDeleteSubstituteModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return t.people},orgUnits:function(){return t.orgUnits},leader:function(){return t.currentPerson},substituteId:function(){return n},ReportType:function(){return t.reportType}}});i.result.then(function(){t.refreshGrids()})},n.prototype.openEditSubstitute=function(n){var t=this,i=this.$modal.open({templateUrl:"App/Core/Views/Modals/editSubstituteModal.html",controller:"EditSubstituteModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return t.people},orgUnits:function(){return t.orgUnits},leader:function(){return t.currentPerson},substituteId:function(){return n},ReportType:function(){return t.reportType}}});i.result.then(function(){t.refreshGrids()})},n.prototype.openEditApprover=function(n){var t=this,i=this.$modal.open({templateUrl:"App/Core/Views/Modals/EditApproverModal.html",controller:"EditApproverModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return t.people},orgUnits:function(){return t.orgUnits},leader:function(){return t.currentPerson},substituteId:function(){return n},ReportType:function(){return t.reportType}}});i.result.then(function(){t.refreshGrids()})},n.prototype.createNewApprover=function(){var n=this,t=this.$modal.open({templateUrl:"App/Core/Views/Modals/newApproverModal.html",controller:"NewApproverModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return n.people},orgUnits:function(){return n.orgUnits},leader:function(){return n.currentPerson},ReportType:function(){return n.reportType}}});t.result.then(function(){n.refreshGrids()})},n.prototype.createNewSubstitute=function(){var n=this,t=this.$modal.open({templateUrl:"App/Core/Views/Modals/newSubstituteModal.html",controller:"NewSubstituteModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return n.people},orgUnits:function(){return n.orgUnits},leader:function(){return n.currentPerson},ReportType:function(){return n.reportType}}});t.result.then(function(){n.refreshGrids()})},n}();n.BaseApproveReportsSettingsController=t})(t=n.controllers||(n.controllers={}))})(t=n.core||(n.core={}))}(app||(app={})),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(n,t,i,r,u,f,e,o,s){var h=this,c;this.$scope=n;this.Person=t;this.$rootScope=i;this.HelpText=r;this.Autocomplete=u;this.$modal=f;this.$timeout=e;this.moment=o;this.reportType=s;this.dateOptions={format:"dd/MM/yyyy"};this.currentUser=n.CurrentUser;c=new Date;c.setMonth(c.getMonth()-1);this.fromDate=this.startOfDay(c);this.toDate=this.endOfDay(new Date);this.people=u.activeUsers();this.orgUnits=u.orgUnits();this.substitutes={dataSource:{pageSize:20,type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"odata/Substitutes/Service.Substitute(Type="+this.reportType+")?$expand=OrgUnit,Sub,Person,Leader,CreatedBy",dataType:"json",cache:!1}}},serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sortable:!0,scrollable:!1,filter:[{field:"StartDateTimestamp",operator:"lte",value:this.toDate},{field:"EndDateTimestamp",operator:"gte",value:this.fromDate}],pageable:{messages:{display:"{0} - {1} af {2} stedfortrædere",empty:"Ingen stedfortrædere at vise",page:"Side",of:"af {0}",itemsPerPage:"stedfortrædere pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"Sub.FullName",title:"Stedfortræder"},{field:"Person.FullName",title:"Stedfortræder for"},{field:"OrgUnit.LongDescription",title:"Organisationsenhed"},{field:"Leader.FullName",title:"Opsat af",template:function(n){return n.CreatedBy==undefined?"<i>Ikke tilgængelig<\/i>":n.CreatedBy.FullName}},{field:"StartDateTimestamp",title:"Fra",template:function(n){var t=h.moment.unix(n.StartDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{field:"EndDateTimestamp",title:"Til",template:function(n){if(n.EndDateTimestamp==9999999999)return"På ubestemt tid";var t=h.moment.unix(n.EndDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{title:"Muligheder",template:function(n){return"<a ng-click='subCtrl.openEditSubstitute("+n.Id+")'>Rediger<\/a> | <a ng-click='subCtrl.openDeleteSubstitute("+n.Id+")'>Slet<\/a>"}}]};this.personalApprovers={dataSource:{pageSize:20,type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"odata/Substitutes/Service.Personal(Type="+this.reportType+")?$expand=OrgUnit,Sub,Leader,Person,CreatedBy",dataType:"json",cache:!1}}},serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sortable:!0,scrollable:!1,pageable:{messages:{display:"{0} - {1} af {2} personlige godkendere",empty:"Ingen personlige godkendere at vise",page:"Side",of:"af {0}",itemsPerPage:"personlige godkendere pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"Sub.FullName",title:"Godkender"},{field:"Person.FullName",title:"Godkender for"},{field:"CreatedBy",title:"Opsat af",template:function(n){return n.CreatedBy==undefined?"<i>Ikke tilgængelig<\/i>":n.CreatedBy.FullName}},{field:"StartDateTimestamp",title:"Fra",template:function(n){var t=h.moment.unix(n.StartDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{field:"EndDateTimestamp",title:"Til",template:function(n){if(n.EndDateTimestamp==9999999999)return"På ubestemt tid";var t=h.moment.unix(n.EndDateTimestamp).toDate();return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}},{title:"Muligheder",template:function(n){return"<a ng-click='subCtrl.openEditApprover("+n.Id+")'>Rediger<\/a> | <a ng-click='subCtrl.openDeleteApprover("+n.Id+")'>Slet<\/a>"}}]};this.loadInitialDates()}return n.prototype.clearClicked=function(n){var t=new Date;t.setMonth(t.getMonth()-1);n==="substitute"?(this.subInfinitePeriod=!1,this.substituteToDate=new Date,this.substituteFromDate=t,this.substituteGrid.dataSource.filter([])):n==="approver"&&(this.appInfinitePeriod=!1,this.approverToDate=new Date,this.approverFromDate=t,this.approverGrid.dataSource.filter([]))},n.prototype.dateChanged=function(n){var t=this;this.$timeout(function(){var i,r,u,f;n==="substitute"?(i=t.startOfDay(t.substituteFromDate),r=t.endOfDay(t.substituteToDate),t.initialLoad<=0&&t.applyDateFilter(i,r,"substitute")):n==="approver"&&(u=t.startOfDay(t.approverFromDate),f=t.endOfDay(t.approverToDate),t.initialLoad<=0&&t.applyDateFilter(u,f,"approver"));t.initialLoad--},0)},n.prototype.applyDateFilter=function(n,t,i){var r,u;i==="substitute"?(this.substituteGrid.dataSource.filter([]),r=[],r.push({field:"StartDateTimestamp",operator:"lte",value:t}),this.subInfinitePeriod||r.push({field:"EndDateTimestamp",operator:"gte",value:n}),this.substituteGrid.dataSource.filter(r)):i==="approver"&&(this.approverGrid.dataSource.filter([]),u=[],u.push({field:"StartDateTimestamp",operator:"lte",value:t}),this.appInfinitePeriod||u.push({field:"EndDateTimestamp",operator:"gte",value:n}),this.approverGrid.dataSource.filter(u))},n.prototype.refreshGrids=function(){this.substituteGrid.dataSource.read();this.approverGrid.dataSource.read()},n.prototype.loadInitialDates=function(){this.initialLoad=4;var n=new Date;n.setMonth(n.getMonth()-1);this.approverToDate=new Date;this.approverFromDate=n;this.substituteToDate=new Date;this.substituteFromDate=n},n.prototype.openEditSubstitute=function(n){var t=this,i=this.$modal.open({templateUrl:"App/Core/Views/Modals/EditSubstituteModal.html",controller:"EditSubstituteModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return t.people},orgUnits:function(){return t.orgUnits},leader:function(){return t.currentUser},substituteId:function(){return n},ReportType:function(){return t.reportType}}});i.result.then(function(){t.refreshGrids()})},n.prototype.openEditApprover=function(n){var t=this;this.$modal.open({templateUrl:"App/Core/Views/Modals/EditApproverModal.html",controller:"EditApproverModalInstanceController",controllerAs:"ctrl",backdrop:"static",size:"lg",resolve:{persons:function(){return t.people},orgUnits:function(){return t.orgUnits},leader:function(){return t.currentUser},substituteId:function(){return n},ReportType:function(){return t.reportType}}}).result.then(function(){t.approverGrid.dataSource.read()})},n.prototype.createNewApprover=function(){var n=this,t=this.$modal.open({templateUrl:"App/Core/Views/Modals/NewApproverModal.html",controller:"NewApproverModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return n.people},orgUnits:function(){return n.orgUnits},leader:function(){return n.currentUser},ReportType:function(){return n.reportType}}});t.result.then(function(){n.refreshGrids()})},n.prototype.createNewSubstitute=function(){var n=this,t=this.$modal.open({templateUrl:"App/Core/Views/Modals/AdminNewSubstituteModal.html",controller:"AdminNewSubstituteModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return n.people},orgUnits:function(){return n.orgUnits},leader:function(){return n.currentUser},ReportType:function(){return n.reportType}}});t.result.then(function(){n.refreshGrids()},function(){})},n.prototype.openDeleteApprover=function(n){var t=this,i=this.$modal.open({templateUrl:"App/Core/Views/Modals/ConfirmDeleteApproverModal.html",controller:"ConfirmDeleteApproverModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return t.people},orgUnits:function(){return t.orgUnits},leader:function(){return t.currentUser},substituteId:function(){return n},ReportType:function(){return t.reportType}}});i.result.then(function(){t.refreshGrids()})},n.prototype.openDeleteSubstitute=function(n){var t=this,i=this.$modal.open({templateUrl:"App/Core/Views/Modals/ConfirmDeleteSubstituteModal.html",controller:"ConfirmDeleteSubstituteModalInstanceController",backdrop:"static",size:"lg",resolve:{persons:function(){return t.people},orgUnits:function(){return t.orgUnits},leader:function(){return t.currentUser},substituteId:function(){return n},ReportType:function(){return t.reportType}}});i.result.then(function(){t.refreshGrids()})},n.prototype.startOfDay=function(n){return moment(n).startOf("day").unix()},n.prototype.endOfDay=function(n){return moment(n).endOf("day").unix()},n}();n.BaseSubstitutesController=t})(t=n.controllers||(n.controllers={}))})(t=n.core||(n.core={}))}(app||(app={}));angular.module("app.core").controller("ConfirmDeleteApproverModalInstanceController",["$scope","$modalInstance","persons","orgUnits","leader","Substitute","Person","NotificationService","substituteId",function(n,t,i,r,u,f,e,o,s){n.loadingPromise=null;n.persons=i;n.orgUnits=r;n.substitute=f.get({id:s},function(t){n.substitute=t.value[0];n.sub=n.substitute.Sub;n.person=n.substitute.Person;console.log(n.substitute);n.substituteFromDate=new Date(n.substitute.StartDateTimestamp*1e3).toLocaleDateString();n.substituteToDate=n.substitute.EndDateTimestamp==9999999999?"På ubestemt tid":new Date(n.substitute.EndDateTimestamp*1e3).toLocaleDateString()});n.orgUnitSelected=function(n){console.log(n)};n.deleteSubstitute=function(){var i=new f;n.showSpinner=!0;n.loadingPromise=i.$delete({id:n.substitute.Id},function(){o.AutoFadeNotification("success","","Personlig godkender er blevet slettet");t.close()},function(){o.AutoFadeNotification("danger","","Kunne ikke slette personlig godkender")})};n.cancelSubstitute=function(){t.dismiss("cancel")}}]);angular.module("app.core").controller("DeleteMailNotificationController",["$scope","$modalInstance","itemId","NotificationService",function(n,t,i,r){n.confirmDelete=function(){t.close(n.itemId);r.AutoFadeNotification("success","","Adviseringen blev slettet.")};n.cancel=function(){t.dismiss("cancel");r.AutoFadeNotification("warning","","Sletning af adviseringen blev annulleret.")}}]);angular.module("app.core").controller("ConfirmDeleteSubstituteModalInstanceController",["$scope","$modalInstance","persons","orgUnits","leader","Substitute","Person","NotificationService","substituteId",function(n,t,i,r,u,f,e,o,s){n.loadingPromise=null;n.persons=i;n.orgUnits=r;n.substitute=f.get({id:s},function(t){n.substitute=t.value[0];n.person=n.substitute.Sub;console.log(n.substitute);n.substituteFromDate=new Date(n.substitute.StartDateTimestamp*1e3).toLocaleDateString();n.substituteToDate=n.substitute.EndDateTimestamp==9999999999?"På ubestemt tid":new Date(n.substitute.EndDateTimestamp*1e3).toLocaleDateString()});n.orgUnitSelected=function(n){console.log(n)};n.deleteSubstitute=function(){var i=new f;n.showSpinner=!0;n.loadingPromise=i.$delete({id:n.substitute.Id},function(){o.AutoFadeNotification("success","","Stedfortræderen blev slettet.");t.close()},function(){o.AutoFadeNotification("danger","","Kunne ikke slette stedfortræder")})};n.cancelSubstitute=function(){t.dismiss("cancel")}}]);angular.module("app.core").controller("EditApproverModalInstanceController",["$scope","$modalInstance","persons","orgUnits","leader","Substitute","Person","NotificationService","substituteId","Autocomplete","ReportType",function(n,t,i,r,u,f,e,o,s,h,c){n.persons=i;n.orgUnits=r;n.orgUnit=n.orgUnits[0];n.loadingPromise=null;n.personsWithoutLeader=h.activeUsersWithoutLeader(u.Id);n.autoCompleteOptionsFor={select:function(t){n.target=this.dataItem(t.item.index())}};n.autoCompleteOptionsSub={select:function(t){n.approver=this.dataItem(t.item.index())}};n.substitute=f.get({id:s},function(t){t.value[0].EndDateTimestamp==9999999999&&(n.infinitePeriod=!0);n.substitute=t.value[0];n.target=n.substitute.Person;n.approver=n.substitute.Sub;n.approverFromDate=new Date(n.substitute.StartDateTimestamp*1e3);n.approverToDate=new Date(n.substitute.EndDateTimestamp*1e3);n.orgUnit=$.grep(n.orgUnits,function(t){return t.Id==n.substitute.OrgUnitId})[0];n.container.autoCompleteFor.value(n.target.FullName);n.container.autoCompleteSub.value(n.approver.FullName)});n.saveNewApprover=function(){if(n.approver==undefined){o.AutoFadeNotification("danger","","Du skal vælge en godkender");return}if(n.target==undefined){o.AutoFadeNotification("danger","","Du skal vælge en ansat");return}var i=new f({StartDateTimestamp:Math.floor(n.approverFromDate.getTime()/1e3),EndDateTimestamp:Math.floor(n.approverToDate.getTime()/1e3),SubId:n.approver.Id,OrgUnitId:1,PersonId:n.target.Id,CreatedById:u.Id,Type:c===0?"Drive":"Vacation"});n.infinitePeriod&&(i.EndDateTimestamp=9999999999);n.showSpinner=!0;n.loadingPromise=i.$patch({id:s},function(){o.AutoFadeNotification("success","","Godkender blev redigeret");t.close()},function(){o.AutoFadeNotification("danger","","Kunne ikke oprette godkender");n.showSpinner=!1})};n.cancelNewApprover=function(){t.dismiss("cancel")}}]);angular.module("app.core").controller("EditMailNotificationController",["$scope","$modalInstance","itemId","NotificationService","EmailNotification",function(n,t,i,r,u){n.repeatMonthly="";n.dateOptions={format:"dd/MM/yyyy"};n.repeatItems=[{value:"Ja",bool:!0},{value:"Nej",bool:!1}];u.get({id:i}).$promise.then(function(t){n.repeatMonthly=n.repeatItems[1];t.Repeat&&(n.repeatMonthly=n.repeatItems[0]);var i=moment.unix(t.DateTimestamp),r=moment.unix(t.PayRoleTimestamp);n.notificationDate=i._d;n.payRoleDate=r._d});n.confirmSave=function(){var u=!1,i;n.repeatErrorMessage="";n.repeatMonthly==""&&(u=!0,n.repeatErrorMessage="* Du skal udfylde 'Gentag månedligt'.");n.dateErrorMessage="";n.notificationDate==undefined&&(u=!0,n.dateErrorMessage="* Du skal vælge en gyldig adviseringsdato.");n.payDateErrorMessage="";n.payRoleDate==undefined&&(u=!0,n.payDateErrorMessage="* Du skal vælge en gyldig lønkørselsdato.");i={};i.repeatMonthly=n.repeatMonthly.bool;i.notificationDate=moment(n.notificationDate).unix();i.payDate=moment(n.payRoleDate).unix();u||(t.close(i),r.AutoFadeNotification("success","","Email-adviseringen blev redigeret."))};n.cancel=function(){t.dismiss("cancel");r.AutoFadeNotification("warning","","Oprettelse af email adviseringen blev annulleret.")}}]);angular.module("app.core").controller("EditSubstituteModalInstanceController",["$scope","$modalInstance","persons","OrgUnit","leader","Substitute","Person","NotificationService","substituteId","ReportType",function(n,t,i,r,u,f,e,o,s,h){n.container={};n.persons=i;n.loadingPromise=null;n.person=[];n.autoCompleteOptions={select:function(t){n.person[0]=this.dataItem(t.item.index())}};n.substitute=f.get({id:s},function(t){t.value[0].EndDateTimestamp==9999999999&&(n.infinitePeriod=!0);r.getWhereUserIsLeader({id:t.value[0].PersonId}).$promise.then(function(t){n.orgUnits=t});n.substitute=t.value[0];n.orgUnit=n.substitute.OrgUnit;n.person[0]=n.substitute.Sub;n.substituteFromDate=new Date(n.substitute.StartDateTimestamp*1e3);n.substituteToDate=new Date(n.substitute.EndDateTimestamp*1e3);n.container.autoComplete.value(n.substitute.Sub.FullName)});n.saveNewSubstitute=function(){if(n.person==undefined){o.AutoFadeNotification("danger","","Du skal vælge en person");return}var i=new f({StartDateTimestamp:Math.floor(n.substituteFromDate.getTime()/1e3),EndDateTimestamp:Math.floor(n.substituteToDate.getTime()/1e3),SubId:n.person[0].Id,OrgUnitId:n.orgUnit.Id,CreatedById:u.Id,Type:h===0?"Drive":"Vacation"});n.infinitePeriod&&(i.EndDateTimestamp=9999999999);n.showSpinner=!0;n.loadingPromise=i.$patch({id:n.substitute.Id},function(){o.AutoFadeNotification("success","","Stedfortræder blev gemt");t.close()},function(){o.AutoFadeNotification("danger","","Kunne ikke gemme stedfortræder (Du kan ikke oprette 2 stedfortrædere for samme organisation i samme periode)");n.showSpinner=!1})};n.cancelNewSubstitute=function(){t.dismiss("cancel")}}]);angular.module("app.core").controller("EmailNotificationController",["$scope","$modal","EmailNotification","$rootScope",function(n,t,i,r){n.$on("emailClicked",function(){n.gridContainer.notificationGrid.dataSource.read()});n.EmailHelpText=r.HelpTexts.EmailHelpText.text;n.gridContainer={};n.notifications={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/MailNotifications",dataType:"json",cache:!1}},pageSize:20,serverPaging:!1,serverSorting:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} adviseringer",empty:"Ingen adviseringer at vise",page:"Side",of:"af {0}",itemsPerPage:"adviseringer pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},scrollable:!1,columns:[{field:"DateTimestamp",title:"Adviseringsdato",template:function(n){var t=moment.unix(n.DateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"PayRoleTimestamp",title:"Lønkørselsdato",template:function(n){var t=moment.unix(n.PayRoleTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"Repeat",title:"Gentag månedligt",template:function(n){return n.Repeat?"Ja":"Nej"}},{field:"Notified",title:"Er kørt",template:function(n){return n.Notified?"<i class='fa fa-check'><\/i>":""}},{field:"Id",template:"<a ng-click=editClick(${Id})>Redigér<\/a> | <a ng-click=deleteClick(${Id})>Slet<\/a>",title:"Muligheder"}]};n.updateNotificationGrid=function(){n.gridContainer.notificationGrid.dataSource.read()};n.editClick=function(r){var u=t.open({templateUrl:"/App/Core/Views/Modals/EditMailNotificationTemplate.html",controller:"EditMailNotificationController",backdrop:"static",resolve:{itemId:function(){return r}}});u.result.then(function(t){i.patch({id:r},{DateTimestamp:t.notificationDate,Repeat:t.repeatMonthly,PayRoleTimestamp:t.payDate},function(){n.updateNotificationGrid()})})};n.deleteClick=function(r){var u=t.open({templateUrl:"/App/Core/Views/Modals/ConfirmDeleteMailNotificationTemplate.html",controller:"DeleteMailNotificationController",backdrop:"static",resolve:{itemId:function(){return r}}});u.result.then(function(){i.delete({id:r},function(){n.updateNotificationGrid()})})};n.addNewClick=function(){var r=t.open({templateUrl:"/App/Core/Views/Modals/AddNewMailNotificationTemplate.html",controller:"AddNewMailNotificationController",backdrop:"static"});r.result.then(function(t){i.post({DateTimestamp:t.notificationDate,Repeat:t.repeatMonthly,Notified:!1,PayRoleTimestamp:t.payDate},function(){n.updateNotificationGrid()})})}}]);angular.module("app.core").controller("NewApproverModalInstanceController",["$scope","$modalInstance","persons","orgUnits","leader","Substitute","Person","NotificationService","Autocomplete","ReportType",function(n,t,i,r,u,f,e,o,s,h){n.loadingPromise=null;n.persons=i;n.approverFromDate=new Date;n.approverToDate=new Date;n.orgUnits=r;n.orgUnit=n.orgUnits[0];n.autoCompleteOptions={filter:"contains"};n.personsWithoutLeader=s.activeUsersWithoutLeader(u.Id);n.saveNewApprover=function(){if(n.approver==undefined){o.AutoFadeNotification("danger","","Du skal vælge en godkender");return}if(n.target==undefined){o.AutoFadeNotification("danger","","Du skal vælge en ansat");return}var i=new f({StartDateTimestamp:Math.floor(n.approverFromDate.getTime()/1e3),EndDateTimestamp:Math.floor(n.approverToDate.getTime()/1e3),LeaderId:u.Id,SubId:n.approver[0].Id,OrgUnitId:1,PersonId:n.target[0].Id,CreatedById:u.Id,Type:h===0?"Drive":"Vacation"});n.infinitePeriod&&(i.EndDateTimestamp=9999999999);n.showSpinner=!0;n.loadingPromise=i.$post(function(){o.AutoFadeNotification("success","","Godkender blev oprettet");t.close()},function(){o.AutoFadeNotification("danger","","Kunne ikke oprette godkender (Du kan ikke oprette 2 godkendere for samme person i samme periode)");n.showSpinner=!1})};n.cancelNewApprover=function(){t.dismiss("cancel")}}]);angular.module("app.core").controller("NewSubstituteModalInstanceController",["$scope","$modalInstance","persons","OrgUnit","leader","Substitute","Person","NotificationService","Autocomplete","ReportType",function(n,t,i,r,u,f,e,o,s,h){n.loadingPromise=null;n.persons=i;n.substituteFromDate=new Date;n.substituteToDate=new Date;n.orgUnits=n.orgUnits=r.getWhereUserIsLeader({id:u.Id},function(){n.orgUnit=n.orgUnits[0]});n.autoCompleteOptions={filter:"contains"};n.personsWithoutLeader=s.activeUsersWithoutLeader(u.Id);n.saveNewSubstitute=function(){if(n.person==undefined){o.AutoFadeNotification("danger","","Du skal vælge en person");return}var i=new f({StartDateTimestamp:Math.floor(n.substituteFromDate.getTime()/1e3),EndDateTimestamp:Math.floor(n.substituteToDate.getTime()/1e3),LeaderId:u.Id,SubId:n.person[0].Id,OrgUnitId:n.orgUnit.Id,PersonId:u.Id,CreatedById:u.Id,Type:h===0?"Drive":"Vacation"});n.infinitePeriod&&(i.EndDateTimestamp=9999999999);n.showSpinner=!0;n.loadingPromise=i.$post(function(){o.AutoFadeNotification("success","","Stedfortræder blev oprettet");t.close()},function(){o.AutoFadeNotification("danger","","Kunne ikke oprette stedfortræder");n.showSpinner=!1})};n.cancelNewSubstitute=function(){t.dismiss("cancel")}}]);angular.module("app.core").controller("RejectReportModalInstanceController",["$scope","$modalInstance","itemId","NotificationService",function(n,t,i,r){n.itemId=i;n.result={};n.noClicked=function(){t.dismiss("cancel");r.AutoFadeNotification("warning","","Afvisning af indberetningen blev annulleret.")};n.yesClicked=function(){n.comment==undefined?n.errorMessage="* Du skal angive en kommentar.":(n.result.Comment=n.comment,n.result.Id=i,t.close(n.result))}}]),function(){"use strict";angular.module("app.core").directive("checkie",["$modal",function(n){function t(t){var r=t.checkieDebug?t.checkieDebug:i(),u;t.checkieMinIe=t.checkieMinIe&&t.checkieMinIe.length?t.checkieMinIe:9;t.outdated=r>-1&&r<parseInt(t.checkieMinIe);t.msg="";t.outdated&&(t.msg=t.checkieMessage&&t.checkieMessage.length>0?t.checkieMessage:"Browseren kan ikke anvendes til OS2Indberetning. Din version af browseren Internet Explorer er for gammel. Du bedes opdatere Internet Explorer til version 11, alternativt bruge browserne Chrome eller Firefox.",u=n.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.msg}}}))}function i(){var n=-1,t,i;return navigator.appName==="Microsoft Internet Explorer"&&(t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),i.exec(t)!==null&&(n=parseFloat(RegExp.$1))),n}return{restrict:"AE",replace:!0,scope:{checkieMinIe:"@",checkieMessage:"@",checkieDebug:"@"},transclude:!0,template:'<div data-ng-class="{outdated: outdated}"><div data-ng-if="outdated === false" ng-transclude><\/div><\/div>',link:t}}])}();angular.module("app.core").directive("ngEnter",function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.ngEnter)}),t.preventDefault())})}}),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n}();n.Employment=t})(t=n.models||(n.models={}))})(t=n.core||(n.core={}))}(app||(app={})),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n}();n.OrgUnit=t})(t=n.models||(n.models={}))})(t=n.core||(n.core={}))}(app||(app={})),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n}();n.Person=t})(t=n.models||(n.models={}))})(t=n.core||(n.core={}))}(app||(app={})),function(n){var t;(function(n){var t;(function(n){"use strict";var i,r,t;(function(n){n[n.Pending=0]="Pending";n[n.Accepted=1]="Accepted";n[n.Rejected=2]="Rejected";n[n.Invoiced=3]="Invoiced"})(n.ReportStatus||(n.ReportStatus={}));i=n.ReportStatus,function(n){n[n.Unknown=-1]="Unknown";n[n.Drive=0]="Drive";n[n.Vacation=1]="Vacation"}(n.ReportType||(n.ReportType={}));r=n.ReportType;t=function(){function n(){}return n}();n.Report=t})(t=n.models||(n.models={}))})(t=n.core||(n.core={}))}(app||(app={})),function(n){var t;(function(n){var t;(function(){"use strict"})(t=n.models||(n.models={}))})(t=n.core||(n.core={}))}(app||(app={})),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n}();n.VacationBalance=t})(t=n.models||(n.models={}))})(t=n.core||(n.core={}))}(app||(app={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(n){var t;(function(n){"use strict";(function(n){n[n.Regular=0]="Regular";n[n.SixthVacationWeek=1]="SixthVacationWeek";n[n.Care=2]="Care";n[n.Senior=3]="Senior";n[n.Optional=4]="Optional";n[n.Other=5]="Other"})(n.VacationType||(n.VacationType={}));var i=n.VacationType,t=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(n.Report);n.VacationReport=t})(t=n.models||(n.models={}))})(t=n.core||(n.core={}))}(app||(app={})),function(n){var t;(function(n){var t;(function(){var n=function(){function n(n,t,i,r){this.$rootScope=n;this.$state=t;this.principal=i;this._authenticated=!1;this.enabledModules=[];this.enabledModules=r.toLowerCase().split(", ")}return n.prototype.getModule=function(n){return n.split(".")[0]},n.prototype.isModuleEnabled=function(n){return this.enabledModules.indexOf(n)!==-1},n.prototype.authorize=function(){var n=this;return this.principal.identity().then(function(){var r=n.principal.isAuthenticated(),i=n.getModule(n.$rootScope.toState.name),t=n.intersect(n.enabledModules,n.principal.accessibleModules());r&&(t.length==0?n.$rootScope.hasAccess=!1:i=="default"||n.canAccessModule(i,t)?i=="default"&&t.length==1?t=="drive"?n.$state.go("drive.driving"):t=="vacation"&&n.$state.go("vacation.report"):n.$rootScope.toState.data&&n.$rootScope.toState.data.roles&&n.$rootScope.toState.data.roles.length>0&&!n.principal.isInAnyRole(n.$rootScope.toState.data.roles)&&n.$state.go("default"):n.$state.go("default"))})},n.prototype.canAccessModule=function(n,t){return t.indexOf(n)!==-1},n.prototype.intersect=function(n,t){var i;return t.length>n.length&&(i=t,t=n,n=i),n.filter(function(n){if(t.indexOf(n)!==-1)return!0})},n.$inject=["$rootScope","$state","Principal","EnabledApplications"],n}();angular.module("app.core").service("Authorization",n)})(t=n.services||(n.services={}))})(t=n.core||(n.core={}))}(app||(app={}));angular.module("app.core").service("Autocomplete",function(){return{allUsers:function(){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(n){return"/odata/Person?$filter=contains(FullName,'"+encodeURIComponent(n.filter.filters[0].value)+"')"},dataType:"json",data:{}}},schema:{data:function(n){return n.value}}}},activeUsers:function(){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(n){return"/odata/Person?$filter=contains(FullName,'"+encodeURIComponent(n.filter.filters[0].value)+"') and IsActive"},dataType:"json",data:{}}},schema:{data:function(n){return n.value}}}},activeUsersWithoutLeader:function(n){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(t){return"/odata/Person?$filter=contains(FullName,'"+encodeURIComponent(t.filter.filters[0].value)+"') and IsActive and Id ne "+n},dataType:"json",data:{}}},schema:{data:function(n){return n.value}}}},admins:function(){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(n){return"/odata/Person?$filter=contains(FullName,'"+encodeURIComponent(n.filter.filters[0].value)+"') and IsActive and IsAdmin"},dataType:"json",data:{}}},schema:{data:function(n){return n.value}}}},nonAdmins:function(){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(n){return"/odata/Person?$filter=contains(FullName,'"+encodeURIComponent(n.filter.filters[0].value)+"') and IsActive and not IsAdmin"},dataType:"json",data:{}}},schema:{data:function(n){return n.value}}}},leaders:function(){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(n){return"/odata/Employments?$filter=contains(Person/FullName,'"+encodeURIComponent(n.filter.filters[0].value)+"') and IsLeader &$expand=Person &$select=Person"},dataType:"json",data:{}}},schema:{data:function(n){for(var r={},u=[],i=angular.fromJson(n).value,t=0;t<i.length;t++)r[i[t].Person.FullName]==undefined&&(u.push(i[t].Person),r[i[t].Person.FullName]=i[t].Person);return u}}}},orgUnits:function(){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(n){return"/odata/OrgUnits?$filter=contains(LongDescription,'"+encodeURIComponent(n.filter.filters[0].value)+"')"},dataType:"json",data:{}}},schema:{data:function(n){return n.value}}}},orgUnitsThatHaveALeader:function(){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(n){n.filter==undefined&&(n.filter={},n.filter.filters=[],n.filter.filters.push({field:"LongDescription",ignoreCase:"true",operator:"contains",value:""}));return"/odata/Employments?$filter=contains(OrgUnit/LongDescription,'"+encodeURIComponent(n.filter.filters[0].value)+"') and IsLeader&$select=OrgUnit&$expand=OrgUnit"},dataType:"json",data:{}}},schema:{data:function(n){for(var i=[],t=0;t<n.value.length;t++)i.push(n.value[t].OrgUnit);return i}}}}}});angular.module("app.core").service("BankAccount",["$resource",function(n){return n("/odata/BankAccounts(:id)",{id:"@id"},{get:{method:"GET",isArray:!1},patch:{method:"PATCH"},post:{method:"POST"},getByAccount:{method:"GET",url:"/odata/BankAccounts?$filter=Number eq ':account'",transformResponse:function(n){return angular.fromJson(n).value[0]}}})}]);angular.module("app.core").service("EmailNotification",["$resource",function(n){return n("/odata/MailNotifications(:id)",{id:"@id"},{get:{method:"GET",isArray:!1,transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value[0]:(i=$modal.open({templateUrl:"/App/Core/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)}},getAll:{method:"GET",isArray:!1},patch:{method:"PATCH",isArray:!1},post:{method:"POST",isArray:!1}})}]);angular.module("app.core").service("File",["$resource",function(n){return n("/api/File",{id:"@id"},{generateKMDFile:{method:"GET"}})}]);angular.module("app.core").service("HelpText",["$resource",function(n){return n("/api/HelpText/:id",{id:"@id"},{get:{method:"GET",isArray:!1,transformResponse:function(n){return{text:angular.fromJson(n)}}},getAll:{method:"GET",url:"/api/HelpText/",isArray:!1,transformResponse:function(n){var t={};return angular.forEach(angular.fromJson(n),function(n){t[n.key]={text:n.value}}),t}}})}]);angular.module("app.core").factory("NotificationService",[function(){return{AutoFadeNotification:function(n,t,i){n=="danger"&&(n="error");n=="warning"&&(n="notice");new PNotify({remove:!0,title:"<br/>"+t,text:i,min_height:"100px",width:"300px",type:n,icon:!0,delay:5e3,shadow:!0,animation:{effect_in:"drop",options_in:{easing:"easeOutBounce"},options_out:{easing:"easeInCubic"},effect_out:"drop"},mouse_reset:!1,buttons:{sticker:!1}})}}}]);angular.module("app.core").service("OrgUnit",["$resource",function(n){return n("/odata/OrgUnits(:id)?:query",{id:"@id"},{get:{method:"GET",isArray:!1},patch:{method:"PATCH",isArray:!1},getWhereUserIsLeader:{method:"GET",isArray:!0,url:"/odata/OrgUnits/Service.GetWhereUserIsResponsible?personId=:id",transformResponse:function(n){return angular.fromJson(n).value}},getLeaderOfOrg:{method:"GET",isArray:!1,url:"/odata/OrgUnits/Service.GetLeaderOfOrg?orgId=:id",transformResponse:function(n){return angular.fromJson(n)}},SetVacationAccess:{method:"GET",isArray:!1,url:"/odata/OrgUnits/Service.SetVacationAccess(Key=:id)"}})}]);angular.module("app.core").service("PersonEmployments",["$resource",function(n){return n("/odata/Person(:id)/Employments?$expand=OrgUnit",{id:"@id"},{get:{method:"GET",isArray:!0,transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value:(i=$modal.open({templateUrl:"/App/Core/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)}},patchEmployment:{method:"PATCH",isArray:!1,url:"/odata/Employments(:id)"}})}]);angular.module("app.core").service("Person",["$resource","$modal",function(n,t){return n("/odata/Person(:id)",{id:"@id"},{get:{method:"GET",isArray:!1,transformResponse:function(n){return angular.fromJson(n)}},getAll:{method:"GET",isArray:!1,url:"/odata/Person?:query",transformResponse:function(n){return angular.fromJson(n)}},patch:{method:"PATCH"},getNonAdmins:{url:"/odata/Person?$filter=IsAdmin eq false and IsActive eq true &$select=Id,FullName",method:"GET",isArray:!1,transformResponse:function(n){return angular.fromJson(n)}},GetCurrentUser:{url:"/odata/Person/Service.GetCurrentUser?$select=Id,FirstName,IsSubstitute,RecieveMail,IsAdmin,FullName,Initials,Mail,HasAppPassword,DistanceFromHomeToBorder &$expand=PersonalRoutes($expand=Points),LicensePlates,Employments($expand=AlternativeWorkAddress,OrgUnit($select=Id,LongDescription,HasAccessToFourKmRule,DefaultKilometerAllowance,HasAccessToVacation; $expand=Address); $select=Id,Position,IsLeader,HomeWorkDistance,WorkDistanceOverride, AlternativeWorkAddressId, EmploymentId)",method:"GET",transformResponse:function(n){var i=angular.fromJson(n),r;return i.error==undefined?(i.IsLeader=function(){var n=!1;return angular.forEach(i.Employments,function(t){t.IsLeader===!0&&(n=!0)}),n}(),i):(r=t.open({templateUrl:"/App/Core/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return i.error.innererror.message==="Errors in address, see inner exception."?"Din arbejds- eller hjemmeadresse er ikke gyldig. Kontakt en administrator for at få den vasket. Indtil da kan du ikke anvende systemet.":i.error.innererror.message}}}),i)}},GetUserAsCurrentUser:{url:"/odata/Person/Service.GetUserAsCurrentUser?Id=:id&$select=Id,IsSubstitute,Initials,RecieveMail,IsAdmin,HasAppPassword,FullName,Mail,DistanceFromHomeToBorder &$expand=PersonalRoutes($expand=Points),LicensePlates,Employments($expand=AlternativeWorkAddress,OrgUnit($select=Id,LongDescription,HasAccessToFourKmRule; $expand=Address); $select=Id,Position,IsLeader,HomeWorkDistance,WorkDistanceOverride, AlternativeWorkAddressId, EmploymentId)",method:"GET",transformResponse:function(n){var i=angular.fromJson(n),r;return i.error==undefined?(i.IsLeader=function(){var n=!1;return angular.forEach(i.Employments,function(t){t.IsLeader===!0&&(n=!0)}),n}(),i):(r=t.open({templateUrl:"/App/Core/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return i.error.innererror.message==="Errors in address, see inner exception."?"Din arbejds- eller hjemmeadresse er ikke gyldig. Kontakt en administrator for at få den vasket. Indtil da kan du ikke anvende systemet.":i.error.innererror.message}}}),i)}},GetLeaders:{url:"/odata/Employments?$filter=IsLeader eq true&$select=Person &$expand=Person($select=Id,FullName)",method:"GET",isArray:!0,transformResponse:function(n){for(var r={},u=[],i=angular.fromJson(n).value,t=0;t<i.length;t++)r[i[t].Person.FullName]==undefined&&(u.push(i[t].Person),r[i[t].Person.FullName]=i[t].Person);return u}},GetChildren:{method:"GET",isArray:!0,url:"/odata/Person/Service.Children(Id=:id)",transformResponse:function(n){var t=angular.fromJson(n).value;return angular.forEach(t,function(n){n.FullName=n.FirstName+" "+n.LastName}),t}}})}]),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this.$q=n;this.$rootScope=t;this.Person=i;this._authenticated=!1;this._roles=[];this._accessibleModules=[]}return n.prototype.isIdentityResolved=function(){return angular.isDefined(this._identity)},n.prototype.isAuthenticated=function(){return this._authenticated},n.prototype.accessibleModules=function(){return this._accessibleModules},n.prototype.isInRole=function(n){return this._authenticated?this._roles.indexOf(n)!==-1:!1},n.prototype.isInAnyRole=function(n){if(!this._authenticated)return!1;for(var t=0;t<n.length;t++)if(this.isInRole(n[t]))return!0;return!1},n.prototype.authenticated=function(n){this._identity=n;this._authenticated=n!=null},n.prototype.identity=function(n){var t=this,i;return(n===void 0&&(n=!1),i=this.$q.defer(),n&&(this._identity=undefined),angular.isDefined(this._identity))?(i.resolve(this._identity),i.promise):(this.Person.GetCurrentUser(function(n){var r,u;for(t._identity=n,n.IsAdmin&&t._roles.push("Admin"),(n.IsLeader||n.IsSubstitute)&&t._roles.push("Approver"),n.isLeader&&t._roles.push("Leader"),t._accessibleModules.push("drive"),r=0;r<n.Employments.length;r++)if(u=n.Employments[r],u.OrgUnit.HasAccessToVacation||n.IsAdmin){t._accessibleModules.push("vacation");break}t.$rootScope.CurrentUser=n;t.$rootScope.showAdministration=n.IsAdmin;t.$rootScope.showApproveReports=n.IsLeader||n.IsSubstitute;t.$rootScope.UserName=n.FullName;t.$rootScope.loaded=!0;t._authenticated=!0;i.resolve(t._identity)},function(){t._identity=null;t._authenticated=!1;t._roles=[];t.$rootScope.loaded=!1;i.resolve(t._identity)}),i.promise)},n.$inject=["$q","$rootScope","Person"],n}();n.Principal=t;angular.module("app.core").service("Principal",t)})(t=n.services||(n.services={}))})(t=n.core||(n.core={}))}(app||(app={}));angular.module("app.core").service("Substitute",["$resource",function(n){return n("/odata/Substitutes(:id)?:query",{id:"@id",query:"@query"},{get:{method:"GET",isArray:!1,headers:{Accept:"application/json;odata=fullmetadata"},url:"odata/Substitutes(:id)?$expand=OrgUnit,Sub,Person&:query",data:""},patch:{method:"PATCH",isArray:!1},post:{method:"POST",isArray:!1},remove:{method:"DELETE"},"delete":{method:"DELETE"}})}]);angular.module("app.core").controller("ServiceErrorController",["$scope","$modalInstance","errorMsg",function(n,t,i){n.errorMsg=i;n.close=function(){t.close()}}]);angular.module("app.drive",["app.core","kendo.directives","ui.router","ui.bootstrap","ui.bootstrap.tooltip","ngResource","template/modal/window.html","template/modal/window.html","template/modal/backdrop.html","template/tabs/tab.html","template/tabs/tabset.html","angularMoment","template/popover/popover.html","kendo-ie-fix","angular-loading-bar"]).run(["$rootScope","HelpText",function(){}]);angular.module("app.drive").config(["$stateProvider",function(n){n.state("drive.driving",{url:"/driving",templateUrl:"/App/Drive/Driving/DrivingView.html",controller:"DrivingController",resolve:{adminEditCurrentUser:function(){return 0},ReportId:function(){return-1},$modalInstance:function(){return-1}}}).state("drive.myreports",{url:"/myreports",templateUrl:"/App/Drive/MyReports/MyReportsView.html"}).state("drive.approvereports",{url:"/approvereports",templateUrl:"/App/Drive/ApproveReports/ApproveReportsView.html",data:{roles:["Approver"]}}).state("drive.settings",{url:"/settings",templateUrl:"/App/Drive/Settings/SettingsView.html",controller:"SettingsController"}).state("drive.admin",{url:"/admin",templateUrl:"/App/Drive/Admin/AdminView.html",controller:"AdminMenuController",data:{roles:["Admin"]}})}]);angular.module("app.drive").controller("AdminMenuController",["$scope","Person","PersonalAddress","HelpText","$rootScope",function(n){n.emailClicked=function(){n.$broadcast("emailClicked")};n.ratesClicked=function(){n.$broadcast("ratesClicked")};n.accountClicked=function(){n.$broadcast("accountClicked")};n.orgSettingsClicked=function(){n.$broadcast("orgSettingsClicked")};n.adminClicked=function(){n.$broadcast("administrationClicked")};n.reportsClicked=function(){n.$broadcast("reportsClicked")};n.laundryClicked=function(){n.$broadcast("addressLaundryClicked")}}]);angular.module("app.drive").controller("AccountController",["$scope","$modal","BankAccount","NotificationService","$rootScope",function(n,t,i,r,u){n.AccountHelpText=u.HelpTexts.AccountHelpText.text;n.$on("accountClicked",function(){n.container.accountGrid.dataSource.read()});n.container={};n.maskOptions={mask:"0000000000"};n.PSPMaskOptions={mask:"LL-0000000000-00000"};n.accountTypeChanged=function(){n.newAccountAccountNumber=""};n.accounts={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/BankAccounts",dataType:"json",cache:!1}},pageSize:20,serverPaging:!1,serverSorting:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} konti",empty:"Ingen konti at vise",page:"Side",of:"af {0}",itemsPerPage:"konti pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},scrollable:!1,columns:[{field:"Type",title:"Type",template:function(){return"Kontonummer"}},{field:"Number",title:"Kontonummer"},{field:"Description",title:"Beskrivelse"},{field:"Id",template:"<a ng-click=deleteAccountClick(${Id})>Slet<\/a>",title:"Muligheder"}]};n.updateAccountGrid=function(){n.container.accountGrid.dataSource.read()};n.addNewAccountClick=function(){n.accountNumberErrorMessage="";n.accountDescriptionErrorMessage="";var t=!1;(n.container.newAccountAccountNumber==""||n.container.newAccountAccountNumber==undefined||n.container.newAccountAccountNumber.indexOf("_")>-1)&&(n.accountNumberErrorMessage="* Du skal skrive et gyldigt kontonummer.",t=!0);(n.container.newAccountDescription==""||n.container.newAccountDescription==undefined)&&(n.accountDescriptionErrorMessage="* Du skal skrive en beskrivelse.",t=!0);t||i.post({Description:n.container.newAccountDescription,Number:n.container.newAccountAccountNumber,Type:n.container.newAccountType},function(){n.updateAccountGrid();n.container.newAccountDescription="";n.container.newAccountRegNumber="";n.container.newAccountAccountNumber="";r.AutoFadeNotification("success","","Ny konto oprettet!")})};n.deleteAccountClick=function(r){var u=t.open({templateUrl:"/App/Admin/Account/ConfirmDeleteAccountTemplate.html",controller:"DeleteAccountController",backdrop:"static",resolve:{itemId:function(){return-1}}});u.result.then(function(){i.delete({id:r},function(){n.updateAccountGrid()})})}}]);angular.module("app.drive").controller("DeleteAccountController",["$scope","$modalInstance","itemId","NotificationService",function(n,t,i,r){n.confirmDelete=function(){t.close(n.itemId);r.AutoFadeNotification("success","","Kontoen blev slettet.")};n.cancel=function(){t.dismiss("cancel");r.AutoFadeNotification("warning","","Sletning af kontoen blev annulleret.")}}]);angular.module("app.drive").controller("AddNewAddressController",["$scope","$modalInstance","NotificationService","StandardAddress","AddressFormatter","SmartAdresseSource","$modal",function(n,t,i,r,u,f,e){n.SmartAddress=f;n.confirmSave=function(){var r={};r.address=n.Address.Name;r.description=n.description;t.close(r);i.AutoFadeNotification("success","","Adressen blev oprettet.")};n.cancel=function(){t.dismiss("cancel");i.AutoFadeNotification("warning","","Oprettelse af adressen blev annulleret.")};n.showConfirmDiscardChangesModal=function(){var t=e.open({templateUrl:"/App/Admin/Address/ConfirmDiscardChangesTemplate.html",controller:"ConfirmDiscardChangesController",backdrop:"static"});t.result.then(function(){n.cancel()})};n.cancelClicked=function(){n.description==undefined?n.Address==undefined||n.Address.Name==undefined?n.cancel():n.showConfirmDiscardChangesModal():n.showConfirmDiscardChangesModal()}}]);angular.module("app.drive").controller("DeleteAddressController",["$scope","$modalInstance","itemId","NotificationService","StandardAddress",function(n,t,i,r,u){u.get({id:i}).$promise.then(function(t){var i=t.value[0];n.addressString=i.StreetName+" "+i.StreetNumber+", "+i.ZipCode+" "+i.Town+"."});n.confirmDelete=function(){t.close(n.itemId);r.AutoFadeNotification("success","","Adressen blev slettet.")};n.cancel=function(){t.dismiss("cancel");r.AutoFadeNotification("warning","","Sletning af adressen blev annulleret.")}}]);angular.module("app.drive").controller("EditAddressController",["$scope","$modalInstance","itemId","NotificationService","StandardAddress","SmartAdresseSource","$modal",function(n,t,i,r,u,f,e){n.SmartAddress=f;u.get({id:i}).$promise.then(function(t){var i=t.value[0];n.address=i.StreetName+" "+i.StreetNumber+", "+i.ZipCode+" "+i.Town;n.description=i.Description;n.oldAddress=n.address;n.oldDescription=n.description});n.confirmEdit=function(){var i={};i.address=n.address;i.description=n.description;t.close(i);r.AutoFadeNotification("success","","Adressen blev redigeret.")};n.cancel=function(){t.dismiss("cancel");r.AutoFadeNotification("warning","","Redigering af adressen blev annulleret.")};n.showConfirmDiscardChangesModal=function(){var t=e.open({templateUrl:"/App/Admin/Address/ConfirmDiscardChangesTemplate.html",controller:"ConfirmDiscardChangesController",backdrop:"static"});t.result.then(function(){n.cancel()})};n.cancelClicked=function(){n.address!=n.oldAddress||n.description!=n.oldDescription?n.showConfirmDiscardChangesModal():n.cancel()}}]);angular.module("app.drive").controller("StandardAddressController",["$scope","$modal","StandardAddress","AddressFormatter",function(n,t,i,r){n.gridContainer={};n.loadAddresses=function(){n.addresses={dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/Addresses/Service.GetStandard",dataType:"json",cache:!1}},pageSize:20,serverPaging:!1,serverSorting:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} adresser",empty:"Ingen adresser at vise",page:"Side",of:"af {0}",itemsPerPage:"adresser pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},scrollable:!1,columns:[{field:"StreetName",title:"Vejnavn"},{field:"StreetNumber",title:"Husnummer"},{field:"ZipCode",title:"Postnummer"},{field:"Town",title:"By"},{field:"Description",title:"Beskrivelse"},{field:"Id",template:"<a ng-click=editClick(${Id})>Redigér<\/a> | <a ng-click=deleteClick(${Id})>Slet<\/a>",title:"Muligheder"}]}};n.updateAddressGrid=function(){n.gridContainer.addressGrid.dataSource.read()};n.editClick=function(u){var f=t.open({templateUrl:"/App/Admin/Address/EditAddressTemplate.html",controller:"EditAddressController",backdrop:"static",resolve:{itemId:function(){return u}}});f.result.then(function(t){var f=r.fn(t.address);i.patch({id:u},{StreetName:f.StreetName,StreetNumber:f.StreetNumber,ZipCode:f.ZipCode,Town:f.Town,Description:t.description},function(){n.updateAddressGrid()})})};n.deleteClick=function(r){var u=t.open({templateUrl:"/App/Admin/Address/ConfirmDeleteAddressTemplate.html",controller:"DeleteAddressController",backdrop:"static",resolve:{itemId:function(){return r}}});u.result.then(function(){i.delete({id:r},function(){n.updateAddressGrid()})})};n.addNewClick=function(){var u=t.open({templateUrl:"/App/Admin/Address/AddNewAddressTemplate.html",controller:"AddNewAddressController",backdrop:"static"});u.result.then(function(t){var u=r.fn(t.address);i.post({StreetName:u.StreetName,StreetNumber:u.StreetNumber,ZipCode:u.ZipCode,Town:u.Town,Description:t.description,Latitude:"0",Longitude:"0"},function(){n.updateAddressGrid()})})};n.loadAddresses()}]);angular.module("app.drive").controller("AddressLaundryController",["$scope","SmartAdresseSource","$timeout","Address","AddressFormatter","NotificationService",function(n,t,i,r,u,f){n.container={};n.SmartAddress=t;n.autoCompleteOptions={filter:"contains"};n.$on("addressLaundryClicked",function(){r.GetAutoCompleteDataForCachedAddress().$promise.then(function(t){n.autoCompleteDataSource=t.value});n.container.grid.dataSource.read()});n.addressLocalCopy=[];n.dirtyAddresses={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/Addresses/Service.GetCachedAddresses",dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverSorting:!0,serverFiltering:!0,scrollable:!1},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} addresser",empty:"Ingen addresser at vise",page:"Side",of:"af {0}",itemsPerPage:"addresser pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},scrollable:!1,columns:[{field:"Description",title:"Beskrivelse"},{field:"DirtyString",title:"Beskidt adresse"},{title:"Vasket adresse",template:function(n){return n.IsDirty?"Endnu ikke vasket.":n.StreetName+" "+n.StreetNumber+", "+n.ZipCode+" "+n.Town}},{field:"IsDirty",title:"Vasket",template:function(n){return n.IsDirty?"":'<i class="fa fa-check"><\/i>'}},{title:"Ny adresse",width:300,template:function(n){return"<input type='text' ng-model='addressLocalCopy["+n.Id+"]' kendo-auto-complete k-data-text-field=\"'tekst'\" k-data-value-field=\"'tekst'\" k-data-source='SmartAddress' class='form-control fill-width'/>"}},{title:"Muligheder",template:function(n){return"<a class='pull-right margin-right-10' ng-click=saveClicked('"+n.Id+"')>Gem<\/a>"}}]};n.saveClicked=function(t){var i=u.fn(n.addressLocalCopy[t]);if(i==undefined){f.AutoFadeNotification("warning","","Adressen kunne ikke vaskes.");return}r.AttemptCleanCachedAddress({StreetName:i.StreetName,StreetNumber:i.StreetNumber,ZipCode:i.ZipCode,Town:i.Town,Id:t},function(){f.AutoFadeNotification("success","","Adressen er vasket.");n.container.grid.dataSource.read()},function(){f.AutoFadeNotification("warning","","Adressen kunne ikke vaskes.")})};n.includeCleanChanged=function(){i(function(){n.container.grid.dataSource.transport.options.read.url="/odata/Addresses/Service.GetCachedAddresses?includeCleanAddresses="+n.container.includeClean;n.container.grid.dataSource.read()})};n.descriptionTextChanged=function(){i(function(){var i=n.container.grid.dataSource.filter(),t=[];i==undefined?n.container.descriptionFilter!=""&&t.push({field:"Description",operator:"startswith",value:n.container.descriptionFilter}):(angular.forEach(i.filters,function(n){n.field!="Description"&&t.push(n)}),n.container.descriptionFilter!=""&&t.push({field:"Description",operator:"startswith",value:n.container.descriptionFilter}));n.container.grid.dataSource.filter(t)})};n.dirtyStringTextChanged=function(){i(function(){var i=n.container.grid.dataSource.filter(),t=[];i==undefined?n.container.dirtyStringFilter!=""&&t.push({field:"DirtyString",operator:"startswith",value:n.container.dirtyStringFilter}):(angular.forEach(i.filters,function(n){n.field!="DirtyString"&&t.push(n)}),n.container.dirtyStringFilter!=""&&t.push({field:"DirtyString",operator:"startswith",value:n.container.dirtyStringFilter}));n.container.grid.dataSource.filter(t)})};n.clearClicked=function(){n.container.dirtyStringFilter="";n.container.descriptionFilter="";n.container.grid.dataSource.filter([])}}]);angular.module("app.drive").controller("AdministrationController",["$scope","Person","$modal","NotificationService","File","Autocomplete",function(n,t,i,r,u,f){n.autoCompleteOptions={filter:"contains"};n.nonAdmins=f.nonAdmins();n.$on("administrationClicked",function(){n.gridContainer.grid.dataSource.read()});n.gridContainer={};n.person={};n.admins={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/Person?$filter=IsAdmin",dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverSorting:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} administratorer",empty:"Ingen administratorer at vise",page:"Side",of:"af {0}",itemsPerPage:"administratorer pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},scrollable:!1,columns:[{field:"FullName",title:"Medarbejder"},{field:"Mail",title:"Email"},{title:"Muligheder",template:function(n){return"<a ng-click='removeAdmin("+n.Id+',"'+n.FullName+"\")'>Slet<\/a>"}}]};n.removeAdmin=function(u,f){var e=i.open({templateUrl:"App/Admin/Administration/Modal/RemoveAdminModalTemplate.html",controller:"RemoveAdminModalController",backdrop:"static",size:"lg",resolve:{Id:function(){return u},FullName:function(){return f}}});e.result.then(function(i){t.patch({id:i.Id},{IsAdmin:!1},function(){r.AutoFadeNotification("success","",i.FullName+" blev slettet som administrator.");n.gridContainer.grid.dataSource.read()},function(){r.AutoFadeNotification("danger","",i.FullName+" blev ikke slettet som administrator.")})})};n.addAdminClicked=function(){if(n.person.chosenAdmin!=undefined&&n.person.chosenAdmin[0]!=undefined){var u=i.open({templateUrl:"App/Admin/Administration/Modal/AddAdminModalTemplate.html",controller:"AddAdminModalController",backdrop:"static",size:"lg",resolve:{chosenPerson:function(){return n.person.chosenAdmin[0]}}});u.result.then(function(i){t.patch({id:i.Id},{IsAdmin:!0},function(){r.AutoFadeNotification("success","",i.FullName+" blev gjort til administrator.");n.gridContainer.grid.dataSource.read();n.person.chosenAdmin=""},function(){r.AutoFadeNotification("danger","",i.FullName+" blev ikke gjort til administrator.")})})}};n.generateKMDFileClicked=function(){var n=i.open({templateUrl:"App/Admin/Administration/Modal/ConfirmGenerateFileModalTemplate.html",controller:"GenerateFileModalController",backdrop:"static",size:"lg"});n.result.then(function(){u.generateKMDFile(function(){r.AutoFadeNotification("success","","Fil til KMD blev genereret.")},function(){r.AutoFadeNotification("danger","","Fil til KMD blev ikke genereret.")})})}}]);angular.module("app.drive").controller("AddAdminModalController",["$scope","chosenPerson","$modalInstance",function(n,t,i){n.name=t.FullName;n.confirmAddAdmin=function(){i.close(t)};n.cancelAddAdmin=function(){i.dismiss("cancel")}}]);angular.module("app.drive").controller("GenerateFileModalController",["$scope","$modalInstance",function(n,t){n.confirmGenerateFile=function(){t.close()};n.cancelGenerateFile=function(){t.dismiss("cancel")}}]);angular.module("app.drive").controller("RemoveAdminModalController",["$scope","Id","FullName","$modalInstance",function(n,t,i,r){n.name=i;var u={Id:t,FullName:i};n.confirmRemoveAdmin=function(){r.close(u)};n.cancelRemoveAdmin=function(){r.dismiss("cancel")}}]);angular.module("app.drive").controller("OrgUnitController",["$scope","OrgUnit","NotificationService","$rootScope","Person","Autocomplete",function(n,t,i,r,u,f){function e(n,f){var o=f.model.Id,e=[{name:"Beregnet",value:"Calculated"},{name:"Aflæst",value:"Read"},{name:"Beregnet uden merkørsel",value:"CalculatedWithoutExtraDistance"}],s=new kendo.data.DataSource({data:e});$('<input required data-text-field="name" data-value-field="value" data-bind="value:'+f.field+'"/>').appendTo(n).kendoDropDownList({autoBind:!1,dataSource:s,change:function(n){t.patch({id:o},{DefaultKilometerAllowance:e[n.sender.selectedIndex].value}).$promise.then(function(){i.AutoFadeNotification("success","","Opdaterede organisationen");u.GetCurrentUser().$promise.then(function(n){r.CurrentUser=n})})}})}n.gridContainer={};n.orgUnits=f.orgUnits();n.orgUnit={};n.selectedKmRule=-1;n.updateSourceUrl=function(){var t="/odata/OrgUnits";Object.keys(n.orgUnit).length!==0?(t+="?$filter=contains(LongDescription,'"+encodeURIComponent(n.orgUnit.chosenUnit+"')"),n.selectedKmRule!==-1&&(t+=" and HasAccessToFourKmRule eq "+(n.selectedKmRule===0?"false":"true"))):n.selectedKmRule!==-1&&(t+="?$filter=HasAccessToFourKmRule eq "+(n.selectedKmRule===0?"false":"true"));n.gridContainer.grid.dataSource.transport.options.read.url=t;n.gridContainer.grid.dataSource.read()};n.autoCompleteOptions={filter:"contains",select:function(t){n.orgUnit.chosenId=this.dataItem(t.item.index()).Id}};n.kmRuleOptions={dataSource:{data:[{value:-1,text:"Alle"},{value:1,text:"Bruger 4 km-reglen"},{value:0,text:"Bruger ikke 4 km-reglen"}]},dataTextField:"text",dataValueField:"value",select:function(t){var i=this.dataItem(t.item).value;n.selectedKmRule=i;n.updateSourceUrl()},clear:function(){this.dataSource.read()}};n.$on("orgSettingsClicked",function(){n.gridContainer.grid.dataSource.read()});n.OrgUnits={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/OrgUnits",dataType:"json",cache:!1}},schema:{model:{fields:{OrgId:{editable:!1},ShortDescription:{editable:!1},LongDescription:{editable:!1},HasAccessToFourKmRule:{editable:!1},DefaultKilometerAllowance:{type:"string"}}}},pageSize:20,serverPaging:!0,serverFiltering:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} organisationsenheder",empty:"Ingen organisationsenheder at vise",page:"Side",of:"af {0}",itemsPerPage:"Organisationsenheder pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},editable:!0,columns:[{field:"OrgId",title:"Organisations ID"},{field:"ShortDescription",title:"Kort beskrivelse"},{field:"LongDescription",title:"Lang beskrivelse"},{field:"HasAccessToFourKmRule",title:"Kan benytte 4 km-regel",template:function(n){return n.HasAccessToFourKmRule?"<input type='checkbox' ng-click='rowChecked("+n.Id+", false)' checked><\/input>":"<input type='checkbox' ng-click='rowChecked("+n.Id+", true)'><\/input>"}},{field:"DefaultKilometerAllowance",title:"Standard kilometeropgørelse",editor:e,template:function(n){return n.DefaultKilometerAllowance==="Calculated"?"Beregnet":n.DefaultKilometerAllowance==="Read"?"Aflæst":n.DefaultKilometerAllowance==="CalculatedWithoutExtraDistance"?"Beregnet uden merkørsel":"Fejl"}}]};n.rowChecked=function(n,f){t.patch({id:n},{HasAccessToFourKmRule:f}).$promise.then(function(){f?i.AutoFadeNotification("success","","Adgang til 4 km-regel tilføjet."):i.AutoFadeNotification("success","","Adgang til 4 km-regel fjernet.");u.GetCurrentUser().$promise.then(function(n){r.CurrentUser=n})})};n.orgUnitChanged=function(){n.updateSourceUrl()};n.clearClicked=function(){n.selectedKmRule=-1;n.gridContainer.kmRule.select(0);n.orgUnit.chosenUnit="";n.gridContainer.grid.dataSource.transport.options.read.url="/odata/OrgUnits";n.gridContainer.grid.dataSource.read()}}]);angular.module("app.drive").controller("RateController",["$scope","$modal","Rate","NotificationService","RateType",function(n,t,i,r,u){n.container={};n.$on("ratesClicked",function(){n.container.rateGrid.dataSource.read()});n.rates={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/Rates?$expand=Type&$filter=Active eq true",dataType:"json",cache:!1}},pageSize:20,serverPaging:!1,serverSorting:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} takster",empty:"Ingen takster at vise",page:"Side",of:"af {0}",itemsPerPage:"takster pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},scrollable:!1,columns:[{field:"Year",title:"År"},{field:"KmRate",title:"Takst",template:"${KmRate} ører pr/km"},{field:"Type.TFCode",title:"TF kode"},{field:"Type",title:"Type",template:function(n){return n.Type.Description}}]};n.updateRatesGrid=function(){n.container.rateGrid.dataSource.read()};n.$on("kendoWidgetCreated",function(t,i){i===n.container.rateDropDown&&(n.rateTypes=u.get(function(){angular.forEach(n.rateTypes,function(n){n.Description+=" ("+n.TFCode+")"});n.container.rateDropDown.dataSource.read();n.container.rateDropDown.select(0)}))});n.addNewRateClick=function(){n.newRateYearError="";n.newRateRateError="";n.newRateTFCodeError="";n.newRateRateTypeError="";var t=!1;(n.container.newRateYear==""||n.container.newRateYear==undefined||n.container.newRateYear.toString().length!=4)&&(n.newRateYearError="* Du skal skrive et gyldigt år.",t=!0);(n.container.newRateRate==""||n.container.newRateRate==undefined)&&(n.newRateRateError="* Du skal skrive en gyldig takst.",t=!0);(n.container.newRateRateType==""||n.container.newRateRateType==undefined)&&(n.newRateRateTypeError="* Du skal vælge en gyldig taksttype.",t=!0);t||i.post({Year:n.container.newRateYear,TFCode:n.container.newRateTFCode,KmRate:n.container.newRateRate,TypeId:n.container.newRateRateType,Active:!0},function(){n.updateRatesGrid();n.container.newRateYear="";n.container.newRateRate="";r.AutoFadeNotification("success","","Ny takst oprettet!")})}}]);angular.module("app.drive").controller("AdminAcceptedReportsController",["$scope","$modal","$rootScope","Report","OrgUnit","Person","$timeout","NotificationService","BankAccount","RateType","Autocomplete","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o,s,h,c,l,a){var k=i.CurrentUser.Id,y,v,p,b,w;n.tableSortHelp=i.HelpTexts.TableSortHelp.text;n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.filter(y(t,i,n.person.chosenPerson,n.orgUnit.chosenUnit))};y=function(n,t,i,r){var u=[];return u.push({field:"DriveDateTimestamp",operator:"ge",value:n}),u.push({field:"DriveDateTimestamp",operator:"le",value:t}),i!=undefined&&i!=""&&u.push({field:"FullName",operator:"eq",value:i}),r!=undefined&&r!=""&&u.push({field:"Employment.OrgUnit.LongDescription",operator:"eq",value:r}),u};n.orgUnitAutoCompleteOptions={filter:"contains",select:function(t){n.orgUnit.chosenId=this.dataItem(t.item.index()).Id}};n.personAutoCompleteOptions={filter:"contains",select:function(t){n.person.chosenId=this.dataItem(t.item.index()).Id}};v=new Date;v.setDate(v.getDate()-30);v=n.getStartOfDayStamp(v);p=n.getEndOfDayStamp(new Date);n.checkboxes={};n.checkboxes.showSubbed=!1;b=[];h.getAll().$promise.then(function(t){n.rateTypes=t});n.orgUnit={};n.orgUnits=[];n.people=[];n.person={};n.orgUnits=c.orgUnits();n.people=c.allUsers();n.clearClicked=function(){n.loadInitialDates();n.person.chosenPerson="";n.orgUnit.chosenUnit="";n.searchClicked()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=w(t,i,n.person.chosenPerson,n.orgUnit.chosenUnit);n.gridContainer.grid.dataSource.read()};w=function(t,i,r,u){var f="&$filter=DriveDateTimestamp ge "+t+" and DriveDateTimestamp le "+i;return r!=undefined&&r!=""&&(f+=" and PersonId eq "+n.person.chosenId),u!=undefined&&u!=""&&(f+=" and Employment/OrgUnitId eq "+n.orgUnit.chosenId),"/odata/DriveReports?status=Accepted &getReportsWhereSubExists=true &$expand=DriveReportPoints,ApprovedBy,Employment($expand=OrgUnit)"+f};n.Reports={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/DriveReports?status=Accepted &getReportsWhereSubExists=true &$expand=DriveReportPoints,ApprovedBy,Employment($expand=OrgUnit) &$filter=DriveDateTimestamp ge "+v+" and DriveDateTimestamp le "+p,dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"DriveDateTimestamp",dir:"desc"},aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"},]},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"FullName",title:"Medarbejder"},{field:"Employment.OrgUnit.LongDescription",title:"Org.enhed"},{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return a.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km"},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr."},{field:"KilometerAllowance",title:"MK",template:function(n){return l.format(n)}},{field:"FourKmRule",title:"4 km",template:function(n){return n.FourKmRule?"<i class='fa fa-check'><\/i>":""}},{field:"CreatedDateTimestamp",title:"Indberettet",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"ClosedDateTimestamp",title:"Godkendt dato",template:function(n){var t=moment.unix(n.ClosedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"ApprovedBy.FullName",title:"Godkendt af"},{field:"ProcessedDateTimestamp",title:"Overført til udbetaling",template:function(n){if(n.ProcessedDateTimestamp!=0&&n.ProcessedDateTimestamp!=null&&n.ProcessedDateTimestamp!=undefined){var t=moment.unix(n.ProcessedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}return""}},{title:"Anden kontering",field:"AccountNumber",template:function(t){if(t.AccountNumber!=null&&t.AccountNumber!=0&&t.AccountNumber!=undefined){var i="";return angular.forEach(n.bankAccounts,function(n){n.Number==t.AccountNumber&&(i="Ja <div class='inline' kendo-tooltip k-content=\"'"+n.Description+" - "+n.Number+"'\"> <i class='fa fa-comment-o'><\/i><\/div>")}),i}return"Nej"}},{field:"Id",title:"Muligheder",template:function(n){return n.Status=="Accepted"?"<a ng-click=rejectClick("+n.Id+")>Afvis<\/a> | <a ng-click=editClick("+n.Id+")>Rediger<\/a>":"Er kørt til løn."}}],scrollable:!1};n.editClick=function(u){var e=t.open({templateUrl:"/App/Drive/MyReports/EditReportTemplate.html",controller:"DrivingController",backdrop:"static",windowClass:"app-modal-window-full",resolve:{ReportId:function(){return u},adminEditCurrentUser:function(){return r.getOwner({id:u}).$promise.then(function(n){return f.GetUserAsCurrentUser({id:n.Id}).$promise.then(function(n){return n})})}}});i.editModalInstance=e;e.result.then(function(){n.gridContainer.grid.dataSource.read()})};n.rejectClick=function(i){var u=t.open({templateUrl:"/App/Drive/Admin/Reports/Modal/ConfirmRejectApprovedReportTemplate.html",controller:"ConfirmRejectApprovedReportModalController",backdrop:"static",resolve:{itemId:function(){return i}}});u.result.then(function(t){t==undefined&&(t="Ingen besked.");r.patch({id:i,emailText:t},function(){n.gridContainer.grid.dataSource.read()})})};n.loadInitialDates=function(){initialLoad=2;var t=new Date;t.setDate(t.getDate()-30);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.clearName=function(){n.chosenPerson=""};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Drive/Admin/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})};n.refreshGrid=function(){n.bankAccounts==undefined&&s.get().$promise.then(function(t){n.bankAccounts=t.value});n.gridContainer.grid.dataSource.read()};n.gridContainer={};n.dateContainer={};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"}}]);angular.module("app.drive").controller("AdminPendingReportsController",["$scope","$modal","$rootScope","Report","OrgUnit","Person","$timeout","NotificationService","RateType","Autocomplete","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o,s,h,c,l){var p,v,a,y,w;n.gridContainer={};n.dateContainer={};n.people=[];n.person={};n.orgUnit={};n.orgUnits=[];n.tableSortHelp=i.HelpTexts.TableSortHelp.text;p=i.CurrentUser.Id;n.orgUnits=h.orgUnits();n.people=h.allUsers();n.clearClicked=function(){n.loadInitialDates();n.person.chosenPerson="";n.orgUnit.chosenUnit="";n.searchClicked()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=v(t,i,n.person.chosenPerson,n.orgUnit.chosenUnit);n.gridContainer.grid.dataSource.read()};v=function(t,i,r,u){var f="&$filter=DriveDateTimestamp ge "+t+" and DriveDateTimestamp le "+i;return r!=undefined&&r!=""&&(f+=" and PersonId eq "+n.person.chosenId),u!=undefined&&u!=""&&(f+=" and Employment/OrgUnitId eq "+n.orgUnit.chosenId),"/odata/DriveReports?status=Pending &getReportsWhereSubExists=true &$expand=DriveReportPoints,ResponsibleLeader,Employment($expand=OrgUnit)"+f};s.getAll().$promise.then(function(t){n.rateTypes=t});n.orgUnitAutoCompleteOptions={filter:"contains",select:function(t){n.orgUnit.chosenId=this.dataItem(t.item.index()).Id}};n.personAutoCompleteOptions={filter:"contains",select:function(t){n.person.chosenId=this.dataItem(t.item.index()).Id}};n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};a=new Date;a.setDate(a.getDate()-365);a=n.getStartOfDayStamp(a);y=n.getEndOfDayStamp(new Date);w=[];n.Reports={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/DriveReports?status=Pending &getReportsWhereSubExists=true &$expand=DriveReportPoints,ResponsibleLeader,Employment($expand=OrgUnit) &$filter=DriveDateTimestamp ge "+a+" and DriveDateTimestamp le "+y,dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"DriveDateTimestamp",dir:"desc"},aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"},]},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"FullName",title:"Medarbejder"},{field:"Employment.OrgUnit.LongDescription",title:"Org.enhed"},{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return l.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km"},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr."},{field:"KilometerAllowance",title:"MK",template:function(n){return c.format(n)}},{field:"FourKmRule",title:"4 km",template:function(n){return n.FourKmRule?"<i class='fa fa-check'><\/i>":""}},{field:"CreatedDateTimestamp",title:"Indberettet",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{title:"Godkender",field:"ResponsibleLeader.FullName",template:function(n){return n.ResponsibleLeader!=0&&n.ResponsibleLeader!=null&&n.ResponsibleLeader!=undefined?n.ResponsibleLeader.FullName:""}}],scrollable:!1};n.$on("reportsClicked",function(){n.gridContainer.grid!=undefined&&n.gridContainer.grid.dataSource.read()});n.loadInitialDates=function(){var t=new Date;t.setDate(t.getDate()-365);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.clearName=function(){n.chosenPerson=""};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Admin/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})};n.refreshGrid=function(){n.gridContainer.grid.dataSource.read()};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"};n.personChanged=function(){};n.person.chosenPerson=""}]);angular.module("app.drive").controller("AdminRejectedReportsController",["$scope","$modal","$rootScope","Report","OrgUnit","Person","$timeout","NotificationService","RateType","Autocomplete","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o,s,h,c,l){var p=i.CurrentUser.Id,v,a,y;n.tableSortHelp=i.HelpTexts.TableSortHelp.text;s.getAll().$promise.then(function(t){n.rateTypes=t});n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};n.orgUnitAutoCompleteOptions={filter:"contains",select:function(t){n.orgUnit.chosenId=this.dataItem(t.item.index()).Id}};n.personAutoCompleteOptions={filter:"contains",select:function(t){n.person.chosenId=this.dataItem(t.item.index()).Id}};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=v(t,i,n.person.chosenPerson,n.orgUnit.chosenUnit);n.gridContainer.grid.dataSource.read()};v=function(t,i,r,u){var f="&$filter=DriveDateTimestamp ge "+t+" and DriveDateTimestamp le "+i;return r!=undefined&&r!=""&&(f+=" and PersonId eq "+n.person.chosenId),u!=undefined&&u!=""&&(f+=" and Employment/OrgUnitId eq "+n.orgUnit.chosenId),"/odata/DriveReports?status=Rejected &getReportsWhereSubExists=true &$expand=DriveReportPoints,ApprovedBy,Employment($expand=OrgUnit)"+f};a=new Date;a.setDate(a.getDate()-30);a=n.getStartOfDayStamp(a);y=n.getEndOfDayStamp(new Date);n.checkboxes={};n.checkboxes.showSubbed=!1;n.orgUnit={};n.orgUnits=[];n.people=[];n.person={};n.orgUnits=h.orgUnits();n.people=h.allUsers();n.Reports={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/DriveReports?status=Rejected &getReportsWhereSubExists=true &$expand=DriveReportPoints,ApprovedBy,Employment($expand=OrgUnit) &$filter=DriveDateTimestamp ge "+a+" and DriveDateTimestamp le "+y,dataType:"json",cache:!1}},pageSize:20,serverPaging:!1,serverSorting:!0,sort:{field:"DriveDateTimestamp",dir:"desc"},aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"},]},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"FullName",title:"Medarbejder"},{field:"Employment.OrgUnit.LongDescription",title:"Org.enhed"},{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return l.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km"},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr."},{field:"KilometerAllowance",title:"MK",template:function(n){return c.format(n)}},{field:"FourKmRule",title:"4 km",template:function(n){return n.FourKmRule?"<i class='fa fa-check'><\/i>":""}},{field:"CreatedDateTimestamp",title:"Indberettet",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"ClosedDateTimestamp",title:"Afvist dato",template:function(n){var t=moment.unix(n.ClosedDateTimestamp),i=t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear();return i+"<div class='inline' kendo-tooltip k-content=\"'"+n.Comment+"'\"> <i class='fa fa-comment-o'><\/i><\/div>"}},{field:"ApprovedBy.FullName",title:"Afvist af"}],scrollable:!1};n.loadInitialDates=function(){initialLoad=2;var t=new Date;t.setDate(t.getDate()-30);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.clearName=function(){n.chosenPerson=""};n.clearClicked=function(){n.loadInitialDates();n.person.chosenPerson="";n.orgUnit.chosenUnit="";n.searchClicked()};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Admin/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})};n.refreshGrid=function(){n.gridContainer.grid.dataSource.read()};n.gridContainer={};n.dateContainer={};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"}}]);angular.module("app.drive").controller("ConfirmEditApprovedReportModalController",["$scope","$modalInstance","DriveReport","$rootScope",function(n,t){n.confirmClicked=function(){t.close(n.emailText)};n.cancelClicked=function(){t.dismiss()}}]);angular.module("app.drive").controller("ConfirmRejectApprovedReportModalController",["$scope","$modalInstance","DriveReport","$rootScope",function(n,t){n.confirmClicked=function(){console.log("confirm");t.close(n.emailText)};n.cancelClicked=function(){console.log("cancel");t.dismiss()}}]);angular.module("app.drive").controller("ShowRouteModalController",["$scope","$modalInstance","routeId","DriveReport","$rootScope",function(n,t,i,r,u){var f=r.getWithPoints({id:i},function(n){OS2RouteMap.create({id:"map",routeToken:u.HelpTexts.SEPTIMA_API_KEY.text});OS2RouteMap.viewRoute(n.RouteGeometry,!0)});n.closeClicked=function(){t.dismiss("cancel")}}]);angular.module("app.drive").controller("AcceptedReportsController",["$scope","$modal","$rootScope","Report","OrgUnit","Person","$timeout","NotificationService","BankAccount","RateType","Autocomplete","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o,s,h,c,l,a){var w=i.CurrentUser.Id,v,y,b,p;n.isLeader=i.CurrentUser.IsLeader;n.tableSortHelp=i.HelpTexts.TableSortHelp.text;n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};n.orgUnitAutoCompleteOptions={filter:"contains",select:function(t){n.orgUnit.chosenId=this.dataItem(t.item.index()).Id}};n.personAutoCompleteOptions={filter:"contains",select:function(t){n.person.chosenId=this.dataItem(t.item.index()).Id}};h.getAll().$promise.then(function(t){n.rateTypes=t});v=new Date;v.setYear(v.getYear()-1);v=n.getStartOfDayStamp(v);y=n.getEndOfDayStamp(new Date);n.checkboxes={};n.checkboxes.showSubbed=!1;b=[];n.orgUnit={};n.orgUnits=c.orgUnits();n.people=c.activeUsers();n.person={};n.showSubsChanged=function(){n.searchClicked()};n.clearClicked=function(){n.loadInitialDates();n.person.chosenPerson="";n.orgUnit.chosenUnit="";n.searchClicked()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=p(t,i,n.person.chosenPerson,n.orgUnit.chosenUnit);n.gridContainer.grid.dataSource.read()};p=function(t,i,r,u){var o="/odata/DriveReports?leaderId="+w+"&status=Accepted&getReportsWhereSubExists="+n.checkboxes.showSubbed+" &$expand=Employment($expand=OrgUnit),DriveReportPoints",f="&$filter=DriveDateTimestamp ge "+t+" and DriveDateTimestamp le "+i,e=" and ResponsibleLeaderId eq "+n.CurrentUser.Id;return n.checkboxes.showSubbed&&(e=" and (ResponsibleLeaderId eq "+n.CurrentUser.Id+" or ActualLeaderId eq "+n.CurrentUser.Id+")"),r!=undefined&&r!=""&&(f+=" and PersonId eq "+n.person.chosenId),u!=undefined&&u!=""&&(f+=" and Employment/OrgUnitId eq "+n.orgUnit.chosenId),f+=e,o+f};n.reports={autoBind:!1,dataSource:{sort:{field:"DriveDateTimestamp",dir:"desc"},type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/DriveReports?status=Accepted &$expand=Employment($expand=OrgUnit),DriveReportPoints &$filter=DriveDateTimestamp ge "+v+" and DriveDateTimestamp le "+y+" and ResponsibleLeaderId eq "+n.CurrentUser.Id,dataType:"json",cache:!1}},pageSize:50,serverPaging:!0,serverAggregates:!1,serverSorting:!0,aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"}]},sortable:!0,scrollable:!1,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"FullName",title:"Medarbejder",template:function(n){return n.FullName+" ["+n.Employment.EmploymentId+"]"}},{field:"Employment.OrgUnit.LongDescription",title:"Org.enhed"},{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return a.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km"},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr."},{field:"KilometerAllowance",title:"MK",template:function(n){return l.format(n)}},{field:"FourKmRule",title:"4 km",template:function(n){return n.FourKmRule?"<i class='fa fa-check'><\/i>":""}},{field:"CreatedDateTimestamp",title:"Indberettet",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"ClosedDateTimestamp",title:"Godkendt dato",template:function(n){var t=moment.unix(n.ClosedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"ProcessedDateTimestamp",title:"Afsendt til løn",template:function(n){if(n.ProcessedDateTimestamp!=0&&n.ProcessedDateTimestamp!=null&&n.ProcessedDateTimestamp!=undefined){var t=moment.unix(n.ProcessedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}return""}},{title:"Anden kontering",field:"AccountNumber",template:function(t){if(t.AccountNumber!=null&&t.AccountNumber!=0&&t.AccountNumber!=undefined){var i="";return angular.forEach(n.bankAccounts,function(n){n.Number==t.AccountNumber&&(i="Ja <div class='inline' kendo-tooltip k-content=\"'"+n.Description+" - "+n.Number+"'\"> <i class='fa fa-comment-o'><\/i><\/div>")}),i}return"Nej"}}]};n.loadInitialDates=function(){var t=new Date;t.setYear(t.getYear()-1);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.clearName=function(){n.chosenPerson=""};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Drive/Admin/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})};n.gridContainer={};n.dateContainer={};n.refreshGrid=function(){n.gridContainer.grid.dataSource.read()};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"};s.get().$promise.then(function(t){n.bankAccounts=t.value})}]);angular.module("app.drive").controller("ApproveReportsController",["$scope",function(){}]);__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(){"use strict";var t=n.core.controllers.BaseApproveReportsSettingsController,i=n.core.models.ReportType,r=function(n){function t(t,r,u,f,e,o){n.call(this,t,r,u,f,e,o,i.Drive);this.$scope=t;this.Person=r;this.$rootScope=u;this.Autocomplete=f;this.$modal=e;this.moment=o}return __extends(t,n),t.$inject=["$scope","Person","$rootScope","Autocomplete","$modal","moment"],t}(t);angular.module("app.drive").controller("ApproveReportsSettingsController",r)})(t=n.drive||(n.drive={}))}(app||(app={}));angular.module("app.drive").controller("PendingReportsController",["$scope","$modal","$rootScope","Report","OrgUnit","Person","$timeout","NotificationService","RateType","OrgUnit","Person","Autocomplete","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o,s,u,f,h,c,l){function k(){if(a.length==0)o.AutoFadeNotification("danger","","Ingen indberetninger er markerede!");else{var u=t.open({templateUrl:"/App/Drive/ApproveReports/Modals/ConfirmApproveSelectedWithAccountTemplate.html",controller:"AcceptWithAccountController",backdrop:"static",resolve:{itemId:function(){return-1},pageNumber:-1}});u.result.then(function(t){angular.forEach(a,function(u){n.loadingPromise=r.patch({id:u,emailText:"Ingen besked"},{Status:"Accepted",ClosedDateTimestamp:moment().unix(),AccountNumber:t,ApprovedById:i.CurrentUser.Id},function(){n.gridContainer.grid.dataSource.read()}).$promise});a=[]})}}function d(){if(a.length==0)o.AutoFadeNotification("danger","","Ingen indberetninger er markerede!");else{var u=t.open({templateUrl:"/App/Drive/ApproveReports/Modals/ConfirmApproveSelectedTemplate.html",controller:"AcceptController",backdrop:"static",resolve:{itemId:function(){return-1},pageNumber:-1}});u.result.then(function(){angular.forEach(a,function(t){n.loadingPromise=r.patch({id:t,emailText:"Ingen besked"},{Status:"Accepted",ClosedDateTimestamp:moment().unix(),ApprovedById:i.CurrentUser.Id},function(){n.gridContainer.grid.dataSource.read()}).$promise});a=[]})}}var b,v,p,a,y,w;n.people=h.activeUsers();n.orgUnits=h.orgUnits();n.person={};n.orgUnit={};n.loadingPromise=null;n.gridContainer={};n.dateContainer={};n.tableSortHelp=i.HelpTexts.TableSortHelp.text;b=i.CurrentUser.Id;n.isLeader=i.CurrentUser.IsLeader;n.orgUnitAutoCompleteOptions={filter:"contains",select:function(t){n.orgUnit.chosenId=this.dataItem(t.item.index()).Id}};n.personAutoCompleteOptions={filter:"contains",select:function(t){n.person.chosenId=this.dataItem(t.item.index()).Id}};n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};v=new Date;v.setYear(v.getYear()-2);v=n.getStartOfDayStamp(v);p=n.getEndOfDayStamp(new Date);n.checkAllBox={};n.checkboxes={};n.checkboxes.showSubbed=!1;a=[];y=[];n.approveSelectedToolbar={resizable:!1,items:[{type:"splitButton",text:"Godkend markerede",click:d,menuButtons:[{text:"Godkend markerede med anden kontering",click:k}]}]};n.clearClicked=function(){n.loadInitialDates();n.person.chosenPerson="";n.orgUnit.chosenUnit="";n.searchClicked()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=w(t,i,n.person.chosenPerson,n.orgUnit.chosenUnit);n.gridContainer.grid.dataSource.read()};w=function(t,i,r,u){var e=" and ResponsibleLeaderId eq "+n.CurrentUser.Id,f;return n.checkboxes.showSubbed&&(e=" and (ResponsibleLeaderId eq "+n.CurrentUser.Id+" or ActualLeaderId eq "+n.CurrentUser.Id+")"),f="&$filter=DriveDateTimestamp ge "+t+" and DriveDateTimestamp le "+i,r!=undefined&&r!=""&&(f+=" and PersonId eq "+n.person.chosenId),u!=undefined&&u!=""&&(f+=" and Employment/OrgUnitId eq "+n.orgUnit.chosenId),f+=e,"/odata/DriveReports?status=Pending &$expand=Employment($expand=OrgUnit),DriveReportPoints,ResponsibleLeader"+f};n.showSubsChanged=function(){n.searchClicked()};n.reports={dataSource:{type:"odata-v4",transport:{read:{url:"/odata/DriveReports?status=Pending &$expand=Employment($expand=OrgUnit),DriveReportPoints,ResponsibleLeader &$filter=DriveDateTimestamp ge "+v+" and DriveDateTimestamp le "+p+" and ResponsibleLeaderId eq "+n.CurrentUser.Id,dataType:"json",cache:!1}},pageSize:50,serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"DriveDateTimestamp",dir:"desc"},aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"},]},sortable:!0,resizable:!0,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},scrollable:!1,dataBinding:function(){a=[];n.checkAllBox.isChecked=!1;var t=n.checkboxes.showSubbed;n.checkboxes={};n.checkboxes.showSubbed=t},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"FullName",title:"Medarbejder",template:function(n){return n.FullName+" ["+n.Employment.EmploymentId+"]"}},{field:"Employment.OrgUnit.LongDescription",title:"Org.enhed"},{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return l.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km"},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr."},{field:"KilometerAllowance",title:"MK",template:function(n){return c.format(n)}},{field:"FourKmRule",title:"4 km",template:function(n){return n.FourKmRule?"<i class='fa fa-check'><\/i>":""}},{field:"CreatedDateTimestamp",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Indberettet"},{sortable:!1,field:"Id",template:function(n){return n.ResponsibleLeader.Id==n.PersonId?"Indberetning skal godkendes af din leder eller opsat personlig godkender.":n.ResponsibleLeader.Id==i.CurrentUser.Id?"<a ng-click=approveClick("+n.Id+")>Godkend<\/a> | <a ng-click=rejectClick("+n.Id+")>Afvis<\/a> <div class='pull-right'><input type='checkbox' ng-model='checkboxes["+n.Id+"]' ng-change='rowChecked("+n.Id+")'><\/input><\/div>":n.ResponsibleLeader.FullName+" er udpeget som godkender."},headerTemplate:"<div class='fill-width' kendo-toolbar k-options='approveSelectedToolbar'><\/div><div style=\"padding-right: 1px !important;padding-left: 0;padding-top: 6px;padding-bottom:3px;\" class='pull-right inline'><input class='pull-right' style='margin: 0' ng-change='checkAllBoxesOnPage()' type='checkbox' ng-model='checkAllBox.isChecked'><\/input><span class='margin-right-5 pull-right'>Marker alle<\/span><\/div> ",footerTemplate:"<div class='pull-right fill-width' kendo-toolbar k-options='approveSelectedToolbar'><\/div>"}]};n.checkAllBoxesOnPage=function(){n.checkAllBox.isChecked?(a=[],angular.forEach(y,function(t){var i=t.Id;n.checkboxes[i]=!0;a.push(i)})):angular.forEach(y,function(t){var i=t.Id,r;n.checkboxes[i]=!1;r=a.indexOf(i);a.splice(r,1)})};n.rowChecked=function(t){if(n.checkboxes[t])a.push(t);else{var i=a.indexOf(t);a.splice(i,1)}};n.loadInitialDates=function(){var t=new Date;t.setYear(t.getYear()-2);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.clearName=function(){n.chosenPerson=""};n.approveClick=function(u){var f=t.open({templateUrl:"/App/Drive/ApproveReports/Modals/ConfirmApproveTemplate.html",controller:"AcceptController",backdrop:"static",resolve:{itemId:function(){return u},pageNumber:-1}});f.result.then(function(){n.loadingPromise=r.patch({id:u,emailText:"Ingen besked"},{Status:"Accepted",ClosedDateTimestamp:moment().unix(),ApprovedById:i.CurrentUser.Id},function(){n.gridContainer.grid.dataSource.read()}).$promise})};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Drive/Admin/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})};n.rejectClick=function(u){var f=t.open({templateUrl:"/App/Core/Views/Modals/ConfirmRejectReport.html",controller:"RejectReportModalInstanceController",backdrop:"static",resolve:{itemId:function(){return u}}});f.result.then(function(t){n.loadingPromise=r.patch({id:u,emailText:"Ingen besked"},{Status:"Rejected",ClosedDateTimestamp:moment().unix(),Comment:t.Comment,ApprovedById:i.CurrentUser.Id},function(){n.gridContainer.grid.dataSource.read();o.AutoFadeNotification("success","","Indberetningen blev afvist.")}).$promise})};n.refreshGrid=function(){n.gridContainer.grid.dataSource.read()};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"};n.person.chosenPerson="";s.getAll().$promise.then(function(t){n.rateTypes=t})}]);angular.module("app.drive").controller("RejectedReportsController",["$scope","$modal","$rootScope","Report","OrgUnit","Person","$timeout","NotificationService","RateType","Autocomplete","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o,s,h,c,l){var v=i.CurrentUser.Id,w,a,y,p;n.isLeader=i.CurrentUser.IsLeader;w=[];n.tableSortHelp=i.HelpTexts.TableSortHelp.text;n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};n.orgUnitAutoCompleteOptions={filter:"contains",select:function(t){n.orgUnit.chosenId=this.dataItem(t.item.index()).Id}};n.personAutoCompleteOptions={filter:"contains",select:function(t){n.person.chosenId=this.dataItem(t.item.index()).Id}};s.getAll().$promise.then(function(t){n.rateTypes=t});a=new Date;a.setYear(a.getYear()-1);a=n.getStartOfDayStamp(a);y=n.getEndOfDayStamp(new Date);n.checkboxes={};n.checkboxes.showSubbed=!1;n.orgUnit={};n.orgUnits=h.orgUnits();n.people=h.activeUsers();n.person={};n.clearClicked=function(){n.loadInitialDates();n.person.chosenPerson="";n.orgUnit.chosenUnit="";n.searchClicked()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=p(t,i,n.person.chosenPerson,n.orgUnit.chosenUnit);n.gridContainer.grid.dataSource.read()};p=function(t,i,r,u){var o="/odata/DriveReports?leaderId="+v+"&status=Rejected&getReportsWhereSubExists="+n.checkboxes.showSubbed+" &$expand=Employment($expand=OrgUnit),DriveReportPoints",f="&$filter=DriveDateTimestamp ge "+t+" and DriveDateTimestamp le "+i,e=" and ResponsibleLeaderId eq "+n.CurrentUser.Id;return n.checkboxes.showSubbed&&(e=" and (ResponsibleLeaderId eq "+n.CurrentUser.Id+" or ActualLeaderId eq "+n.CurrentUser.Id+")"),r!=undefined&&r!=""&&(f+=" and PersonId eq "+n.person.chosenId),u!=undefined&&u!=""&&(f+=" and Employment/OrgUnitId eq "+n.orgUnit.chosenId),f+=e,o+f};n.showSubsChanged=function(){n.searchClicked()};n.reports={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:"/odata/DriveReports?leaderId="+v+"&status=Rejected&getReportsWhereSubExists="+n.checkboxes.showSubbed+" &$expand=Employment($expand=OrgUnit),DriveReportPoints &$filter=DriveDateTimestamp ge "+a+" and DriveDateTimestamp le "+y+" and ResponsibleLeaderId eq "+n.CurrentUser.Id,dataType:"json",cache:!1}},pageSize:50,serverPaging:!0,serverSorting:!0,serverFiltering:!0,sort:{field:"DriveDateTimestamp",dir:"desc"},aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"},]},sortable:!0,scrollable:!1,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"FullName",title:"Medarbejder",template:function(n){return n.FullName+" ["+n.Employment.EmploymentId+"]"}},{field:"Employment.OrgUnit.LongDescription",title:"Org.enhed"},{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return l.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km"},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr."},{field:"KilometerAllowance",title:"MK",template:function(n){return c.format(n)}},{field:"FourKmRule",title:"4 km",template:function(n){return n.FourKmRule?"<i class='fa fa-check'><\/i>":""}},{field:"CreatedDateTimestamp",title:"Indberettet",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"ClosedDateTimestamp",title:"Afvist dato",template:function(n){var t=moment.unix(n.ClosedDateTimestamp),i=t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear();return i+"<div class='inline' kendo-tooltip k-content=\"'"+n.Comment+"'\"> <i class='fa fa-comment-o'><\/i><\/div>"}}]};n.loadInitialDates=function(){var t=new Date;t.setYear(t.getYear()-1);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.clearName=function(){n.chosenPerson=""};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Drive/Admin/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})};n.gridContainer={};n.dateContainer={};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"};n.refreshGrid=function(){n.gridContainer.grid.dataSource.read()}}]);angular.module("app.drive").controller("AcceptController",["$scope","$modalInstance","itemId","NotificationService","pageNumber",function(n,t,i,r,u){n.itemId=i;n.pageNumber=u;n.noClicked=function(){t.dismiss("cancel");r.AutoFadeNotification("warning","","Godkendelsen blev annulleret.")};n.yesClicked=function(){t.close(n.itemId);r.AutoFadeNotification("success","","Indberetningen blev godkendt.")};n.approveSelectedClick=function(){t.close();r.AutoFadeNotification("success","","De markerede indberetninger blev godkendt.")}}]);angular.module("app.drive").controller("AcceptWithAccountController",["$scope","$modalInstance","itemId","BankAccount","NotificationService","pageNumber",function(n,t,i,r,u,f){n.itemId=i;n.result={};n.pageNumber=f;r.get().$promise.then(function(t){n.accounts=t.value});n.noClicked=function(){t.dismiss("cancel");u.AutoFadeNotification("warning","","Godkendelsen af indberetningen blev annulleret.")};n.yesClicked=function(){n.selectedAccount==undefined?n.errorMessage="* Du skal vælge en konto":(n.result.AccountNumber=n.selectedAccount.Number,n.result.Id=i,t.close(n.result),u.AutoFadeNotification("success","","Indberetningen blev godkendt med kontering "+n.selectedAccount.Description+" - "+n.selectedAccount.Number))};n.approveAllWithAccountClick=function(){n.selectedAccount==undefined?n.errorMessage="* Du skal vælge en konto":(t.close(n.selectedAccount.Number),u.AutoFadeNotification("success","","Indberetningerne blev godkendt med kontering "+n.selectedAccount.Description+" - "+n.selectedAccount.Number))};n.approveSelectedWithAccountClick=function(){n.selectedAccount==undefined?n.errorMessage="* Du skal vælge en konto":(t.close(n.selectedAccount.Number),u.AutoFadeNotification("success","","Indberetningerne blev godkendt med kontering "+n.selectedAccount.Description+" - "+n.selectedAccount.Number))}}]);angular.module("app.drive").directive("awsfield",function(){return{restrict:"AE",link:function(n,t){var i={apikey:"FCF3FC50-C9F6-4D89-9D7E-6E3706C1A0BD",resource:"addressaccess",select:function(t){n.model=t.tekst}};angular.element(t).spatialfind(i)}}});angular.module("app.drive").directive("routeLoader",function(){return{restrict:"EA",link:function(n,t){function i(){t.css("display","none")}var r=t.css("display");n.$on("$routeChangeStart",function(){t.css("display",r)});n.$on("$routeChangeSuccess",i);n.$on("$routeChangeError",i);i()}}});angular.module("app.drive").controller("ConfirmDiscardChangesController",["$scope","$modalInstance",function(n,t){n.confirmDiscardChanges=function(){t.close()};n.cancel=function(){t.dismiss("cancel")}}]);angular.module("app.drive").controller("DrivingController",["$scope","Person","PersonEmployments","Rate","LicensePlate","PersonalRoute","DriveReport","Address","SmartAdresseSource","AddressFormatter","$q","ReportId","$timeout","NotificationService","PersonalAddress","$rootScope","$modalInstance","$window","$modal","$location","adminEditCurrentUser",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){var yt,rt,it,ot,ti,pt,wt,bt,ut,ct,lt,at,ii,tt,kt,ui,dt,nt,gt;n.ReadReportCommentHelp=p.HelpTexts.ReadReportCommentHelp.text;n.PurposeHelpText=p.HelpTexts.PurposeHelpText.text;n.fourKmRuleHelpText=p.HelpTexts.FourKmRuleHelpText.text;n.noLicensePlateHelpText=p.HelpTexts.NoLicensePlateHelpText.text;n.Number=Number;n.toString=toString;n.replace=String.replace;n.saveBtnDisabled=!1;var ft=!1,vt=4,ni=.001,et=l>0;n.container={};n.container.addressNotFound=!1;n.isEditingReport=et;yt=c.defer();rt=[yt.promise];n.canSubmitDriveReport=!0;it=!1;ot=!0;n.container.addressFieldOptions={select:function(){a(function(){n.addressInputChanged()})},dataBound:function(){n.container.addressNotFound=this.dataSource._data.length==0;n.$apply()}};n.addressPlaceholderText="Eller indtast adresse her";n.SmartAddress=s;n.IsRoute=!1;n.validateInput=function(){};ti=function(){n.DriveReport=new e;n.DriveReport.KilometerAllowance=p.CurrentUser.Employments[0].OrgUnit.DefaultKilometerAllowance;n.DriveReport.Addresses=[];n.DriveReport.Addresses.push({Name:"",Personal:""});n.DriveReport.Addresses.push({Name:"",Personal:""});n.container.datePickerMaxDate=new Date};ti();n.AddViapoint=function(){var t=n.DriveReport.Addresses.pop();n.DriveReport.Addresses.push({Name:"",Personal:"",Save:!1});n.DriveReport.Addresses.push(t)};n.Remove=function(t,i){t.splice(i,1);n.addressInputChanged(i)};pt=function(){for(var t=0;t<n.KmRate.length;t++)if(n.KmRate[t].Id==n.DriveReport.KmRate)return n.KmRate[t]};n.shaveExtraCommasOffAddressString=function(n){var t=n.toString().replace(/,/,"###");return t=t.replace(/,/g,""),t.replace(/###/,",")};wt=function(t){var i;return angular.forEach(n.currentUser.Employments,function(n){n.Id==t&&(i=n)}),i};bt=function(t){var r,i;if(n.DriveReport.FourKmRule={},n.DriveReport.FourKmRule.Value=n.currentUser.DistanceFromHomeToBorder.toString().replace(".",","),n.container.PositionDropDown.select(function(n){return n.Id==t.EmploymentId}),n.container.LicensePlateDropDown.select(function(n){return n.Plate==t.LicensePlate}),n.container.LicensePlateDropDown.trigger("change"),n.container.KmRateDropDown.select(function(n){return n.Type.TFCode==t.TFCode}),angular.forEach(n.KmRate,function(i){i.Type.TFCode==t.TFCode&&(n.showLicensePlate=i.Type.RequiresLicensePlate)}),n.container.KmRateDropDown.trigger("change"),et){switch(t.KilometerAllowance){case"Calculated":n.container.KilometerAllowanceDropDown.select(0);t.IsFromApp&&(r=k.open({templateUrl:"/App/Driving/EditCalculatedAppReportTemplate.html",controller:"NoLicensePlateModalController",backdrop:"static"}));break;case"Read":n.container.KilometerAllowanceDropDown.select(1);break;case"CalculatedWithoutExtraDistance":n.container.KilometerAllowanceDropDown.select(2)}n.DriveReport.KilometerAllowance=n.container.KilometerAllowanceDropDown._selectedValue;n.DriveReport.Purpose=t.Purpose;n.DriveReport.Status=t.Status;n.DriveReport.FourKmRule.Using=t.FourKmRule;n.DriveReport.Date=moment.unix(t.DriveDateTimestamp)._d;t.KilometerAllowance=="Read"?(ot=!1,n.DriveReport.UserComment=t.UserComment,t.StartsAtHome||t.EndsAtHome?t.StartsAtHome&&t.EndsAtHome?n.container.StartEndHomeDropDown.select(3):t.StartsAtHome?n.container.StartEndHomeDropDown.select(1):t.EndsAtHome&&n.container.StartEndHomeDropDown.select(2):n.container.StartEndHomeDropDown.select(0),n.DriveReport.StartsAtHome=t.StartsAtHome,n.DriveReport.EndsAtHome=t.EndsAtHome,nt(),t.Distance=(t.Distance+n.TransportAllowance).toFixed(2),n.DriveReport.ReadDistance=t.Distance.toString().replace(".",",")):(n.initialEditReportLoad=!0,n.DriveReport.Addresses=[],it=!0,angular.forEach(t.DriveReportPoints,function(t){var i={Name:t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town,Latitude:t.Latitude,Longitude:t.Longitude};n.DriveReport.Addresses.push(i)}),i="[",angular.forEach(n.DriveReport.Addresses,function(n){i+='{name: "'+n.Name+'", lat: '+n.Latitude+", lng: "+n.Longitude+"},"}),i+="]",n.$on("kendoWidgetCreated",function(t,i){i===n.container.lastTextBox&&(it=!1,ot=!1,n.addressInputChanged())}));n.DriveReport.IsRoundTrip=t.IsRoundTrip}};n.currentUser=g!=0?g:p.CurrentUser;ut=n.currentUser;angular.forEach(ut.Employments,function(n){n.PresentationString=n.Position+" - "+n.OrgUnit.LongDescription+" ("+n.EmploymentId+")"});n.Employments=ut.Employments;rt.push(r.ThisYearsRates().$promise.then(function(t){n.KmRate=t}));ct=ut.LicensePlates.slice(0);ct.length>0?(n.userHasLicensePlate=!0,angular.forEach(ct,function(n){n.PresentationString=n.Description!=""?n.Plate+" - "+n.Description:n.Plate}),n.LicensePlates=ct):(n.userHasLicensePlate=!1,n.LicensePlates=[{PresentationString:"Ingen nummerplader",Plate:"0000000"}]);lt=ut.PersonalRoutes.slice(0);angular.forEach(lt,function(n){n.PresentationString="";n.Description!=""&&(n.PresentationString+=n.Description+" : ");n.PresentationString+=n.Points[0].StreetName+" "+n.Points[0].StreetNumber+", "+n.Points[0].ZipCode+" "+n.Points[0].Town+" -> ";n.PresentationString+=n.Points[n.Points.length-1].StreetName+" "+n.Points[n.Points.length-1].StreetNumber+", "+n.Points[n.Points.length-1].ZipCode+" "+n.Points[n.Points.length-1].Town;n.PresentationString+=" Antal viapunkter: "+Number(n.Points.length-2)});lt.unshift({PresentationString:"Vælg personlig rute"});n.Routes=lt;rt.push(o.getMapStart().$promise.then(function(t){n.mapStartAddress=t}));et?rt.push(e.getWithPoints({id:l}).$promise.then(function(t){n.latestDriveReport=t})):rt.push(e.getLatest({id:ut.Id}).$promise.then(function(t){n.latestDriveReport=t}));rt.push(o.GetPersonalAndStandard({personId:ut.Id}).$promise.then(function(t){angular.forEach(t,function(t){t.PresentationString="";t.Description!=""&&t.Description!=null&&t.Description!=undefined&&(t.PresentationString+=t.Description+" : ");t.Type=="Home"&&(n.HomeAddress=t,t.PresentationString="Hjemmeadresse : ");t.Type=="AlternativeHome"&&(n.HomeAddress=t);t.PresentationString+=t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town;t.address=t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town});n.PersonalAddresses=new kendo.data.DataSource({data:t,sort:{field:"PresentationString",dir:"asc"}})}));c.all(rt).then(function(){ui()});at=function(t){t==undefined&&(t=!0);n.container.PersonalRouteDropDown.select(0);n.IsRoute=!1;ft=!1;t&&tt(n.mapStartAddress,n.transportType);n.DriveReport.Addresses=[{Name:""},{Name:""}];nt()};ii=function(t){var r,i;n.IsRoute=!0;r=n.Routes[t];n.DriveReport.Addresses=[];i=[];angular.forEach(r.Points,function(t){var r={Name:t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town,Latitude:t.Latitude,Longitude:t.Longitude};n.DriveReport.Addresses.push(r);i.push({name:r.Name,lat:r.Latitude,lng:r.Longitude})});tt(i,n.transportType);ft=!0};n.personalRouteDropdownChange=function(n){var t=n.sender.selectedIndex;t==0?at():ii(t)};n.clearErrorMessages=function(){n.addressSelectionErrorMessage="";n.purposeErrorMessage="";n.fourKmRuleValueErrorMessage="";n.licensePlateErrorMessage="";n.readDistanceErrorMessage="";n.userCommentErrorMessage=""};n.isAddressNameSet=function(t){return!(t.Name==""||t.Name==n.addressPlaceholderText||t.Name==undefined)};n.isAddressPersonalSet=function(n){return!(n.Personal==undefined||n.Personal=="")};var ri=function(t){if(t=typeof t!="undefined"?t:!0,n.DriveReport.KilometerAllowance=="Read")return!0;var i=!0;return t===!0&&(n.addressSelectionErrorMessage=""),angular.forEach(n.DriveReport.Addresses,function(r){n.isAddressNameSet(r)&&n.isAddressPersonalSet(r)&&(r.Name="");n.isAddressNameSet(r)||n.isAddressPersonalSet(r)||(i=!1,t===!0&&(n.addressSelectionErrorMessage="*  Du skal udfylde alle adressefelter."))}),i},ei=function(){return(n.dateErrorMessage="",n.DriveReport.Date==null||n.DriveReport.Date==undefined)?(n.dateErrorMessage="* Du skal vælge en dato.",!1):!0},oi=function(){return(n.purposeErrorMessage="",n.DriveReport.Purpose==undefined||n.DriveReport.Purpose=="")?(n.purposeErrorMessage="* Du skal angive et formål.",!1):!0},si=function(){return(n.fourKmRuleValueErrorMessage="",n.DriveReport.FourKmRule.Using===!0&&(n.DriveReport.FourKmRule.Value==""||n.DriveReport.FourKmRule.Value==undefined))?(n.fourKmRuleValueErrorMessage="* Du skal udfylde en 4 km-regel værdi.",!1):!0},hi=function(){return(n.licensePlateErrorMessage="",pt(n.DriveReport.KmRate).Type.RequiresLicensePlate&&n.LicensePlates[0].PresentationString=="Ingen nummerplader")?(n.openNoLicensePlateModal(),n.licensePlateErrorMessage="* Det valgte transportmiddel kræver en nummerplade.",!1):!0},ci=function(){n.readDistanceErrorMessage="";n.userCommentErrorMessage="";var t=!0,i=!0;return n.DriveReport.KilometerAllowance=="Read"&&((n.DriveReport.ReadDistance<=0||n.DriveReport.ReadDistance==undefined)&&(n.readDistanceErrorMessage="* Du skal indtaste en kørt afstand.",t=!1),(n.DriveReport.UserComment==undefined||n.DriveReport.UserComment=="")&&(n.userCommentErrorMessage="* Du skal angive en kommentar.",i=!1)),i&&t};n.addressInputChanged=function(){if(ri(!1)&&!it&&!ot){var i=[],t=[];angular.forEach(n.DriveReport.Addresses,function(i){var r;n.isAddressNameSet(i)||i.Personal==""?n.isAddressNameSet(i)&&(r=h.fn(i.Name),t.push({StreetName:r.StreetName,StreetNumber:r.StreetNumber,ZipCode:r.ZipCode,Town:r.Town})):(r=h.fn(i.Personal),t.push({StreetName:r.StreetName,StreetNumber:r.StreetNumber,ZipCode:r.ZipCode,Town:r.Town}))});o.setCoordinatesOnAddressList(t).$promise.then(function(t){angular.forEach(t,function(t,r){i.push({name:t.streetName+" "+t.streetNumber+", "+t.zipCode+" "+t.town,lat:t.latitude,lng:t.longitude});n.DriveReport.Addresses[r].Latitude=t.latitude;n.DriveReport.Addresses[r].Longitude=t.longitude});tt(i,n.transportType);ft=!0})}};tt=function(n,t){a(function(){setMapPromise=c.defer();it=!0;OS2RouteMap.set(n,t);setMapPromise.promise.then(function(){it=!1})})};n.$on("kendoWidgetCreated",function(t,i){i===n.container.KilometerAllowanceDropDown&&yt.resolve()});kt=function(){a(function(){angular.element("#map").length?(OS2RouteMap.create({id:"map",routeToken:p.HelpTexts.SEPTIMA_API_KEY.text,change:function(t){var r,i;if(t.status!==0&&t.status!=undefined){kt();r=k.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return"OS2Indberetning kunne ikke beregne ruten. Fejlen kan skyldes, at det ikke er muligt at køre til en/eller flere af dine adresser. Prøv igen eller med en anden adresse tæt på."}}});return}if(ot){ot=!1;return}if(ft=!0,n.currentMapAddresses=t.Addresses,n.latestMapDistance=t.distance,t.distance==0&&(ft=!1),nt(),it===!0){setMapPromise.resolve();return}if(it=!0,n.DriveReport.Addresses=[],i=[],angular.forEach(t.Addresses,function(t){var r=n.shaveExtraCommasOffAddressString(t.name);i.push({Name:r,Latitude:t.lat,Longitude:t.lng})}),n.DriveReport.Addresses=i,n.$apply(),a(function(){it=!1}),n.initialEditReportLoad===!0){n.initialEditReportLoad=!1;return}n.IsRoute&&at(!1)}}),n.isEditingReport||OS2RouteMap.set(n.mapStartAddress)):v.AutoFadeNotification("danger","","Kortet kunne ikke vises. Prøv at genopfriske siden.")})};ui=function(){n.validateInput=function(){n.canSubmitDriveReport=ci();n.canSubmitDriveReport&=ri();n.canSubmitDriveReport&=oi();n.canSubmitDriveReport&=hi();n.canSubmitDriveReport&=si();n.canSubmitDriveReport&=ei()};et||n.container.driveDatePicker.open();a(function(){kt();bt(n.latestDriveReport);nt()})};n.clearReport=function(){tt(n.mapStartAddress,n.transportType);at();n.DriveReport.IsRoundTrip=!1;bt(n.latestDriveReport);n.DriveReport.Addresses=[{Name:""},{Name:""}];n.DriveReport.ReadDistance=0;n.DriveReport.UserComment="";n.DriveReport.Purpose="";n.clearErrorMessages();nt();b.scrollTo(0,0);et||a(function(){n.container.driveDatePicker.open()},200);n.DrivenKMDisplay=0;n.TransportAllowance=0};n.transportChanged=function(){c.all(rt).then(function(){var t=pt(n.DriveReport.KmRate);n.showLicensePlate=t.Type.RequiresLicensePlate;t.Type.IsBike?(n.transportType=="car"&&n.currentMapAddresses!=undefined&&n.currentMapAddresses.length>0&&(n.transportType="bicycle",tt(n.currentMapAddresses,n.transportType),tt(n.currentMapAddresses,n.transportType)),n.transportType="bicycle"):(n.transportType=="bicycle"&&n.currentMapAddresses!=undefined&&n.currentMapAddresses.length>0&&(n.transportType="car",tt(n.currentMapAddresses,n.transportType),tt(n.currentMapAddresses,n.transportType)),n.transportType="car")})};dt=function(){n.canSubmitDriveReport=!1;n.saveBtnDisabled=!0;et?e.delete({id:l}).$promise.then(function(){e.edit({emailText:n.emailText},n).$promise.then(function(t){n.latestDriveReport=t;v.AutoFadeNotification("success","","Din tjenestekørselsindberetning blev redigeret");n.clearReport();n.saveBtnDisabled=!1;w.close();n.container.driveDatePicker.close()},function(){n.saveBtnDisabled=!1;v.AutoFadeNotification("danger","","Der opstod en fejl under redigering af tjenestekørselsindberetningen.")})}):e.create(n).$promise.then(function(t){n.latestDriveReport=t;v.AutoFadeNotification("success","","Din indberetning er sendt til godkendelse.");n.clearReport();n.saveBtnDisabled=!1},function(){n.saveBtnDisabled=!1;v.AutoFadeNotification("danger","","Der opstod en fejl under oprettelsen af tjenestekørselsindberetningen.")})};n.Save=function(){if(n.validateInput(),n.canSubmitDriveReport)if(n.DriveReport.Status=="Accepted"){var t=k.open({templateUrl:"/App/Admin/HTML/Reports/Modal/ConfirmEditApprovedReportTemplate.html",controller:"ConfirmEditApprovedReportModalController",backdrop:"static"});t.result.then(function(t){t==undefined&&(t="Ingen besked.");n.emailText=t;n.prepHandleSave()})}else n.prepHandleSave()};n.prepHandleSave=function(){n.currentUser.DistanceFromHomeToBorder!=n.DriveReport.FourKmRule.Value&&n.DriveReport.FourKmRule.Value!=""&&n.DriveReport.FourKmRule.Value!=undefined?(n.currentUser.DistanceFromHomeToBorder=n.DriveReport.FourKmRule.Value,t.patch({id:n.currentUser.Id},{DistanceFromHomeToBorder:n.DriveReport.FourKmRule.Value.toString().replace(",",".")}).$promise.then(function(){dt()})):dt()};n.kilometerAllowanceChanged=function(){nt();switch(n.DriveReport.KilometerAllowance){case"Read":tt(n.mapStartAddress,n.transportType);break;default:n.addressInputChanged()}};n.fourKmRuleChanged=function(){nt()};n.employmentChanged=function(){angular.forEach(n.currentUser.Employments,function(t){t.Id==n.DriveReport.Position&&(n.WorkAddress=t.OrgUnit.Address,n.hasAccessToFourKmRule=t.OrgUnit.HasAccessToFourKmRule)});nt()};var st=function(){var t,i;return n.DriveReport.KilometerAllowance=="Read"?(t=n.container.StartEndHomeDropDown.selectedIndex,t==1||t==3)?!0:!1:n.currentMapAddresses==undefined?!1:(i=n.currentMapAddresses[0],fi(n.HomeAddress,i))},ht=function(){var t,i;return n.DriveReport.KilometerAllowance=="Read"?(t=n.container.StartEndHomeDropDown.selectedIndex,t==2||t==3)?!0:!1:n.currentMapAddresses==undefined?!1:(i=n.currentMapAddresses[n.currentMapAddresses.length-1],fi(n.HomeAddress,i))},fi=function(n,t){var i=n.Longitude===undefined?n.lng:n.Longitude,r=t.Longitude===undefined?t.lng:t.Longitude,u=n.Latitude===undefined?n.lat:n.Latitude,f=t.Latitude===undefined?t.lat:t.Latitude,e=Math.abs(Number(i)-Number(r)),o=Math.abs(Number(u)-Number(f));return e<ni&&o<ni};n.startEndHomeChanged=function(){nt()};nt=function(){a(function(){n.TransportAllowance=n.DriveReport.KilometerAllowance!="CalculatedWithoutExtraDistance"?st()&&ht()?Number(wt(n.DriveReport.Position).HomeWorkDistance)*2:st()||ht()?wt(n.DriveReport.Position).HomeWorkDistance:0:0;n.DriveReport.KilometerAllowance=="Read"?(n.DriveReport.ReadDistance==undefined&&(n.DriveReport.ReadDistance=0),n.DrivenKMDisplay=Number(n.DriveReport.ReadDistance.toString().replace(",","."))):n.DrivenKMDisplay=n.latestMapDistance==undefined?0:n.latestMapDistance;n.DriveReport.IsRoundTrip===!0&&(n.DrivenKMDisplay=Number(n.DrivenKMDisplay)*2,st()!=ht()&&(n.TransportAllowance=Number(n.TransportAllowance)*2));n.DriveReport.FourKmRule!=undefined&&n.DriveReport.FourKmRule.Using===!0&&n.DriveReport.FourKmRule.Value!=undefined&&(n.TransportAllowance=st()!=ht()?Number(n.DriveReport.FourKmRule.Value.toString().replace(",","."))+vt:st()&&ht()?Number(n.DriveReport.FourKmRule.Value.toString().replace(",","."))*2+vt:vt)})};n.readDistanceChanged=function(){nt()};n.roundTripChanged=function(){nt()};n.closeModalWindow=function(){w.dismiss()};gt=function(){return ft===!0?!0:n.DriveReport.Purpose!=undefined&&n.DriveReport.Purpose!=n.latestDriveReport.Purpose&&n.DriveReport.Purpose!=""?!0:n.DriveReport.ReadDistance!=undefined&&n.DriveReport.ReadDistance!=n.latestDriveReport.Distance.toString().replace(".",",")&&n.DriveReport.ReadDistance!=""?!0:n.DriveReport.UserComment!=undefined&&n.DriveReport.UserComment!=n.latestDriveReport.UserComment&&n.DriveReport.UserComment!=""?!0:!1};n.$on("$stateChangeStart",function(n){if(gt()===!0){var t=confirm("Du har lavet ændringer på siden, der ikke er gemt. Ønsker du at kassere disse ændringer?");t||n.preventDefault()}});window.onbeforeunload=function(){if(gt()===!0)return"Du har lavet ændringer på siden, der ikke er gemt. Ønsker du at kassere disse ændringer?"};n.$on("$destroy",function(){window.onbeforeunload=undefined});n.clearClicked=function(){var t=k.open({templateUrl:"/App/Driving/ConfirmDiscardChangesTemplate.html",controller:"ConfirmDiscardChangesController",backdrop:"static"});t.result.then(function(){n.clearReport()})};n.openNoLicensePlateModal=function(){var n=k.open({templateUrl:"/App/Driving/NoLicensePlateModalTemplate.html",controller:"NoLicensePlateModalController",backdrop:"static"});n.result.then(function(){d.path("/settings")})}}]);angular.module("app.drive").controller("NoLicensePlateModalController",["$scope","$modalInstance","$rootScope",function(n,t,i){n.ok=function(){t.close()};n.cancel=function(){i.editModalInstance!=undefined&&i.editModalInstance.dismiss();t.dismiss("cancel")}}]);angular.module("app.drive").filter("FormatKmNumber",function(){return function(n){return(+(Math.round(+(Number(n)+"e2"))+"e-2")).toFixed(2)}}).filter("FormatKmNumberString",function(){return function(n){return(+(Math.round(+(Number(n)+"e2"))+"e-2")).toFixed(2).toString().replace(".",",")}});angular.module("app.drive").controller("ConfirmDeleteReportController",["$scope","$modalInstance","itemId","NotificationService",function(n,t,i,r){n.itemId=i;n.confirmDelete=function(){t.close(n.itemId);r.AutoFadeNotification("success","","Indberetningen blev slettet.")};n.cancel=function(){t.dismiss("cancel");r.AutoFadeNotification("warning","","Sletning af indberetningen blev annulleret.")}}]);angular.module("app.drive").controller("MyAcceptedReportsController",["$scope","$modal","$rootScope","Report","$timeout","RateType","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o){var h=i.CurrentUser.Id,s,c,l;n.tableSortHelp=i.HelpTexts.TableSortHelp.text;n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};s=new Date;s.setYear(s.getYear()-1);s=n.getStartOfDayStamp(s);c=n.getEndOfDayStamp(new Date);f.getAll().$promise.then(function(t){n.rateTypes=t});n.Reports={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/DriveReports?status=Accepted &$expand=DriveReportPoints,ApprovedBy &$filter=PersonId eq "+h+" and DriveDateTimestamp ge "+s+" and DriveDateTimestamp le "+c,dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"DriveDateTimestamp",dir:"desc"},aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"}]},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",template:function(n){return n.Comment!=""?n.Purpose+"<button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.Comment+'\'" class="transparent-background pull-right no-border"><i class="fa fa-comment-o"><\/i><\/button>':n.Purpose},title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return o.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km"},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr."},{field:"KilometerAllowance",title:"MK",template:function(n){return e.format(n)}},{field:"CreatedDateTimestamp",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Indberettet"},{field:"ClosedDateTimestamp",title:"Godkendelsesdato",template:function(n){var t=moment.unix(n.ClosedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"ProcessedDateTimestamp",title:"Afsendt til løn",template:function(n){if(n.ProcessedDateTimestamp!=0&&n.ProcessedDateTimestamp!=null&&n.ProcessedDateTimestamp!=undefined){var t=moment.unix(n.ProcessedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}return""}},{field:"ApprovedBy.FullName",title:"Godkendt af"}],scrollable:!1};n.clearClicked=function(){n.loadInitialDates();n.searchClicked()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=l(t,i);n.gridContainer.grid.dataSource.read()};l=function(n,t){var i=" &$filter=PersonId eq "+h+" and DriveDateTimestamp ge "+n+" and DriveDateTimestamp le "+t;return"/odata/DriveReports?status=Accepted &$expand=DriveReportPoints,ApprovedBy"+i};n.loadInitialDates=function(){var t=new Date;t.setYear(t.getYear()-1);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.refreshGrid=function(){n.gridContainer.grid.dataSource.read()};n.gridContainer={};n.dateContainer={};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"};n.applyDateFilter=function(t,i){var r=[];r.push({field:"PersonId",operator:"eq",value:h});r.push({field:"DriveDateTimestamp",operator:"gte",value:t});r.push({field:"DriveDateTimestamp",operator:"lte",value:i});n.gridContainer.grid.dataSource.filter(r)};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Admin/HTML/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})}}]);angular.module("app.drive").controller("MyPendingReportsController",["$scope","$modal","$rootScope","Report","$timeout","Person","RateType","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o,s){var c=i.CurrentUser.Id,h,a,l;n.tableSortHelp=i.HelpTexts.TableSortHelp.text;n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};h=new Date;h.setYear(h.getYear()-2);h=n.getStartOfDayStamp(h);a=n.getEndOfDayStamp(new Date);e.getAll().$promise.then(function(t){n.rateTypes=t});n.Reports={dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/DriveReports?status=Pending &$expand=DriveReportPoints,ResponsibleLeader &$filter=PersonId eq "+c,dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"DriveDateTimestamp",dir:"desc"},aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"},]},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",template:function(n){return n.Comment!=""?n.Purpose+"<button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.Comment+'\'" class="transparent-background pull-right no-border"><i class="fa fa-comment-o"><\/i><\/button>':n.Purpose},title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return s.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km "},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr."},{field:"KilometerAllowance",title:"MK",template:function(n){return o.format(n)}},{field:"CreatedDateTimestamp",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Indberettet"},{title:"Godkender",field:"ResponsibleLeader.FullName",template:function(n){return n.ResponsibleLeader!=0&&n.ResponsibleLeader!=null&&n.ResponsibleLeader!=undefined?n.ResponsibleLeader.FullName:""}},{field:"Id",template:function(n){return'<a ng-click="deleteClick("'+n.Id+'">Slet<\/a> | <a ng-click="editClick('+n.Id+'">Rediger<\/a>'},title:"Muligheder"}],scrollable:!1};n.loadInitialDates=function(){var t=new Date;t.setYear(t.getYear()-2);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.deleteClick=function(i){var u=t.open({templateUrl:"/App/Drive/MyReports/ConfirmDeleteTemplate.html",controller:"ConfirmDeleteReportController",backdrop:"static",resolve:{itemId:function(){return i}}});u.result.then(function(){r.delete({id:i},function(){n.gridContainer.grid.dataSource.read()})})};n.editClick=function(r){var u=t.open({templateUrl:"/App/Drive/MyReports/EditReportTemplate.html",controller:"DrivingController",backdrop:"static",windowClass:"app-modal-window-full",resolve:{adminEditCurrentUser:function(){return 0},ReportId:function(){return r}}});i.editModalInstance=u;u.result.then(function(){n.gridContainer.grid.dataSource.read()})};n.clearClicked=function(){n.loadInitialDates();n.searchClicked()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=l(t,i);n.gridContainer.grid.dataSource.read()};l=function(n,t){var i="&$filter=PersonId eq "+c+" and DriveDateTimestamp ge "+n+" and DriveDateTimestamp le "+t;return"/odata/DriveReports?status=Pending &$expand=DriveReportPoints,ResponsibleLeader"+i};n.gridContainer={};n.dateContainer={};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"};n.refreshGrid=function(){n.gridContainer.grid.dataSource.read()};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Admin/HTML/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})}}]);angular.module("app.drive").controller("MyRejectedReportsController",["$scope","$modal","$rootScope","Report","$timeout","RateType","MkColumnFormatter","RouteColumnFormatter",function(n,t,i,r,u,f,e,o){var h=i.CurrentUser.Id,s,c,l;n.tableSortHelp=i.HelpTexts.TableSortHelp.text;n.getEndOfDayStamp=function(n){var t=moment(n);return t.endOf("day").unix()};n.getStartOfDayStamp=function(n){var t=moment(n);return t.startOf("day").unix()};s=new Date;s.setYear(s.getYear()-1);s=n.getStartOfDayStamp(s);c=n.getEndOfDayStamp(new Date);f.getAll().$promise.then(function(t){n.rateTypes=t});n.Reports={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/DriveReports?status=Rejected &$expand=DriveReportPoints,ApprovedBy($select=FullName) &$filter=PersonId eq "+h+" and DriveDateTimestamp ge "+s+" and DriveDateTimestamp le "+c,dataType:"json",cache:!1}},pageSize:20,serverPaging:!1,serverSorting:!0,sort:{field:"DriveDateTimestamp",dir:"desc"},aggregate:[{field:"Distance",aggregate:"sum"},{field:"AmountToReimburse",aggregate:"sum"},]},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"DriveDateTimestamp",template:function(n){var t=moment.unix(n.DriveDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Dato"},{field:"Purpose",title:"Formål"},{field:"TFCode",title:"Taksttype",template:function(t){for(var i=0;i<n.rateTypes.length;i++)if(n.rateTypes[i].TFCode==t.TFCode)return n.rateTypes[i].Description}},{title:"Rute",field:"DriveReportPoints",template:function(n){return o.format(n)}},{field:"Distance",title:"Km",template:function(n){return n.Distance.toFixed(2).toString().replace(".",",")+" km"},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # km"},{field:"AmountToReimburse",title:"Beløb",template:function(n){return n.AmountToReimburse.toFixed(2).toString().replace(".",",")+" kr."},footerTemplate:"Total: #= kendo.toString(sum, '0.00').replace('.',',') # kr"},{field:"KilometerAllowance",title:"MK",template:function(n){return e.format(n)}},{field:"CreatedDateTimestamp",template:function(n){var t=moment.unix(n.CreatedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()},title:"Indberettet"},{field:"ClosedDateTimestamp",title:"Afvist dato",template:function(n){var t=moment.unix(n.ClosedDateTimestamp);return t._d.getDate()+"/"+(t._d.getMonth()+1)+"/"+t._d.getFullYear()}},{field:"ApprovedBy.FullName",title:"Afvist af",template:function(n){return n.ApprovedBy.FullName+"<div kendo-tooltip k-content=\"'"+n.Comment+"'\"><i class='fa fa-comment-o'><\/i><\/div>"}}],scrollable:!1};n.loadInitialDates=function(){var t=new Date;t.setYear(t.getYear()-1);n.dateContainer.toDate=new Date;n.dateContainer.fromDate=t};n.clearClicked=function(){n.loadInitialDates();n.searchClicked()};n.searchClicked=function(){var t=n.getStartOfDayStamp(n.dateContainer.fromDate),i=n.getEndOfDayStamp(n.dateContainer.toDate);n.gridContainer.grid.dataSource.transport.options.read.url=l(t,i);n.gridContainer.grid.dataSource.read()};l=function(n,t){var i="&$filter=PersonId eq "+h+" and DriveDateTimestamp ge "+n+" and DriveDateTimestamp le "+t;return"/odata/DriveReports?status=Rejected &$expand=DriveReportPoints,ApprovedBy($select=FullName)"+i};n.refreshGrid=function(){n.gridContainer.grid.dataSource.read()};n.gridContainer={};n.dateContainer={};n.loadInitialDates();n.dateOptions={format:"dd/MM/yyyy"};n.showRouteModal=function(n){var i=t.open({templateUrl:"/App/Admin/HTML/Reports/Modal/ShowRouteModalTemplate.html",controller:"ShowRouteModalController",backdrop:"static",resolve:{routeId:function(){return n}}})}}]);angular.module("app.drive").controller("MyReportsController",["$scope","$modal","$rootScope","Report","$timeout",function(){}]);angular.module("app.drive").factory("AddressFormatter",["Address",function(){return{fn:function(n){var i={StreetName:"",StreetNumber:"",ZipCode:0,Town:"",Description:""},t=n.split(","),r,f,u,e;if(t.length!=2)if(t.length==3)t=[t[0],t[2]];else if(t.length==4)t=[t[0]+","+t[1],t[3]];else return undefined;if(r=t[0].split(" "),r.length<2)return undefined;for(f=0;f<r.length-1;f++)i.StreetName+=r[f],f+1==r.length-1||(i.StreetName+=" ");if(i.StreetNumber=r[r.length-1],u=t[1].split(" "),u.length<3)return undefined;for(i.ZipCode=u[1],e=2;e<u.length;e++)i.Town+=u[e],e+1==u.length||(i.Town+=" ");return{Id:null,PersonId:0,StreetName:i.StreetName,StreetNumber:i.StreetNumber,ZipCode:parseInt(i.ZipCode),Town:i.Town,Description:null}}}}]);angular.module("app.drive").service("Address",["$resource","$modal",function(n,t){return n("/odata/PersonalAddresses(:id)?:query",{id:"@id",query:"@query"},{get:{method:"GET",isArray:!1},patch:{method:"PATCH",isArray:!1},post:{method:"POST",isArray:!1},"delete":{method:"DELETE",isArray:!1},getAlternativeHome:{method:"GET",url:"/odata/PersonalAddresses(:id)/AlternativeHome?:query",isArray:!0,transformResponse:function(n){var i=angular.fromJson(n),r;return i.error==undefined?i.value:(r=t.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return i.error.innererror.message}}}),i)}},getAlternativeWork:{method:"GET",url:"/odata/PersonalAddresses(:id)/AlternativeWork?:query",isArray:!0,transformResponse:function(n){var i=angular.fromJson(n),r;return i.error==undefined?i.value:(r=t.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return i.error.innererror.message}}}),i)}},setCoordinatesOnAddress:{method:"POST",url:"/odata/Addresses/Service.SetCoordinatesOnAddress",isArray:!0,transformResponse:function(n){var i=angular.fromJson(n),r;return i.error==undefined?i.value:(r=t.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return i.error.innererror.message}}}),i)}},setCoordinatesOnAddressList:{method:"POST",url:"/api/Coordinate/SetCoordinatesOnAddressList",isArray:!0,transformResponse:function(n){return angular.fromJson(n)}},GetPersonalAndStandard:{method:"GET",url:"/odata/Addresses/Service.GetPersonalAndStandard?personId=:personId",isArray:!0,transformResponse:function(n){var i=angular.fromJson(n),r;return i.error==undefined?i.value:(r=t.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return i.error.innererror.message}}}),i)}},getMapStart:{method:"GET",url:"/odata/Addresses/Service.GetMapStart",isArray:!0,transformResponse:function(n){var i=angular.fromJson(n),r,u;return i.error==undefined?(r=[],r.push({name:i.StreetName+" "+i.StreetNumber+", "+i.ZipCode+" "+i.Town,lat:i.Latitude,lng:i.Longitude}),r.push({name:i.StreetName+" "+i.StreetNumber+", "+i.ZipCode+" "+i.Town,lat:i.Latitude,lng:i.Longitude}),r):(u=t.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return i.error.innererror.message}}}),i)}},AttemptCleanCachedAddress:{method:"POST",url:"/odata/Addresses/Service.AttemptCleanCachedAddress"},GetAutoCompleteDataForCachedAddress:{method:"GET",url:"/odata/Addresses/Service.GetCachedAddresses?$select=Description,DirtyString"}})}]);angular.module("app.drive").service("AppLogin",["$resource",function(n){return n("/odata/AppLogin(:id)",{id:"@id"},{"delete":{method:"DELETE",isArray:!1},post:{method:"POST",isArray:!1}})}]);angular.module("app.drive").service("DriveReport",["$resource","AddressFormatter","PersonalAddress","$modal","PersonalAddressType",function(n,t,i,r,u){return n("/odata/DriveReports(:id)?:query&emailText=:emailText",{id:"@id",query:"@query",emailText:"@emailText"},{get:{method:"GET",isArray:!1,transformResponse:function(n){return angular.fromJson(n).value[0]}},create:{method:"POST",isArray:!1,transformRequest:function(n){var f=function(){for(var t=0;t<n.KmRate.length;t++)if(n.KmRate[t].Id==n.DriveReport.KmRate)return n.KmRate[t]},r={};return r.Purpose=n.DriveReport.Purpose,r.DriveDateTimestamp=Math.floor(n.DriveReport.Date.getTime()/1e3),r.KmRate=parseFloat(f().KmRate),r.TFCode=f().Type.TFCode,r.IsRoundTrip=n.DriveReport.IsRoundTrip,r.KilometerAllowance=n.DriveReport.KilometerAllowance,r.Distance=0,r.AmountToReimburse=0,r.LicensePlate=n.showLicensePlate?n.DriveReport.LicensePlate:"0000000",r.PersonId=n.currentUser.Id,r.FullName=n.currentUser.FullName,r.Status="Pending",r.CreatedDateTimestamp=Math.floor(Date.now()/1e3),r.EditedDateTimestamp=r.CreatedDateTimestamp,r.Comment="",r.ClosedDateTimestamp=0,r.ProcessedDateTimestamp=0,r.EmploymentId=n.DriveReport.Position,n.DriveReport.KilometerAllowance==="Read"?(r.Distance=Number(n.DriveReport.ReadDistance.toString().replace(",",".")),Number(r.Distance)<0&&(r.Distance=0),r.UserComment=n.DriveReport.UserComment,n.DriveReport.StartOrEndedAtHome==="Started"?(r.StartsAtHome=!0,r.EndsAtHome=!1):n.DriveReport.StartOrEndedAtHome==="Ended"?(r.StartsAtHome=!1,r.EndsAtHome=!0):n.DriveReport.StartOrEndedAtHome==="Both"?(r.StartsAtHome=!0,r.EndsAtHome=!0):(r.StartsAtHome=!1,r.EndsAtHome=!1)):(r.StartsAtHome=!1,r.EndsAtHome=!1,r.DriveReportPoints=[],angular.forEach(n.DriveReport.Addresses,function(n){var u=n.Name.length!=0?n.Name:n.Personal,i=t.fn(u);n.Latitude==undefined&&(n.Latitude="");n.Longitude==undefined&&(n.Longitude="");r.DriveReportPoints.push({StreetName:i.StreetName,StreetNumber:i.StreetNumber,ZipCode:i.ZipCode,Town:i.Town,Description:"",Latitude:n.Latitude.toString(),Longitude:n.Longitude.toString()})}),angular.forEach(n.DriveReport.Addresses,function(r){if(r.Save){var f=new i(t.fn(r.Name));f.PersonId=n.currentUser.Id;f.Type=u.Standard;f.Longitude="";f.Latitude="";f.Description="";delete f.Id;f.$save(function(t){t.PresentationString=t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town;t.address=t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town;n.PersonalAddresses.push(t);angular.forEach(n.container.PersonalAddressDropDown,function(n){n.dataSource.read()})})}})),r.FourKmRule=typeof n.DriveReport.FourKmRule!="undefined"&&n.DriveReport.FourKmRule.Using===!0?!0:!1,JSON.stringify(r)}},edit:{method:"POST",isArray:!1,url:"/odata/DriveReports(:id)?:query&emailText=:emailText",transformRequest:function(n){var f=function(){for(var t=0;t<n.KmRate.length;t++)if(n.KmRate[t].Id==n.DriveReport.KmRate)return n.KmRate[t]},r={};return r.Purpose=n.DriveReport.Purpose,r.DriveDateTimestamp=Math.floor(n.DriveReport.Date.getTime()/1e3),r.KmRate=parseFloat(f().KmRate),r.TFCode=f().Type.TFCode,r.IsRoundTrip=n.DriveReport.IsRoundTrip,r.KilometerAllowance=n.DriveReport.KilometerAllowance,r.Distance=0,r.AmountToReimburse=0,r.LicensePlate=n.showLicensePlate?n.DriveReport.LicensePlate:"0000000",r.ApprovedById=n.latestDriveReport.ApprovedById,r.PersonId=n.latestDriveReport.PersonId,r.FullName=n.latestDriveReport.FullName,r.Status=n.latestDriveReport.Status,r.CreatedDateTimestamp=n.latestDriveReport.CreatedDateTimestamp,r.EditedDateTimestamp=Math.floor(Date.now()/1e3),r.Comment="",r.ClosedDateTimestamp=n.latestDriveReport.ClosedDateTimestamp,r.ProcessedDateTimestamp=n.latestDriveReport.ProcessedDateTimestamp,r.EmploymentId=n.DriveReport.Position,n.DriveReport.KilometerAllowance==="Read"?(r.Distance=Number(n.DriveReport.ReadDistance.toString().replace(",",".")),Number(r.Distance)<0&&(r.Distance=0),r.UserComment=n.DriveReport.UserComment,n.DriveReport.StartOrEndedAtHome==="Started"?(r.StartsAtHome=!0,r.EndsAtHome=!1):n.DriveReport.StartOrEndedAtHome==="Ended"?(r.StartsAtHome=!1,r.EndsAtHome=!0):n.DriveReport.StartOrEndedAtHome==="Both"?(r.StartsAtHome=!0,r.EndsAtHome=!0):(r.StartsAtHome=!1,r.EndsAtHome=!1)):(r.StartsAtHome=!1,r.EndsAtHome=!1,r.DriveReportPoints=[],angular.forEach(n.DriveReport.Addresses,function(n){var u=n.Name.length!=0?n.Name:n.Personal,i=t.fn(u);n.Latitude==undefined&&(n.Latitude="");n.Longitude==undefined&&(n.Longitude="");r.DriveReportPoints.push({StreetName:i.StreetName,StreetNumber:i.StreetNumber,ZipCode:i.ZipCode,Town:i.Town,Description:"",Latitude:n.Latitude.toString(),Longitude:n.Longitude.toString()})}),angular.forEach(n.DriveReport.Addresses,function(r){if(r.Save){var f=new i(t.fn(r.Name));f.PersonId=n.currentUser.Id;f.Type=u.Standard;f.Longitude="";f.Latitude="";f.Description="";delete f.Id;f.$save()}})),r.FourKmRule=typeof n.DriveReport.FourKmRule!="undefined"&&n.DriveReport.FourKmRule.Using===!0?!0:!1,JSON.stringify(r)}},patch:{method:"PATCH"},getLatest:{method:"GET",isArray:!1,url:"/odata/DriveReports/Service.GetLatestReportForUser?personId=:id",transformResponse:function(n){return angular.fromJson(n)}},getWithPoints:{method:"GET",isArray:!1,url:"/odata/DriveReports?$filter=Id eq :id &$expand=DriveReportPoints",transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value[0]:(i=r.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)}}})}]);angular.module("app.drive").service("LicensePlate",["$resource",function(n){return n("/odata/LicensePlates(:id)",{id:"@id"},{get:{url:"/odata/LicensePlates?$filter=PersonId eq :id",method:"GET",transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value:(i=$modal.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)},isArray:!0},"delete":{method:"DELETE"},patch:{method:"PATCH"}})}]);angular.module("app.drive").service("MkColumnFormatter",[function(){return{format:function(n){if(n.KilometerAllowance==="CalculatedWithoutExtraDistance"){if(n.StartsAtHome||n.EndsAtHome)return"<div class='inline margin-left-5' kendo-tooltip k-content=\"'Der er kørt til og/eller fra bopælsadressen,<br>men anvendt Beregnet uden merkørsel'\"><i class='fa fa-minus'><\/i><\/div>"}else if(n.StartsAtHome||n.EndsAtHome)return"<div class='inline margin-left-5' kendo-tooltip k-content=\"'Der er kørt til og/eller fra bopælsadressen.<br/> Der er fratrukket merkørsel.'\"><i class='fa fa-check'><\/i><\/div>";return""}}}]);angular.module("app.drive").service("PersonalAddress",["$resource",function(n){return n("/odata/PersonalAddresses(:id)",{id:"@id"},{get:{method:"GET",isArray:!1},patch:{method:"PATCH"},"delete":{method:"DELETE"},post:{method:"POST"},GetHomeForUser:{method:"GET",isArray:!1,url:"/odata/PersonalAddresses/Service.GetHome?personId=:id",transformResponse:function(n){return angular.fromJson(n).value[0]}},GetRealHomeForUser:{method:"GET",isArray:!1,url:"/odata/PersonalAddresses/Service.GetRealHome?personId=:id",transformResponse:function(n){return angular.fromJson(n)}},GetAlternativeHomeForUser:{method:"GET",isArray:!1,url:"/odata/PersonalAddresses/Service.GetAlternativeHome?personId=:id",transformResponse:function(n){return angular.fromJson(n)}}})}]);angular.module("app.drive").service("PersonalAddressType",function(){return{Standard:"Standard",Home:"Home",Work:"Work",AlternativeHome:"AlternativeHome",AlternativeWork:"AlternativeWork",OldHome:"OldHome"}});angular.module("app.drive").service("PersonalRoute",["$resource",function(n){return n("/odata/PersonalRoutes(:id)?:query",{id:"@id",query:"@query"},{get:{method:"GET",isArray:!1},"delete":{method:"DELETE",isArray:!1},getForUser:{method:"GET",isArray:!0,url:"/odata/PersonalRoutes?$filter=PersonId eq :id &$expand=Points",transformResponse:function(n){return angular.fromJson(n).value}}})}]);angular.module("app.drive").service("Point",["$resource",function(n){return n("/odata/Points(:id)?:query",{id:"@id",query:"@query"},{get:{method:"GET",isArray:!1,transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t:(i=$modal.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)}},patch:{method:"PATCH",isArray:!1},post:{method:"POST",isArray:!1}})}]);angular.module("app.drive").service("Rate",["$resource",function(n){return n("/odata/Rates(:id)",{id:"@id"},{get:{method:"GET",isArray:!0,transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value:(i=$modal.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)}},ThisYearsRates:{method:"GET",isArray:!0,transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value:(i=$modal.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)},url:"/odata/Rates/Service.ThisYearsRates?$expand=Type"},post:{method:"POST"}})}]);angular.module("app.drive").service("RateType",["$resource",function(n){return n("/odata/RateTypes(:id)",{id:"@id"},{get:{method:"GET",isArray:!0,transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value:(i=$modal.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)}},getAll:{method:"GET",isArray:!0,transformResponse:function(n){return angular.fromJson(n).value}},post:{method:"POST"}})}]);angular.module("app.drive").service("Report",["$resource",function(n){return n("/odata/DriveReports(:id)",{id:"@id",emailText:"@emailText"},{get:{method:"GET",isArray:!0},patch:{method:"PATCH",isArray:!0,url:"/odata/DriveReports(:id)?emailText=:emailText"},getOwner:{url:"/odata/DriveReports?$filter=Id eq :id&$select=Person&$expand=Person",method:"GET",isArray:!1,transformResponse:function(n){return angular.fromJson(n).value[0].Person}},"delete":{method:"DELETE",isArray:!0}})}]);angular.module("app.drive").service("RouteColumnFormatter",[function(){return{format:function(n){var u="",t="",i,f,r,e,h;n.DriveReportPoints!=null&&n.DriveReportPoints!=undefined&&n.DriveReportPoints.length>0?angular.forEach(n.DriveReportPoints,function(i,r){r!=n.DriveReportPoints.length-1?(u+=i.StreetName+" "+i.StreetNumber+", "+i.ZipCode+" "+i.Town+"<br/>",t+=i.Town+"<br/>"):(u+=i.StreetName+" "+i.StreetNumber+", "+i.ZipCode+" "+i.Town,t+=i.Town)}):u=n.UserComment;t="<i class='fa fa-road fa-2x'><\/i>";i="<div class='inline margin-left-5' kendo-tooltip k-content=\"'"+u+"'\">"+t+"<\/div>";f="<div class='inline pull-right margin-right-5' kendo-tooltip k-content=\"'Se rute på kort'\"><a ng-click='showRouteModal("+n.Id+")'><i class='fa fa-globe fa-2x'><\/i><\/a><\/div>";n.IsOldMigratedReport&&(f="<div class='inline pull-right margin-right-5' kendo-tooltip k-content=\"'Denne indberetning er overført fra eIndberetning og der kan ikke genereres en rute på et kort'\"><i class='fa fa-circle-thin fa-2x'><\/i><\/a><\/div>");r="";n.IsRoundTrip&&(r="<div class='inline margin-left-5' kendo-tooltip k-content=\"'Ruten er tur/retur'\"><i class='fa fa-exchange fa-2x'><\/i><\/div>");e="";n.CreatedDateTimestamp<n.EditedDateTimestamp&&(e="<div class='inline pull-right margin-right-5' kendo-tooltip k-content=\"'Denne indberetning er blevet redigeret'\"><i class='fa fa-pencil fa-2x'><\/i><\/div>");var o=i+r+f,s=n.UserComment!=null?n.UserComment:"Ingen kommentar angivet",c="";return(s!="Ingen kommentar angivet"&&s!="Ingen kommentar indtastet"&&(c="<div class='inline margin-right-5 pull-right' kendo-tooltip k-content=\"'"+s+'\'"><i class="fa fa-2x fa-comment-o"><\/i><\/div>'),n.IsFromApp)?(h="<div class='inline margin-left-5'>Indberettet fra mobil app<\/div>"+c,n.DriveReportPoints.length>1?o=i+r+f+h+e:(i="<div class='inline margin-left-5' kendo-tooltip k-content=\"'Aflæst manuelt'\">"+t+"<\/div>",o=i+r+h+e),o):n.KilometerAllowance!="Read"?o:"<div class='inline' kendo-tooltip k-content=\"'"+s+"'\">Aflæst manuelt<\/div>"}}}]);angular.module("app.drive").service("RouteContainer",["$resource",function(n){return n("/odata/RouteContainer(:id)",{id:"@id"},{get:{method:"GET",isArray:!1}})}]);angular.module("app.drive").service("Route",["$resource",function(n){return n("/odata/PersonalRoutes(:id)?$expand=Points&:query",{id:"@id",query:"@query"},{get:{method:"GET",isArray:!1},getSingle:{method:"GET",isArray:!1,url:"/odata/PersonalRoutes?$expand=Points &$filter=Id eq :id",transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value[0]:(i=$modal.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)}},patch:{method:"PATCH",isArray:!1},post:{method:"POST",isArray:!1,url:"/odata/PersonalRoutes"},"delete":{method:"DELETE",isArray:!1}})}]);angular.module("app.drive").service("SmartAdresseSource",function(){return{type:"json",minLength:3,serverFiltering:!0,crossDomain:!0,transport:{read:{url:function(n){return"https://dawa.aws.dk/adgangsadresser/autocomplete?q="+encodeURIComponent(n.filter.filters[0].value)},dataType:"jsonp",data:{}}},schema:{data:function(n){return n}}}});angular.module("app.drive").service("StandardAddress",["$resource",function(n){return n("/odata/Addresses(:id)",{id:"@id"},{get:{method:"GET",isArray:!1},"delete":{method:"DELETE",isArray:!1},patch:{method:"PATCH",isArray:!1},post:{method:"POST",isArray:!1},GetStandard:{method:"GET",url:"/odata/Addresses/Service.GetStandard",isArray:!0,transformResponse:function(n){var t=angular.fromJson(n),i;return t.error==undefined?t.value:(i=$modal.open({templateUrl:"/App/Services/Error/ServiceError.html",controller:"ServiceErrorController",backdrop:"static",resolve:{errorMsg:function(){return t.error.innererror.message}}}),t)}}})}]);angular.module("app.drive").service("Token",["$resource",function(n){return n("/odata/MobileToken(:id)",{id:"@id"},{"delete":{method:"DELETE"}})}]);angular.module("app.drive").controller("AlternativeAddressController",["$scope","SmartAdresseSource","$rootScope","$timeout","PersonEmployments","AddressFormatter","Address","NotificationService","PersonalAddress",function(n,t,i,r,u,f,e,o,s){var v,y,w,p,a;n.employments=i.CurrentUser.Employments;n.homeAddress="";n.alternativeHomeAddress={};n.alternativeHomeAddress.string="";var c=!1,h=[],l=[];s.GetRealHomeForUser({id:i.CurrentUser.Id}).$promise.then(function(t){n.homeAddress=t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town});n.AlternativeWorkAddressHelpText=i.HelpTexts.AlternativeWorkAddressHelpText.text;n.AlternativeWorkDistanceHelpText=i.HelpTexts.AlternativeWorkDistanceHelpText.text;s.GetAlternativeHomeForUser({id:i.CurrentUser.Id}).$promise.then(function(t){t.StreetNumber==undefined||(n.alternativeHomeAddress=t,n.alternativeHomeAddress.string=t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town)});n.Number=Number;n.toString=toString;n.replace=String.replace;n.alternativeWorkAddresses=[];n.alternativeWorkDistances=[];v=function(){angular.forEach(n.employments,function(t,i){if(t.AlternativeWorkAddress!=null){var r=t.AlternativeWorkAddress;n.alternativeWorkAddresses[i]=r.StreetName+" "+r.StreetNumber+", "+r.ZipCode+" "+r.Town}t.WorkDistanceOverride!=""&&t.WorkDistanceOverride!=null&&(n.alternativeWorkDistances[i]=t.WorkDistanceOverride)})};v();n.alternativeWorkDistanceChanged=function(n){l[n]=!0};n.alternativeWorkAddressChanged=function(n){h[n]=!0};y=function(t){return n.alternativeWorkAddresses[t]!=""&&n.alternativeWorkAddresses[t]!=undefined};w=function(t){return n.alternativeWorkDistances[t]!=""&&n.alternativeWorkDistances[t]!=undefined&&n.alternativeWorkDistances>0};n.saveAlternativeWorkAddress=function(n){r(function(){d(n)})};var b=function(t){var r=f.fn(n.alternativeWorkAddresses[t]);n.employments[t].AlternativeWorkAddress==null||n.employments[t].AlternativeWorkAddress==undefined?e.post({StreetName:r.StreetName,StreetNumber:r.StreetNumber,Town:r.Town,ZipCode:r.ZipCode,PersonId:i.CurrentUser.Id,Description:"Afvigende "+n.employments[t].OrgUnit.LongDescription,Longitude:"",Latitude:"",Type:"AlternativeWork"}).$promise.then(function(r){h[t]=!1;n.employments[t].AlternativeWorkAddress=r;n.employments[t].AlternativeWorkAddressId=r.Id;u.patchEmployment({id:n.employments[t].Id},{AlternativeWorkAddressId:r.Id}).$promise.then(function(){o.AutoFadeNotification("success","","Afvigende arbejdsadresse oprettet.");i.$emit("PersonalAddressesChanged")})}):e.patch({id:n.employments[t].AlternativeWorkAddressId},{StreetName:r.StreetName,StreetNumber:r.StreetNumber,Town:r.Town,ZipCode:r.ZipCode,Longitude:"",Latitude:""}).$promise.then(function(r){n.employments[t].AlternativeWorkAddress=r;n.employments[t].AlternativeWorkAddressId=r.Id;h[t]=!1;o.AutoFadeNotification("success","","Afvigende arbejdsadresse redigeret.");i.$emit("PersonalAddressesChanged")})},k=function(t){n.alternativeWorkDistances[t]==""&&(n.alternativeWorkDistances[t]=0);u.patchEmployment({id:n.employments[t].Id},{WorkDistanceOverride:n.alternativeWorkDistances[t]}).$promise.then(function(){l[t]=!1;n.employments[t].WorkDistanceOverride=n.alternativeWorkDistances[t];o.AutoFadeNotification("success","","Afvigende afstand mellem hjem og arbejde gemt.")})},d=function(t){if(n.alternativeWorkDistances[t]!=undefined&&(n.alternativeWorkDistances[t].toString().indexOf(".")>-1||n.alternativeWorkDistances[t].toString().indexOf(",")>-1)){o.AutoFadeNotification("warning","","Afvigende km på ikke indeholde komma eller punktum.");return}y(t)&&b(t);k(t)};n.clearWorkClicked=function(t){u.patchEmployment({id:n.employments[t].Id},{WorkDistanceOverride:0,AlternativeWorkAddress:null,AlternativeWorkAddressId:null}).$promise.then(function(){h[t]=!1;l[t]=!1;n.alternativeWorkDistances[t]=0;n.alternativeWorkAddresses[t]="";n.employments[t].AlternativeWorkAddressId!=null?e.delete({id:n.employments[t].AlternativeWorkAddressId}).$promise.then(function(){i.$emit("PersonalAddressesChanged");n.employments[t].AlternativeWorkAddress=null;n.employments[t].AlternativeWorkAddressId=null;o.AutoFadeNotification("success","","Afvigende afstand og adresse slettet.")}):(i.$emit("PersonalAddressesChanged"),n.employments[t].AlternativeWorkAddress=null,n.employments[t].AlternativeWorkAddressId=null,o.AutoFadeNotification("success","","Afvigende afstand og adresse slettet."))})};n.saveAlternativeHomeAddress=function(){r(function(){p()})};p=function(){if(n.alternativeHomeAddress.string!=undefined&&n.alternativeHomeAddress.string!=null&&n.alternativeHomeAddress.string!=""){var t=f.fn(n.alternativeHomeAddress.string);n.alternativeHomeAddress.Id!=undefined?s.patch({id:n.alternativeHomeAddress.Id},{StreetName:t.StreetName,StreetNumber:t.StreetNumber,ZipCode:t.ZipCode,Town:t.Town,Latitude:"",Longitude:"",Description:"Afvigende hjemmeadresse",Type:"AlternativeHome"}).$promise.then(function(){o.AutoFadeNotification("success","","Afvigende hjemmeadresse redigeret.");c=!1;i.$emit("PersonalAddressesChanged")}):s.post({StreetName:t.StreetName,StreetNumber:t.StreetNumber,ZipCode:t.ZipCode,Town:t.Town,Latitude:"",Longitude:"",PersonId:i.CurrentUser.Id,Type:"AlternativeHome",Description:"Afvigende hjemmeadresse"}).$promise.then(function(t){n.alternativeHomeAddress=t;n.alternativeHomeAddress.string=t.StreetName+" "+t.StreetNumber+", "+t.ZipCode+" "+t.Town;o.AutoFadeNotification("success","","Afvigende hjemmeadresse oprettet.");c=!1;i.$emit("PersonalAddressesChanged")})}else n.alternativeHomeAddress.string==""&&n.alternativeHomeAddress.Id!=undefined&&n.clearHomeClicked()};n.clearHomeClicked=function(){n.alternativeHomeAddress.string="";n.alternativeHomeAddress.Id!=undefined?s.delete({id:n.alternativeHomeAddress.Id}).$promise.then(function(){n.alternativeHomeAddress=null;o.AutoFadeNotification("success","","Afvigende hjemmeadresse slettet.");i.$emit("PersonalAddressesChanged")}):o.AutoFadeNotification("success","","Afvigende hjemmeadresse slettet.")};n.homeAddressChanged=function(){c=!0};a=function(){var t=!1;return n.alternativeHomeAddress!=undefined&&c===!0&&n.alternativeHomeAddress.string!=n.alternativeHomeAddress.StreetName+" "+n.alternativeHomeAddress.StreetNumber+", "+n.alternativeHomeAddress.ZipCode+" "+n.alternativeHomeAddress.Town&&(t=!0),angular.forEach(h,function(n){n==!0&&(t=!0)}),angular.forEach(l,function(n){n==!0&&(t=!0)}),t};n.$on("$stateChangeStart",function(n){if(a()===!0){var t=confirm("Du har lavet ændringer på siden, der ikke er gemt. Ønsker du at kassere disse ændringer?");t||n.preventDefault()}});window.onbeforeunload=function(){if(a()===!0)return"Du har lavet ændringer på siden, der ikke er gemt. Ønsker du at kassere disse ændringer?"};n.$on("$destroy",function(){window.onbeforeunload=undefined});n.SmartAddress=t}]);angular.module("app.drive").controller("SettingsController",["$scope","$modal","Person","LicensePlate","PersonalRoute","Point","Address","Route","AddressFormatter","$http","NotificationService","Token","SmartAdresseSource","$rootScope","$timeout","AppLogin",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w,b;n.gridContainer={};n.isCollapsed=!0;n.licenseplates=[];n.newLicensePlate="";n.newLicensePlateDescription="";n.workDistanceOverride=0;n.routes=[];n.addresses=[];n.tokens=[];n.isCollapsed=!0;n.tokenIsCollapsed=!0;n.newTokenDescription="";n.mobileTokenHelpText=v.HelpTexts.MobileTokenHelpText.text;n.primaryLicensePlateHelpText=v.HelpTexts.PrimaryLicensePlateHelpText.text;n.AlternativeHomeAddressHelpText=v.HelpTexts.AlternativeHomeAddressHelpText.text;w=v.CurrentUser.Id;n.currentPerson=v.CurrentUser;n.mailAdvice=n.currentPerson.RecieveMail;n.showMailNotification=v.CurrentUser.IsLeader||v.CurrentUser.IsSubstitute;n.employments=v.CurrentUser.Employments;n.gridContainer={};n.licenseplates=v.CurrentUser.LicensePlates;n.SmartAddress=a;n.saveNewLicensePlate=function(){var t=n.newLicensePlate.replace(/ /g,""),u;if(t.length<2||t.length>7){c.AutoFadeNotification("danger","","Nummerpladens længde skal være mellem 2 og 7 tegn (Mellemrum tæller ikke med)");return}u=new r({Plate:n.newLicensePlate,Description:n.newLicensePlateDescription,PersonId:w});u.$save(function(t){n.licenseplates.push(t);n.licenseplates.sort(function(n,t){return n.Id>t.Id});n.newLicensePlate="";n.newLicensePlateDescription="";c.AutoFadeNotification("success","","Ny nummerplade blev gemt");i.GetCurrentUser().$promise.then(function(n){v.CurrentUser=n})},function(){c.AutoFadeNotification("danger","","Nummerplade blev ikke gemt")})};n.openConfirmDeleteLicenseModal=function(i){var r=t.open({templateUrl:"/App/Drive/Settings/ConfirmDeleteLicenseModal.html",controller:"AppLoginModalController",backdrop:"static"});r.result.then(function(){n.deleteLicensePlate(i)},function(){})};n.deleteLicensePlate=function(t){r.delete({id:t.Id},function(){c.AutoFadeNotification("success","","Nummerplade blev slettet");r.get({id:w},function(t){n.licenseplates=t});i.GetCurrentUser().$promise.then(function(n){v.CurrentUser=n})}),function(){c.AutoFadeNotification("danger","","Nummerplade blev ikke slettet")}};n.setReceiveMail=function(t){y(function(){var r=new i({RecieveMail:t});r.$patch({id:w},function(){n.mailAdvice=t;v.CurrentUser.RecieveMail=t;c.AutoFadeNotification("success","","Valg om modtagelse af mails blev gemt")}),function(){c.AutoFadeNotification("danger","","Valg om modtagelse af mails blev ikke gemt")}})};n.loadGrids=function(t){n.personalRoutes={dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"odata/PersonalRoutes()?$filter=PersonId eq "+t+"&$expand=Points",dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverSorting:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} personlige ruter",empty:"Ingen personlige ruter at vise",page:"Side",of:"af {0}",itemsPerPage:"personlige ruter pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{field:"Description",title:"Beskrivelse"},{field:"Points",template:function(n){var t=[];return angular.forEach(n.Points,function(n){n.PreviousPointId==undefined&&this.push(n.StreetName+" "+n.StreetNumber+", "+n.ZipCode+" "+n.Town)},t),t},title:"Fra"},{field:"Points",template:function(n){var t=[];return angular.forEach(n.Points,function(n){n.NextPointId==null&&this.push(n.StreetName+" "+n.StreetNumber+", "+n.ZipCode+" "+n.Town)},t),t},title:"Til"},{title:"Via",field:"Points",width:50,template:function(n){var t="",i=n.Points.length-2;return angular.forEach(n.Points,function(i,r){r!=0&&r!=n.Points.length-1&&(t+=i.StreetName+" "+i.StreetNumber+", "+i.ZipCode+" "+i.Town+"<br/>")}),"<div kendo-tooltip k-content=\"'"+t+"'\">"+i+"<\/div>"}},{field:"Id",title:"Muligheder",template:"<a ng-click='openRouteEditModal(${Id})'>Rediger<\/a> | <a ng-click='openRouteDeleteModal(${Id})'>Slet<\/a>"}]};n.personalAddresses={dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"odata/PersonalAddresses()?$filter=PersonId eq "+w+" and Type ne Core.DomainModel.PersonalAddressType'OldHome'",dataType:"json",cache:!1}},pageSize:5,serverPaging:!1,serverSorting:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} personlige adresser",empty:"Ingen personlige adresser at vise",page:"Side",of:"af {0}",itemsPerPage:"personlige adresser pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},sort:{field:"Description",dir:"asc"},columns:[{field:"Description",title:"Beskrivelse",template:function(n){return n.Type=="Home"?"Hjemmeadresse":n.Description}},{field:"Id",template:function(n){return n.StreetName+" "+n.StreetNumber+", "+n.ZipCode+" "+n.Town},title:"Adresse"},{field:"Id",title:"Muligheder",template:function(n){return n.Type=="Standard"?"<a ng-click='openAddressEditModal("+n.Id+")'>Rediger<\/a> | <a ng-click='openAddressDeleteModal("+n.Id+")'>Slet<\/a>":""}}]}};v.$on("PersonalAddressesChanged",function(){n.updatePersonalAddresses()});n.loadGrids(v.CurrentUser.Id);n.updatePersonalAddresses=function(){n.gridContainer.personalAddressesGrid.dataSource.transport.options.read.url="odata/PersonalAddresses()?$filter=PersonId eq "+n.currentPerson.Id;n.gridContainer.personalAddressesGrid.dataSource.read();i.GetCurrentUser().$promise.then(function(n){v.CurrentUser=n})};n.updatePersonalRoutes=function(){n.gridcontainer.personalRoutesGrid.dataSource.transport.options.read.url="odata/PersonalRoutes()?$filter=PersonId eq "+n.currentPerson.Id+"&$expand=Points";n.gridcontainer.personalRoutesGrid.dataSource.read();i.GetCurrentUser().$promise.then(function(n){v.CurrentUser=n})};n.openRouteEditModal=function(i){var r=t.open({templateUrl:"/App/Drive/Settings/RouteEditModal.html",controller:"RouteEditModalInstanceController",backdrop:"static",resolve:{routeId:function(){return i},personId:function(){return n.currentPerson.Id}}});r.result.then(function(){n.updatePersonalRoutes()})};n.openRouteAddModal=function(){var i=t.open({templateUrl:"/App/Drive/Settings/RouteAddModal.html",controller:"RouteEditModalInstanceController",backdrop:"static",resolve:{routeId:function(){return},personId:function(){return n.currentPerson.Id}}});i.result.then(function(){n.updatePersonalRoutes()})};n.openRouteDeleteModal=function(i){var r=t.open({templateUrl:"/App/Drive/Settings/RouteDeleteModal.html",controller:"RouteDeleteModalInstanceController",backdrop:"static",resolve:{routeId:function(){return i},personId:function(){return n.currentPerson.Id}}});r.result.then(function(){n.updatePersonalRoutes()})};n.openAddressAddModal=function(){var i=t.open({templateUrl:"/App/Drive/Settings/AddressAddModal.html",controller:"AddressEditModalInstanceController",backdrop:"static",resolve:{addressId:function(){return},personId:function(){return n.currentPerson.Id}}});i.result.then(function(){n.updatePersonalAddresses()})};n.openAddressEditModal=function(i){var r=t.open({templateUrl:"/App/Drive/Settings/AddressEditModal.html",controller:"AddressEditModalInstanceController",backdrop:"static",resolve:{addressId:function(){return i},personId:function(){return n.currentPerson.Id}}});r.result.then(function(){n.updatePersonalAddresses()})};n.openAddressDeleteModal=function(i){var r=t.open({templateUrl:"/App/Drive/Settings/AddressDeleteModal.html",controller:"AddressDeleteModalInstanceController",backdrop:"static",resolve:{addressId:function(){return i},personId:function(){return n.currentPerson.Id}}});r.result.then(function(){n.updatePersonalAddresses()})};n.openConfirmDeleteAppPasswordModal=function(){var i=t.open({templateUrl:"/App/Drive/Settings/confirmDeleteAppPasswordModal.html",controller:"AppLoginModalController",backdrop:"static"});i.result.then(function(){p.delete({id:n.currentPerson.Id}).$promise.then(function(){n.currentPerson.HasAppPassword=!1;v.CurrentUser.HasAppPassword=!1;c.AutoFadeNotification("success","","App login blev nulstillet.")})},function(){})};n.openConfirmCreateAppPasswordModal=function(){var i=t.open({templateUrl:"/App/Drive/Settings/confirmCreateAppLoginModal.html",controller:"AppLoginModalController",backdrop:"static"});i.result.then(function(t){var i={Password:t,UserName:n.currentPerson.Initials,PersonId:n.currentPerson.Id};p.post(i).$promise.then(function(){n.currentPerson.HasAppPassword=!0;v.CurrentUser.HasAppPassword=!0;c.AutoFadeNotification("success","","App login blev oprettet.")})},function(){})};n.makeLicensePlatePrimary=function(t){r.patch({id:t.Id},{IsPrimary:!0},function(){r.get({id:w},function(t){n.licenseplates=t})})};n.openAlternativeWorkAddressModal=function(){var n=t.open({templateUrl:"/App/Drive/Settings/AlternativeWorkAddressModal.html",controller:"AlternativeWorkAddressModalController",backdrop:"static"});n.result.then(function(){},function(){})};b=function(){return n.newLicensePlate!=""||n.newLicensePlateDescription!=""?!0:!1};n.$on("$stateChangeStart",function(n){if(b()===!0){var t=confirm("Du har lavet ændringer på siden, der ikke er gemt. Ønsker du at kassere disse ændringer?");t||n.preventDefault()}});window.onbeforeunload=function(){if(b()===!0)return"Du har lavet ændringer på siden, der ikke er gemt. Ønsker du at kassere disse ændringer?"};n.$on("$destroy",function(){window.onbeforeunload=undefined})}]);angular.module("app.drive").controller("AddressDeleteModalInstanceController",["$scope","Address","Point","NotificationService","$modalInstance","addressId","personId","AddressFormatter",function(n,t,i,r,u,f){n.confirmDelete=function(){t.delete({id:f},function(){r.AutoFadeNotification("success","","Adresse slettet");u.close("")})};n.cancelDelete=function(){u.dismiss("")}}]);angular.module("app.drive").controller("AddressEditModalInstanceController",["$scope","$modalInstance","Address","personId","addressId","NotificationService","AddressFormatter","SmartAdresseSource",function(n,t,i,r,u,f,e,o){n.newAddress="";n.oldAddressId=0;n.oldAddress="";n.addressDescription="";n.loadAddressData=function(){u!=undefined&&i.get({query:"$filter=Id eq "+u},function(t){n.oldAddressId=t.value[0].Id;n.addressDescription=t.value[0].Description;n.oldAddress=t.value[0].StreetName+" "+t.value[0].StreetNumber+", "+t.value[0].ZipCode+" "+t.value[0].Town})};n.loadAddressData();n.addressNotFound=!1;n.addressFieldOptions={dataBound:function(){n.addressNotFound=this.dataSource._data.length==0;n.$apply()}};n.saveEditedAddress=function(){var o,s,h;n.addressNotFound||(n.newAddress=n.oldAddress,o=e.fn(n.newAddress),u!=undefined?(o.Id=n.oldAddressId,o.PersonId=r,o.Description=n.addressDescription,s=new i({PersonId:r,StreetName:o.StreetName,StreetNumber:o.StreetNumber,ZipCode:parseInt(o.ZipCode),Town:o.Town,Description:n.addressDescription}),s.$patch({id:o.Id},function(){f.AutoFadeNotification("success","","Adresse opdateret");t.close("")},function(){f.AutoFadeNotification("danger","","Adresse blev ikke opdateret")})):(h=new i({PersonId:r,StreetName:o.StreetName,StreetNumber:o.StreetNumber,ZipCode:parseInt(o.ZipCode),Town:o.Town,Description:n.addressDescription,Latitude:"",Longitude:"",Type:"Standard"}),h.$post(function(){f.AutoFadeNotification("success","","Adresse oprettet");t.close("")},function(){f.AutoFadeNotification("danger","","Adresse blev ikke oprettet")})))};n.SmartAddress=o;n.closeAddressEditModal=function(){t.close({})}}]);angular.module("app.drive").controller("TokenInstanceController",["$scope","NotificationService","$modalInstance","Token","personId","$modal",function(){}]);angular.module("app.drive").controller("AppLoginModalController",["$scope","$modalInstance",function(n,t){n.confirmDelete=function(){t.close()};n.cancelDelete=function(){t.dismiss("cancel")};n.createAppPassword=function(){t.close(n.password)}}]);angular.module("app.drive").controller("RouteDeleteModalInstanceController",["$scope","Route","Point","NotificationService","$modalInstance","routeId","personId","AddressFormatter",function(n,t,i,r,u,f){n.confirmDelete=function(){t.delete({id:f},function(){r.AutoFadeNotification("success","","Rute slettet");u.close("")})};n.cancelDelete=function(){u.dismiss("")}}]);angular.module("app.drive").controller("RouteEditModalInstanceController",["$scope","Route","Point","NotificationService","$modalInstance","routeId","personId","AddressFormatter","SmartAdresseSource",function(n,t,i,r,u,f,e,o,s){n.viaPointModels=[];n.isSaveDisabled=!1;n.addressFieldOptions={dataBound:function(){n.addressNotFound=this.dataSource._data.length==0;n.$apply()}};f!=undefined&&t.getSingle({id:f},function(t){n.newRouteDescription=t.Description;n.newStartPoint=t.Points[0].StreetName+" "+t.Points[0].StreetNumber+", "+t.Points[0].ZipCode+" "+t.Points[0].Town;n.newEndPoint=t.Points[t.Points.length-1].StreetName+" "+t.Points[t.Points.length-1].StreetNumber+", "+t.Points[t.Points.length-1].ZipCode+" "+t.Points[t.Points.length-1].Town;angular.forEach(t.Points,function(i,r){if(r!=0&&r!=t.Points.length-1){var u=i.StreetName+" "+i.StreetNumber+", "+i.ZipCode+" "+i.Town;n.viaPointModels.push(u)}})});n.saveRoute=function(){n.addressNotFound||(n.isSaveDisabled=!0,f!=undefined?t.delete({id:f},function(){h()}):h())};var h=function(){var i,s,h;if(n.newStartPoint==undefined||n.newStartPoint==""||n.newEndPoint==undefined||n.newEndPoint==""){r.AutoFadeNotification("danger","","Start- og slutadresse skal udfyldes.");n.isSaveDisabled=!1;return}if(n.newRouteDescription==""||n.newRouteDescription==undefined){r.AutoFadeNotification("danger","","Beskrivelse må ikke være tom.");n.isSaveDisabled=!1;return}i=[];s=o.fn(n.newStartPoint);i.push({StreetName:s.StreetName,StreetNumber:s.StreetNumber,ZipCode:s.ZipCode,Town:s.Town,Latitude:"",Longitude:"",Description:""});angular.forEach(n.viaPointModels,function(n){var t=o.fn(n);i.push({StreetName:t.StreetName,StreetNumber:t.StreetNumber,ZipCode:t.ZipCode,Town:t.Town,Latitude:"",Longitude:"",Description:""})});h=o.fn(n.newEndPoint);i.push({StreetName:h.StreetName,StreetNumber:h.StreetNumber,ZipCode:h.ZipCode,Town:h.Town,Latitude:"",Longitude:"",Description:""});t.post({Description:n.newRouteDescription,PersonId:e,Points:i},function(){f!=undefined?r.AutoFadeNotification("success","","Personlig rute blev redigeret."):r.AutoFadeNotification("success","","Personlig rute blev oprettet.");u.close()})};n.removeViaPoint=function(t){n.viaPointModels.splice(t,1)};n.addNewViaPoint=function(){n.viaPointModels.push("")};n.closeRouteEditModal=function(){u.dismiss()};n.SmartAddress=s}]);__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(){"use strict";var t=n.core.models.ReportType,i=n.core.controllers.BaseSubstitutesController,r=function(n){function i(i,r,u,f,e,o,s,h){n.call(this,i,r,u,f,e,o,s,h,t.Drive);this.$scope=i;this.Person=r;this.$rootScope=u;this.HelpText=f;this.Autocomplete=e;this.$modal=o;this.$timeout=s;this.moment=h}return __extends(i,n),i.$inject=["$scope","Person","$rootScope","HelpText","Autocomplete","$modal","$timeout","moment"],i}(i);angular.module("app.drive").controller("Drive.SubstitutesController",r)})(t=n.drive||(n.drive={}))}(app||(app={})),function(n){var t;(function(){"use strict";angular.module("app.vacation",["app.core","kendo.directives","ui.router","ui.bootstrap","ui.bootstrap.tooltip","ngResource","template/modal/window.html","template/modal/window.html","template/modal/backdrop.html","template/tabs/tab.html","template/tabs/tabset.html","angularMoment","template/popover/popover.html","kendo-ie-fix","angular-loading-bar","ui.router.tabs"])})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(n){var t=function(){function n(){}return n.init=function(n){n.state("vacation.report",{url:"/report",templateUrl:"/App/Vacation/ReportVacation/ReportVacationView.html",controller:"CreateReportVacationController",controllerAs:"rvc"}).state("vacation.approve",{url:"/approve",templateUrl:"/App/Vacation/ApproveVacation/ApproveVacationView.html",controller:"ApproveVacationController",controllerAs:"avCtrl",data:{roles:["Approver"]}}).state("vacation.approve.pending",{url:"/pending",templateUrl:"/App/Vacation/ApproveVacation/ApproveVacationPending/ApproveVacationPendingView.html",controller:"ApproveVacationPendingController",controllerAs:"avpCtrl",data:{roles:["Approver"]}}).state("vacation.approve.balance",{url:"/balance",templateUrl:"/App/Vacation/ApproveVacation/ApproveVacationBalance/ApproveVacationBalanceView.html",controller:"ApproveVacationBalanceController",controllerAs:"avbCtrl",data:{roles:["Approver"]}}).state("vacation.approve.settings",{url:"/settings",templateUrl:"/App/Core/Views/ApproveReportsSettingsView.html",controller:"ApproveVacationSettingsController",controllerAs:"arsCtrl",data:{roles:["Approver"]}}).state("vacation.admin",{url:"/admin",templateUrl:"/App/Vacation/Admin/AdminView.html",controller:"Vacation.AdminMenuController",controllerAs:"ctrl",data:{roles:["Admin"]}}).state("vacation.overview",{url:"/overview",controller:"VacationOverviewController",controllerAs:"voc",templateUrl:"/App/Vacation/Overview/VacationOverviewView.html"}).state("vacation.myreports",{url:"/myreports",controller:"MyVacationReportsController",controllerAs:"mvrc",templateUrl:"/App/Vacation/MyVacationReports/MyVacationReportsView.html"}).state("vacation.myreports.pending",{url:"/pending",templateUrl:"/App/Vacation/MyVacationReports/MyPendingVacationReports/MyPendingVacationReportsView.html",controller:"MyPendingVacationReportsController",controllerAs:"mvrCtrl"}).state("vacation.myreports.pending.edit",{url:"/modal/:vacationReportId",onEnter:["$state","$modal","$stateParams",function(n,t,i){t.open({templateUrl:"/App/Vacation/MyVacationReports/EditVacationReportTemplate.html",controller:"EditReportVacationController as rvc",backdrop:"static",windowClass:"app-modal-window-full",resolve:{vacationReportId:function(){return i.vacationReportId}}}).result.then(function(){n.go("^",null,{reload:!0})},function(){n.go("^")})}]}).state("vacation.myreports.approved",{url:"/approved",templateUrl:"/App/Vacation/MyVacationReports/MyApprovedVacationReports/MyApprovedVacationReportsView.html",controller:"MyApprovedVacationReportsController",controllerAs:"mvrCtrl"}).state("vacation.myreports.approved.edit",{url:"/modal/:vacationReportId",onEnter:["$state","$modal","$stateParams",function(n,t,i){t.open({templateUrl:"/App/Vacation/MyVacationReports/EditVacationReportTemplate.html",controller:"EditReportVacationController as rvc",backdrop:"static",windowClass:"app-modal-window-full",resolve:{vacationReportId:function(){return i.vacationReportId}}}).result.then(function(){n.go("^",null,{reload:!0})},function(){n.go("^")})}]}).state("vacation.myreports.rejected",{url:"/rejected",templateUrl:"/App/Vacation/MyVacationReports/MyRejectedVacationReports/MyRejectedVacationReportsView.html",controller:"MyRejectedVacationReportsController",controllerAs:"mvrCtrl"})},n.$inject=["$stateProvider"],n}();n.Routes=t;angular.module("app.vacation").config(t.init)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(n,t,i,r){this.$scope=n;this.Person=t;this.$rootScope=i;this.HelpText=r;this.currentUser=n.CurrentUser}return n.prototype.orgSettingsClicked=function(){this.$scope.$broadcast("Vacation.OrgSettingsClicked")},n.prototype.adminClicked=function(){this.$scope.$broadcast("Vacation.AdministrationClicked")},n.prototype.reportsClicked=function(){this.$scope.$broadcast("Vacation.ReportsClicked")},n.prototype.accountClicked=function(){this.$scope.$broadcast("Vacation.AccountClicked")},n.prototype.emailClicked=function(){this.$scope.$broadcast("Vacation.EmailClicked")},n.$inject=["$scope","Person","$rootScope","HelpText"],n}();angular.module("app.vacation").controller("Vacation.AdminMenuController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(n,t,i,r,u,f){this.$scope=n;this.$rootScope=t;this.OrgUnit=i;this.NotificationService=r;this.Autocomplete=u;this.$modal=f;this.selectedHasAccess=-1;this.orgUnits=u.orgUnits();this.autoCompleteOptions={filter:"contains",select:function(n){this.orgUnit=this.dataItem(n.item.index())}};this.gridOptions={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{beforeSend:function(n){n.setRequestHeader("Accept","application/json;odata=fullmetadata")},url:"/odata/OrgUnits",dataType:"json",cache:!1}},schema:{model:{fields:{OrgId:{editable:!1},ShortDescription:{editable:!1},LongDescription:{editable:!1},HasAccessToVacation:{editable:!1}}}},pageSize:20,serverPaging:!0,serverFiltering:!0},sortable:!0,pageable:{messages:{display:"{0} - {1} af {2} organisationsenheder",empty:"Ingen organisationsenheder at vise",page:"Side",of:"af {0}",itemsPerPage:"Organisationsenheder pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},editable:!0,columns:[{field:"OrgId",title:"Organisations ID"},{field:"ShortDescription",title:"Kort beskrivelse"},{field:"LongDescription",title:"Lang beskrivelse"},{field:"HasAccessToVacation",title:"Adgang til ferie",template:function(n){return n.HasAccessToVacation?"<input type='checkbox' ng-click='orgUnitsCtrl.rowChecked("+n.Id+", false)' checked><\/input>":"<input type='checkbox' ng-click='orgUnitsCtrl.rowChecked("+n.Id+", true)'><\/input>"}}]}}return n.prototype.orgUnitChanged=function(){this.updateSourceUrl()},n.prototype.updateSourceUrl=function(){var n="/odata/OrgUnits";Object.keys(this.chosenUnit).length!==0?n+="?$filter=contains(LongDescription,'"+encodeURIComponent(this.chosenUnit+"')"):this.selectedHasAccess!==-1&&(n+="?$filter=HasAccessToFourKmRule eq "+(this.selectedHasAccess===0?"false":"true"));this.grid.dataSource.transport.options.read.url=n;this.grid.dataSource.read()},n.prototype.refreshGrid=function(){this.grid.dataSource.read()},n.prototype.rowChecked=function(n,t){var i=this;this.$modal.open({templateUrl:"/App/Vacation/Admin/OrgUnits/VacationHasAccessToVacationModalView.html",controller:"VacationHasAccessToVacationModalController as vhatvmc",backdrop:"static"}).result.then(function(r){i.OrgUnit.SetVacationAccess({id:n,value:t,recursive:r},function(){t?i.NotificationService.AutoFadeNotification("success","","Adgang til ferie tilføjet."):i.NotificationService.AutoFadeNotification("success","","Adgang til ferie fjernet.");i.refreshGrid()})})},n.$inject=["$scope","$rootScope","OrgUnit","NotificationService","Autocomplete","$modal"],n}();angular.module("app.vacation").controller("VacationAdminOrgUnitController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(n,t,i){this.$scope=n;this.$modalInstance=t;this.$modal=i}return n.prototype.close=function(){this.$modalInstance.close(!1)},n.prototype.all=function(){this.$modalInstance.close(!0)},n.$inject=["$scope","$modalInstance","$modal",],n}();angular.module("app.vacation").controller("VacationHasAccessToVacationModalController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(){"use strict";var t=n.core.models.ReportType,i=n.core.controllers.BaseSubstitutesController,r=function(n){function i(i,r,u,f,e,o,s,h){n.call(this,i,r,u,f,e,o,s,h,t.Vacation);this.$scope=i;this.Person=r;this.$rootScope=u;this.HelpText=f;this.Autocomplete=e;this.$modal=o;this.$timeout=s;this.moment=h}return __extends(i,n),i.$inject=["$scope","Person","$rootScope","HelpText","Autocomplete","$modal","$timeout","moment"],i}(i);angular.module("app.vacation").controller("Vacation.SubstitutesController",r)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(){this.tabData=[{heading:"Overblik",route:"vacation.approve.pending"},{heading:"Feriesaldo",route:"vacation.approve.balance"},{heading:"Stedfortrædere",route:"vacation.approve.settings"}]}return n.$inject=[],n}();angular.module("app.vacation").controller("ApproveVacationController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(n,t,i,r,u,f,e,o,s,h){var a=this,v,y,c,l,p;this.$scope=n;this.$rootScope=t;this.VacationReport=i;this.NotificationService=r;this.VacationBalanceResource=u;this.moment=f;this.$state=e;this.$modalInstance=o;this.$modal=s;this.report=h;this.id=h.personId;u.forEmployment({id:h.EmploymentId}).$promise.then(function(n){a.vacationBalance=n;a.calculateBalance(n);a.calculatePayDeduction()});this.name=h.Person.FullName.split("[")[0];this.purpose=h.description==null?h.Purpose:h.description;v=h.StartTime==null;y=h.EndTime==null;h.EndTimestamp==null?(c=h.end,l=h.start):(c=f.unix(h.EndTimestamp).toDate(),l=f.unix(h.StartTimestamp).toDate());this.vacationTime=f(c).diff(f(l),"days")*7.4;this.startTime=v?"Hele dagen":"Fra kl. "+f(f.duration(h.StartTime)._data).format("HH:mm");y?(this.endTime="Hele dagen",c-=86400):this.endTime="Til kl. "+f(f.duration(h.EndTime)._data).format("HH:mm");this.start=f(l).format("DD.MM.YYYY");this.end=f(c).format("DD.MM.YYYY");p=h.type==null?h.VacationType:h.type;switch(p){case"Care":this.type="Omsorgsdage";this.optionalText=h.OptionalText;break;case"Optional":this.type="Andet fravær";this.optionalText=h.OptionalText;break;case"Regular":this.type="Almindelig Ferie";break;case"Senior":this.type="Seniordage";break;case"SixthVacationWeek":this.type="6. ferieuge";break;default:this.type="Andet"}switch(this.report.status){case"Accepted":this.status="Godkendt";break;case"Rejected":this.status="Afvist";break;case"Pending":this.status="Afventende";break;default:this.status="Ukendt"}}return n.prototype.close=function(){this.$modalInstance.dismiss()},n.prototype.approve=function(){var n=this,i=new this.VacationReport,t;t=this.report.id==null?this.report.Id:this.report.id;this.loadingPromise=i.$approve({id:t},function(){n.NotificationService.AutoFadeNotification("success","","Indberetningen blev godkendt.");n.$modalInstance.close()},function(t){if(console.log(t),t.data.error.message==null)n.NotificationService.AutoFadeNotification("danger","","Der skete en ukendt fejl");else{var i=t.data.error.message;n.NotificationService.AutoFadeNotification("danger","",i)}})},n.prototype.reject=function(){var n=this,t;t=this.report.id==null?this.report.Id:this.report.id;this.$modal.open({templateUrl:"/App/Core/Views/Modals/ConfirmRejectReport.html",controller:"RejectReportModalInstanceController",backdrop:"static",resolve:{itemId:function(){return t}}}).result.then(function(i){var r=new n.VacationReport;n.loadingPromise=r.$reject({id:t,comment:i.Comment},function(){n.NotificationService.AutoFadeNotification("success","","Indberetningen blev afvist.");n.$modalInstance.close()})})},n.prototype.calculateBalance=function(n){var t=n.VacationHours+n.TransferredHours;this.vacationHours=Math.floor(t);this.vacationMinutes=Math.round((t-this.vacationHours)*60);this.freeVacationHours=Math.floor(n.FreeVacationHours);this.freeVacationMinutes=Math.round((n.FreeVacationHours-n.FreeVacationHours)*60)},n.prototype.calculatePayDeduction=function(){var n=!1,t;if(this.report.status==="Pending"){t=this.calculateTotalVacationHours();switch(this.report.type){case"Regular":n=t<this.vacationTime;break;case"SixthVacationWeek":n=t<this.vacationTime}}this.payDeduction=n?"Ja":"Nej"},n.prototype.calculateTotalVacationHours=function(){return this.vacationBalance.VacationHours+this.vacationBalance.TransferredHours},n.$inject=["$scope","$rootScope","VacationReport","NotificationService","VacationBalanceResource","moment","$state","$modalInstance","$modal","report"],n}();angular.module("app.vacation").controller("ShowVacationReportController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(n,t){var i=this;this.$http=n;this.VacationBalanceResource=t;this.isReady=!1;n.get("/odata/Person/Service.LeadersPeople(Type=1)").then(function(n){i.persons=n.data.value;angular.forEach(i.persons,function(n,t){i.getVacationBalance(n.Id,t)})})}return n.prototype.getVacationBalance=function(n,t){var i=this;this.VacationBalanceResource.forEmployee({id:n}).$promise.then(function(n){i.calculateBalance(n,t);t===i.persons.length-1&&(i.isReady=!0)})},n.prototype.calculateBalance=function(n,t){var i,u,r,f,e;n?(e=n.VacationHours+n.TransferredHours,i=Math.floor(e),u=Math.round((e-i)*60),r=Math.floor(n.FreeVacationHours),f=Math.round((n.FreeVacationHours-r)*60)):(i=0,u=0,r=0,f=0);this.persons[t].VacationBalance={vacationHours:i,vacationMinutes:u,freeVacationHours:r,freeVacationMinutes:f}},n.$inject=["$http","VacationBalanceResource"],n}();angular.module("app.vacation").controller("ApproveVacationBalanceController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(n,t,i,r,u,f,e,o){var s=this,h;this.$scope=n;this.$rootScope=t;this.VacationReport=i;this.NotificationService=r;this.$http=u;this.moment=f;this.$state=e;this.$modal=o;this.pendingVacations=[];this.readPendingVacations();h=this;this.schedulerOptions={workDayStart:new Date("2010-01-01 00:00:00"),workDayEnd:new Date("2010-01-01 23:59:59"),views:[{type:"timelineMonth",title:"Måned",minorTickCount:1,columnWidth:25,dateHeaderTemplate:function(n){var t=f(n.date),r=t.date(),u=t.format("W"),i="";return t.weekday()===0&&(i+='<span style="font-size:10px;">'+u+"<\/span>"),i+("<br>"+r)},workWeekStart:0,workWeekEnd:5},{type:"timelineWeek",title:"Uge",minorTickCount:6,columnWidth:40,majorTick:1440}],timezone:"Etc/UTC",save:function(n){n.preventDefault()},eventTemplate:kendo.template("<div class=\"schedule-vacation-template vacation-#= type.toLowerCase()#\"> # if (type == 'Care') { # O # } if (type == 'SixthVacationWeek') { # 6 # } if (type == 'Regular') { #  # } if (type == 'Senior') { # S # } if (type == 'Optional') { # V # } # <\/div>"),editable:{update:!0,move:!1,destroy:!1,resize:!1,confirmation:!1},edit:function(n){n.preventDefault();o.open({templateUrl:"/App/Vacation/ApproveVacation/ShowVacationReportView.html",controller:"ShowVacationReportController as svrc",backdrop:"static",resolve:{report:function(){return n.event}}}).result.then(function(){s.refresh()})},dataSource:{autoBind:!1,type:"odata-v4",batch:!0,transport:{read:{url:"/odata/VacationReports()?$expand=Person($select=FullName)&$filter=ResponsibleLeaderId eq "+this.$rootScope.CurrentUser.Id,dataType:"json",cache:!1}},serverFiltering:!0,schema:{data:function(n){var t=[];return angular.forEach(n.value,function(n){var r=n.StartTime==null,u=n.EndTime==null,i;r||(i=s.moment.duration(n.StartTime),n.StartTimestamp+=i.asSeconds());u?n.EndTimestamp+=86400:(i=s.moment.duration(n.EndTime),n.EndTimestamp+=i.asSeconds());switch(n.VacationType){case"Care":n.type="Omsorgsdage";break;case"Optional":n.type="Valgfri ferie";break;case"Regular":n.type="Almindelig Ferie";break;case"Senior":n.type="Seniordage";break;case"SixthVacationWeek":n.type="6. ferieuge";break;default:n.type="Andet"}t.push(n)}),t},model:{fields:{id:{type:"number",from:"Id"},title:{parse:function(){return""}},start:{type:"date",from:"StartTimestamp",parse:function(n){return h.moment.unix(n).toDate()}},end:{type:"date",from:"EndTimestamp",parse:function(n){return h.moment.unix(n).toDate()}},personId:{from:"PersonId"},description:{from:"Purpose"},status:{from:"Status"},type:{from:"VacationType"}}}}},group:{resources:["People"],orientation:"vertical"},resources:[{field:"status",dataSource:[{text:"Pending",value:"Pending",color:"#f1eb47"},{text:"Accepted",value:"Accepted",color:"#5cb85c"},{text:"Rejected",value:"Rejected",color:"#d9534f"}]},{field:"personId",name:"People",dataValueField:"Id",dataTextField:"FullName",dataSource:{type:"odata-v4",transport:{read:{url:"/odata/Person/Service.LeadersPeople(Type=1)",dataType:"json",cache:!1}}}}],footer:!1}}return n.prototype.readPendingVacations=function(){var n=this;this.$http.get("/odata/VacationReports()?status=Pending &$expand=Person($select=FullName)&$filter=ResponsibleLeaderId eq "+this.$rootScope.CurrentUser.Id).then(function(t){t.data.value.sort(function(n,t){return n.StartTimestamp>t.StartTimestamp?1:t.StartTimestamp>n.StartTimestamp?-1:0});n.pendingVacations=[];angular.forEach(t.data.value,function(t,i){var r=Number(t.StartTimestamp.toString()+"000"),u=Number(t.EndTimestamp.toString()+"000"),f=n.moment(r).format("DD.MM.YYYY"),e=n.moment(u).format("DD.MM.YYYY"),o={key:i,startTime:r,firstName:t.Person.FullName.split("[")[0],dateFrom:f,dateTo:e,reportdata:t};n.pendingVacations.push(o)})})},n.prototype.goToDate=function(n){var t=this,i=Number(n.startTime);this.scheduler.date(new Date(i));this.$modal.open({templateUrl:"/App/Vacation/ApproveVacation/ShowVacationReportView.html",controller:"ShowVacationReportController as svrc",backdrop:"static",resolve:{report:function(){return n.reportdata}}}).result.then(function(){t.refresh()})},n.prototype.refresh=function(){this.readPendingVacations();this.scheduler.dataSource.read()},n.$inject=["$scope","$rootScope","VacationReport","NotificationService","$http","moment","$state","$modal"],n}();angular.module("app.vacation").controller("ApproveVacationPendingController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(){"use strict";var t=n.core.controllers.BaseApproveReportsSettingsController,i=n.core.models.ReportType,r=function(n){function t(t,r,u,f,e,o){n.call(this,t,r,u,f,e,o,i.Vacation);this.$scope=t;this.Person=r;this.$rootScope=u;this.Autocomplete=f;this.$modal=e;this.moment=o}return __extends(t,n),t.$inject=["$scope","Person","$rootScope","Autocomplete","$modal","moment"],t}(t);angular.module("app.vacation").controller("ApproveVacationSettingsController",r)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(n){"use strict";var t=function(){function n(n,t,i,r,u,f,e,o,s){var h=this;this.$scope=n;this.$modal=t;this.$rootScope=i;this.VacationReport=r;this.$timeout=u;this.Person=f;this.moment=e;this.$state=o;this.NotificationService=s;this.vacationYears=[];this.isGridLoaded=!1;this.deleteClick=function(n){h.$modal.open({templateUrl:"/App/Vacation/MyVacationReports/ConfirmDeleteVacationReportTemplate.html",controller:"ConfirmDeleteVacationReportController as cdvrCtrl",backdrop:"static",resolve:{itemId:function(){return n}}}).result.then(function(){h.VacationReport.delete({id:n},function(){h.NotificationService.AutoFadeNotification("success","","Indberetningen blev slettet.");h.refreshGrid()},function(){h.NotificationService.AutoFadeNotification("error","","Fejl under sletning af indberetning.")})})};this.dateOptions={format:"yyyy",start:"decade",depth:"decade"};this.loadInitialDate();this.personId=i.CurrentUser.Id;this.$scope.$on("kendoRendered",function(){h.isGridLoaded||(h.isGridLoaded=!0,h.refreshGrid())})}return n.prototype.refreshGrid=function(){this.isGridLoaded&&(this.vacationReportsGrid.dataSource.transport.options.read.url=this.getVacationReportsUrl(),this.vacationReportsGrid.dataSource.read())},n.prototype.clearClicked=function(){this.loadInitialDate();this.refreshGrid()},n.prototype.loadInitialDate=function(){var t=this.moment(),i,r,n;for(this.moment().isBefore(t.year()+"-05-01")&&(t=t.subtract("year",1)),this.vacationYear=t.year(),i=Math.max(2016,this.vacationYear-5),r=this.vacationYear+5,n=i;n<r;n++)this.vacationYears.push({Year:n,YearString:n+"/"+(n+1)})},n}();n.BaseMyVacationReportsController=t})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(n,t,i){this.$modalInstance=n;this.itemId=t;this.NotificationService=i;this.itemId=t}return n.prototype.confirmDelete=function(){this.$modalInstance.close(this.itemId)},n.prototype.cancel=function(){this.$modalInstance.dismiss("cancel");this.NotificationService.AutoFadeNotification("warning","","Sletning af indberetningen blev annulleret.")},n.$inject=["$modalInstance","itemId","NotificationService"],n}();angular.module("app.vacation").controller("ConfirmDeleteVacationReportController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(){this.tabData=[{heading:"Afventer",route:"vacation.myreports.pending"},{heading:"Godkendte",route:"vacation.myreports.approved"},{heading:"Afviste",route:"vacation.myreports.rejected"}]}return n.$inject=[],n}();angular.module("app.vacation").controller("MyVacationReportsController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(n){"use strict";var t=function(n){function t(t,i,r,u,f,e,o,s,h){var c=this;n.call(this,t,i,r,u,f,e,o,s,h);this.$scope=t;this.$modal=i;this.$rootScope=r;this.VacationReport=u;this.$timeout=f;this.Person=e;this.moment=o;this.$state=s;this.NotificationService=h;this.vacationReportsOptions={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:this.getVacationReportsUrl(),dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"StartTimestamp",dir:"desc"}},pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{title:"Feriestart",template:function(n){var t=c.moment.unix(n.StartTimestamp);return t.format("L")}},{title:"Ferieafslutning",template:function(n){var t=c.moment.unix(n.EndTimestamp);return t.format("L")}},{template:function(n){return n.Purpose!=""?"<button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.Purpose+'\'" class="transparent-background pull-right no-border">\n                                        <i class="fa fa-comment-o"><\/i><\/button>':"<i>Ingen bemærkning angivet<\/i>"},title:"Bemærkning"},{title:"Fraværsårsag",template:function(n){switch(n.VacationType){case"Care":return"Omsorgsdage";case"Optional":return n.OptionalText!=""?"Andet fravær <button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.OptionalText+'\'" class="transparent-background pull-right no-border">\n                                        <i class="fa fa-comment-o"><\/i><\/button>':"Andet fravær";case"Regular":return"Almindelig Ferie";case"Senior":return"Seniordage";case"SixthVacationWeek":return"6. ferieuge";default:return"Andet"}}},{field:"CreatedDateTimestamp",template:function(n){var t=c.moment.unix(n.CreatedDateTimestamp);return t.format("L")},title:"Indberettet"},{field:"ClosedDateTimestamp",title:"Godkendelsesdato",template:function(n){var t=c.moment.unix(n.ClosedDateTimestamp);return t.format("L")}},{field:"ProcessedDateTimestamp",title:"Afsendt til løn",template:function(n){if(n.ProcessedDateTimestamp!=0&&n.ProcessedDateTimestamp!=null&&n.ProcessedDateTimestamp!=undefined){var t=c.moment.unix(n.ProcessedDateTimestamp);return t.format("L")}return""}},{field:"ApprovedBy.FullName",title:"Godkendt af"},{field:"Id",template:function(n){return'<a ng-click="mvrCtrl.deleteClick('+n.Id+')">Slet<\/a> | <a ui-sref=".edit({vacationReportId:'+n.Id+'})">Rediger<\/a>'},title:"Muligheder"}],scrollable:!1}}return __extends(t,n),t.prototype.getVacationReportsUrl=function(){return"/odata/VacationReports?status=Accepted&$expand=ResponsibleLeader,ApprovedBy &$filter=PersonId eq "+this.personId+" and VacationYear eq "+this.vacationYear},t.$inject=["$scope","$modal","$rootScope","VacationReport","$timeout","Person","moment","$state","NotificationService"],t}(n.BaseMyVacationReportsController);angular.module("app.vacation").controller("MyApprovedVacationReportsController",t)})(t=n.vacation||(n.vacation={}))}(app||(app={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(n){"use strict";var t=function(n){function t(t,i,r,u,f,e,o,s,h){var c=this;n.call(this,t,i,r,u,f,e,o,s,h);this.$scope=t;this.$modal=i;this.$rootScope=r;this.VacationReport=u;this.$timeout=f;this.Person=e;this.moment=o;this.$state=s;this.NotificationService=h;this.vacationReportsOptions={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:this.getVacationReportsUrl(),dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"StartTimestamp",dir:"desc"}},pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{title:"Feriestart",template:function(n){var t=c.moment.unix(n.StartTimestamp);return t.format("L")}},{title:"Ferieafslutning",template:function(n){var t=c.moment.unix(n.EndTimestamp);return t.format("L")}},{template:function(n){return n.Purpose!=""?"<button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.Purpose+'\'" class="transparent-background pull-right no-border"><i class="fa fa-comment-o"><\/i><\/button>':"<i>Ingen bemærkning angivet<\/i>"},title:"Bemærkning"},{title:"Fraværsårsag",template:function(n){switch(n.VacationType){case"Care":return"Omsorgsdage";case"Optional":return n.OptionalText!=""?"Andet fravær <button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.OptionalText+'\'" class="transparent-background pull-right no-border">\n                                        <i class="fa fa-comment-o"><\/i><\/button>':"Andet fravær";case"Regular":return"Almindelig Ferie";case"Senior":return"Seniordage";case"SixthVacationWeek":return"6. ferieuge";default:return"Andet"}}},{field:"CreatedDateTimestamp",template:function(n){var t=c.moment.unix(n.CreatedDateTimestamp);return t.format("L")},title:"Indberettet"},{title:"Godkender",field:"ResponsibleLeader.FullName",template:function(n){return n.ResponsibleLeader!=0&&n.ResponsibleLeader!=null&&n.ResponsibleLeader!=undefined?n.ResponsibleLeader.FullName:""}},{field:"Id",template:function(n){return'<a ng-click="mvrCtrl.deleteClick('+n.Id+')">Slet<\/a> | <a ui-sref=".edit({vacationReportId:'+n.Id+'})">Rediger<\/a>'},title:"Muligheder"}],scrollable:!1}}return __extends(t,n),t.prototype.getVacationReportsUrl=function(){return"/odata/VacationReports?status=Pending&$expand=ResponsibleLeader &$filter=PersonId eq "+this.personId+" and VacationYear eq "+this.vacationYear},t.$inject=["$scope","$modal","$rootScope","VacationReport","$timeout","Person","moment","$state","NotificationService"],t}(n.BaseMyVacationReportsController);angular.module("app.vacation").controller("MyPendingVacationReportsController",t)})(t=n.vacation||(n.vacation={}))}(app||(app={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(n){"use strict";var t=function(n){function t(t,i,r,u,f,e,o,s,h){var c=this;n.call(this,t,i,r,u,f,e,o,s,h);this.$scope=t;this.$modal=i;this.$rootScope=r;this.VacationReport=u;this.$timeout=f;this.Person=e;this.moment=o;this.$state=s;this.NotificationService=h;this.vacationReportsOptions={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:this.getVacationReportsUrl(),dataType:"json",cache:!1}},pageSize:20,serverPaging:!0,serverAggregates:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"StartTimestamp",dir:"desc"}},pageable:{messages:{display:"{0} - {1} af {2} indberetninger",empty:"Ingen indberetninger at vise",page:"Side",of:"af {0}",itemsPerPage:"indberetninger pr. side",first:"Gå til første side",previous:"Gå til forrige side",next:"Gå til næste side",last:"Gå til sidste side",refresh:"Genopfrisk"},pageSizes:[5,10,20,30,40,50,100,150,200]},dataBound:function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},columns:[{title:"Feriestart",template:function(n){var t=c.moment.unix(n.StartTimestamp);return t.format("L")}},{title:"Ferieafslutning",template:function(n){var t=c.moment.unix(n.EndTimestamp);return t.format("L")}},{template:function(n){return n.Purpose!=""?"<button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.Purpose+'\'" class="transparent-background pull-right no-border"><i class="fa fa-comment-o"><\/i><\/button>':"<i>Ingen bemærkning angivet<\/i>"},title:"Bemærkning"},{title:"Fraværsårsag",template:function(n){switch(n.VacationType){case"Care":return"Omsorgsdage";case"Optional":return n.OptionalText!=""?"Andet fravær <button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.OptionalText+'\'" class="transparent-background pull-right no-border">\n                                        <i class="fa fa-comment-o"><\/i><\/button>':"Andet fravær";case"Regular":return"Almindelig Ferie";case"Senior":return"Seniordage";case"SixthVacationWeek":return"6. ferieuge";default:return"Andet"}}},{field:"CreatedDateTimestamp",template:function(n){var t=c.moment.unix(n.CreatedDateTimestamp);return t.format("L")},title:"Indberettet"},{field:"Comment",title:"Begrundelse",template:function(n){return n.Comment!=""?"<button kendo-tooltip k-position=\"'right'\" k-content=\"'"+n.Comment+'\'" class="transparent-background pull-right no-border"><i class="fa fa-comment-o"><\/i><\/button>':"<i>Ingen begrundelse angivet<\/i>"}},{field:"ClosedDateTimestamp",title:"Afvist dato",template:function(n){var t=o.unix(n.ClosedDateTimestamp);return t.format("L")}},{field:"ApprovedBy.FullName",title:"Afvist af",template:function(n){return n.ApprovedBy.FullName}}],scrollable:!1}}return __extends(t,n),t.prototype.getVacationReportsUrl=function(){return"/odata/VacationReports?status=Rejected&$expand=ApprovedBy($select=FullName) &$filter=PersonId eq "+this.personId+" and VacationYear eq "+this.vacationYear},t.$inject=["$scope","$modal","$rootScope","VacationReport","$timeout","Person","moment","$state","NotificationService"],t}(n.BaseMyVacationReportsController);angular.module("app.vacation").controller("MyRejectedVacationReportsController",t)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(){"use strict";var n=function(){function n(n,t,i,r,u,f,e,o){var s=this,h;this.$scope=n;this.$rootScope=t;this.VacationReport=i;this.NotificationService=r;this.$http=u;this.moment=f;this.$state=e;this.$modal=o;this.pendingVacations=[];this.currentUser=n.CurrentUser;this.employments=[];angular.forEach(this.currentUser.Employments,function(n){n.PresentationString=n.Position+" - "+n.OrgUnit.LongDescription+" ("+n.EmploymentId+")";n.OrgUnit.HasAccessToVacation&&s.employments.push(n)});this.chosenEmployment=this.employments[0];h=this;this.schedulerOptions={workDayStart:new Date("2010-01-01 00:00:00"),workDayEnd:new Date("2010-01-01 23:59:59"),views:[{type:"timelineMonth",title:"Måned",minorTickCount:1,columnWidth:25,dateHeaderTemplate:function(n){var t=f(n.date),r=t.date(),u=t.format("W"),i="";return t.weekday()===0&&(i+='<span style="font-size:10px;">'+u+"<\/span>"),i+("<br>"+r)}},{type:"timelineWeek",title:"Uge",minorTickCount:6,columnWidth:40,majorTick:1440}],timezone:"Etc/UTC",save:function(n){n.preventDefault()},eventTemplate:kendo.template("<div class=\"schedule-vacation-template vacation-#= type.toLowerCase()#\"> # if (type == 'Care') { # O # } if (type == 'SixthVacationWeek') { # 6 # } if (type == 'Regular') { #  # } if (type == 'Senior') { # S # } if (type == 'Optional') { # V # } # <\/div>"),editable:{update:!0,move:!1,destroy:!1,resize:!1,confirmation:!1},edit:function(n){n.preventDefault()},dataSource:{autoBind:!1,type:"odata-v4",batch:!0,transport:{read:{url:"/odata/VacationReports()?$expand=Person($select=FullName)&$filter=Person/Employments/any(e:e/OrgUnitId eq "+this.chosenEmployment.OrgUnit.Id+")",dataType:"json",cache:!1}},serverFiltering:!0,schema:{data:function(n){var t=[];return angular.forEach(n.value,function(n){var r=n.StartTime==null,u=n.EndTime==null,i;r||(i=s.moment.duration(n.StartTime),n.StartTimestamp+=i.asSeconds());u?n.EndTimestamp+=86400:(i=s.moment.duration(n.EndTime),n.EndTimestamp+=i.asSeconds());switch(n.VacationType){case"Care":n.type="Omsorgsdag";break;case"Optional":n.type="Valgfri ferie";break;case"Regular":n.type="Almindelig Ferie";break;case"Senior":n.type="Seniordag";break;case"SixthVacationWeek":n.type="6. ferieuge";break;default:n.type="Andet"}n.Status!="Rejected"&&t.push(n)}),t},model:{fields:{id:{type:"number",from:"Id"},title:{parse:function(){return""}},start:{type:"date",from:"StartTimestamp",parse:function(n){return h.moment.unix(n).toDate()}},end:{type:"date",from:"EndTimestamp",parse:function(n){return h.moment.unix(n).toDate()}},personId:{from:"PersonId"},description:{from:"Purpose"},status:{from:"Status"},type:{from:"VacationType"}}}}},group:{resources:["People"],orientation:"vertical"},resources:[{field:"status",dataSource:[{text:"Pending",value:"Pending",color:"#f1eb47"},{text:"Accepted",value:"Accepted",color:"#5cb85c"},{text:"Rejected",value:"Rejected",color:"#d9534f"}]},{field:"personId",name:"People",dataValueField:"Id",dataTextField:"FullName",dataSource:{type:"odata-v4",transport:{read:{url:"/odata/Person/Service.PeopleInMyOrganisation(Id="+this.chosenEmployment.Id+")",dataType:"json",cache:!1}}}}],footer:!1}}return n.prototype.goToDate=function(n){n=Number(n);this.scheduler.date(new Date(n))},n.prototype.refresh=function(){this.scheduler.dataSource.read()},n.$inject=["$scope","$rootScope","VacationReport","NotificationService","$http","moment","$state","$modal"],n}();angular.module("app.vacation").controller("VacationOverviewController",n)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(n){"use strict";var t=function(){function n(n,t,i,r,u,f,e){var o=this;this.$scope=n;this.Person=t;this.$rootScope=i;this.VacationReport=r;this.NotificationService=u;this.VacationBalanceResource=f;this.moment=e;this.vacationStartsOnFullDay=!0;this.vacationEndsOnFullDay=!0;this.mimimumVacationStartDate=new Date(2016,4,1);this.saveButtenDisabled=!0;this.isEditingVacation=!1;this.startWeeks=[];this.endWeeks=[];this.children=[];this.timePickerOptions={format:"HH:mm",value:new Date(2e3,0,1,0,0,0,0)};this.currentUser=n.CurrentUser;f.query().$promise.then(function(n){o.vacationBalances=n;o.calculateBalance();o.vacationBalances.length>0?(o.positionUpdated(),o.hasVacationBalance=!0):o.hasVacationBalance=!1});this.startCalendarOptions={month:{empty:'<a class="k-link disable-k-link"><\/a>'},navigate:function(n){var t=n.sender.current();t!=undefined&&(o.startWeeks=o.updateWeeks(t),o.$scope.$apply())}};this.endCalendarOptions={month:{empty:'<span class="calendar-week-empty"> <\/span>'},navigate:function(n){var t=n.sender.current();t!=undefined&&(o.endWeeks=o.updateWeeks(t),o.$scope.$apply())}};this.vacationDaysInPeriod=0;this.$scope.$watch(function(){return o.startDate},function(){o.updateCalendarRange()});this.employments=[];angular.forEach(this.currentUser.Employments,function(n){n.PresentationString=n.Position+" - "+n.OrgUnit.LongDescription+" ("+n.EmploymentId+")";n.OrgUnit.HasAccessToVacation&&o.employments.push(n)})}return n.prototype.updateWeeks=function(n){var u=moment(n),i=u.clone().startOf("month"),r=i.clone().day(0),t=[];for((i.isoWeekday()===7||i.isoWeekday()===1)&&t.push(r.isoWeek());t.length<6;)r.add(7,"d"),t.push(r.isoWeek());return t},n.prototype.sameMonth=function(n,t,i){return n.month()!==t.month()?i:n.date()},n.prototype.GetChildFromId=function(n){for(var i=this.children.length,t=0;t<i;t++)if(this.children[t].Id==n)return this.children[t];return null},n.prototype.updateCalendarRange=function(){this.startDate>this.endDate&&(this.endDate=this.startDate)},n.prototype.positionUpdated=function(){var u=this,r=this.position,n=this.vacationBalances,t,i;for(t in n)n.hasOwnProperty(t)&&(i=n[t],i.EmploymentId==r&&(this.vacationBalance=i));this.Person.GetChildren({id:r}).$promise.then(function(n){u.children=n})},n.prototype.childUpdated=function(){},n.prototype.clearReport=function(){this.initializeReport()},n.prototype.calculateBalance=function(){var n=this.vacationBalances[0].VacationHours+this.vacationBalances[0].TransferredHours;this.vacationHours=Math.floor(n);this.vacationMinutes=Math.round((n-this.vacationHours)*60);this.freeVacationHours=Math.floor(this.vacationBalances[0].FreeVacationHours);this.freeVacationMinutes=Math.round((this.vacationBalances[0].FreeVacationHours-this.freeVacationHours)*60)},n}();n.BaseReportVacationController=t})(t=n.vacation||(n.vacation={}))}(app||(app={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(n){"use strict";var t=function(n){function t(t,i,r,u,f,e,o){n.call(this,t,i,r,u,f,e,o);this.$scope=t;this.Person=i;this.$rootScope=r;this.VacationReport=u;this.NotificationService=f;this.VacationBalanceResource=e;this.moment=o;this.initializeReport()}return __extends(t,n),t.prototype.initializeReport=function(){this.startDate=new Date;this.endDate=new Date;this.maxEndDate=new Date;this.purpose=undefined;this.careCpr=undefined;this.optionalText=undefined;this.vacationStartsOnFullDay=!0;this.vacationEndsOnFullDay=!0;this.startTime;this.endTime;this.vacationType=undefined},t.prototype.changefullday=function(){this.vacationEndsOnFullDay=!this.vacationEndsOnFullDay},t.prototype.saveReport=function(){var t=this,n,i;if(!this.vacationEndsOnFullDay&&(this.endTime==null||this.startTime==null)){this.NotificationService.AutoFadeNotification("danger","","Du skal vælge både et start- og et sluttidspunkt");return}if(this.startDate.getDate()==this.endDate.getDate()&&this.endTime<this.startTime){this.NotificationService.AutoFadeNotification("danger","","Sluttidspunkt må ikke være før starttidspunkt");return}n=new this.VacationReport;n.StartTimestamp=this.moment(this.startDate).unix();n.EndTimestamp=this.moment(this.endDate).unix();n.EmploymentId=this.position;n.Purpose=this.purpose;n.PersonId=this.currentUser.Id;n.Status="Pending";n.CreatedDateTimestamp=Math.floor(Date.now()/1e3);n.VacationType=this.vacationType;n.OptionalText=this.optionalText;this.vacationType=="Care"&&(i=this.GetChildFromId(this.child),n.AdditionalData=String(i.Id),n.OptionalText=i.FullName);n.StartTime=this.vacationStartsOnFullDay?null:"P0DT"+this.startTime.getHours()+"H"+this.startTime.getMinutes()+"M0S";n.EndTime=this.vacationEndsOnFullDay?null:"P0DT"+this.endTime.getHours()+"H"+this.endTime.getMinutes()+"M0S";n.$save(function(){t.NotificationService.AutoFadeNotification("success","","Din indberetning er sendt til godkendelse.");t.clearReport();t.saveButtenDisabled=!1},function(){t.saveButtenDisabled=!1;t.NotificationService.AutoFadeNotification("danger","","Der opstod en fejl under oprettelsen af din ferieindberetning (Holder du allerede ferie i den valgte periode?).")})},t.$inject=["$scope","Person","$rootScope","VacationReport","NotificationService","VacationBalanceResource","moment"],t}(n.BaseReportVacationController);angular.module("app.vacation").controller("CreateReportVacationController",t)})(t=n.vacation||(n.vacation={}))}(app||(app={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(n){"use strict";var t=function(n){function t(t,i,r,u,f,e,o,s,h,c){n.call(this,t,i,r,u,f,e,o);this.$scope=t;this.Person=i;this.$rootScope=r;this.VacationReport=u;this.NotificationService=f;this.VacationBalanceResource=e;this.moment=o;this.$modal=s;this.$modalInstance=h;this.vacationReportId=c;this.initializeReport();this.isEditingReport=!0}return __extends(t,n),t.prototype.initializeReport=function(){var n=this,t=this.VacationReport.get({id:this.vacationReportId},function(){var i,r;n.startDate=n.moment.utc(t.StartTimestamp,"X").toDate();n.endDate=n.moment.utc(t.EndTimestamp,"X").toDate();n.vacationStartsOnFullDay=t.StartTime==null;n.vacationEndsOnFullDay=t.EndTime==null;n.vacationStartsOnFullDay||(i=new Date,r=n.moment.duration(t.StartTime),i.setHours(r.hours()),i.setMinutes(r.minutes()),n.startTime=i);n.vacationEndsOnFullDay||(i=new Date,r=n.moment.duration(t.EndTime),i.setHours(r.hours()),i.setMinutes(r.minutes()),n.endTime=i);n.purpose=t.Purpose;n.optionalText=t.OptionalText;n.vacationType=t.VacationType;n.position=t.EmploymentId;t.VacationType=="Care"&&(n.child=t.AdditionalData)})},t.prototype.saveReport=function(){var t=this,n=new this.VacationReport,i;n.StartTimestamp=this.moment(this.startDate).unix();n.EndTimestamp=this.moment(this.endDate).unix();n.EmploymentId=this.position;n.Purpose=this.purpose;n.OptionalText=this.optionalText;n.PersonId=this.currentUser.Id;n.Status="Pending";n.CreatedDateTimestamp=Math.floor(Date.now()/1e3);n.VacationType=this.vacationType;this.vacationType=="Care"&&(i=this.GetChildFromId(this.child),n.AdditionalData=String(i.Id),n.OptionalText=i.FullName);n.StartTime=this.vacationStartsOnFullDay?null:"P0DT"+this.startTime.getHours()+"H"+this.startTime.getMinutes()+"M0S";n.EndTime=this.vacationEndsOnFullDay?null:"P0DT"+this.endTime.getHours()+"H"+this.endTime.getMinutes()+"M0S";n.Id=this.vacationReportId;n.$update({id:this.vacationReportId},function(){t.NotificationService.AutoFadeNotification("success","","Din indberetning er blevet rédigeret.");t.$modalInstance.close()},function(){t.saveButtenDisabled=!1;t.NotificationService.AutoFadeNotification("danger","","Der opstod en fejl under rédigering af din ferieindberetning (Holder du allerede ferie i den valgte periode?).")})},t.prototype.closeModalWindow=function(){this.$modalInstance.dismiss()},t.$inject=["$scope","Person","$rootScope","VacationReport","NotificationService","VacationBalanceResource","moment","$modal","$modalInstance","vacationReportId"],t}(n.BaseReportVacationController);angular.module("app.vacation").controller("EditReportVacationController",t)})(t=n.vacation||(n.vacation={}))}(app||(app={})),function(n){var t;(function(n){var t;(function(){angular.module("app.vacation").factory("VacationBalanceResource",["$resource",function(n){var t={method:"GET",isArray:!0,transformResponse:function(n){return angular.fromJson(n).value}},i={method:"GET",isArray:!0,transformResponse:function(n){return angular.fromJson(n).value}},r={method:"GET",url:"/odata/VacationBalance/Service.VacationForEmployment(Id=:id)",isArray:!1,transformResponse:function(n){return angular.fromJson(n)}},u={method:"GET",url:"/odata/VacationBalance/Service.VacationForEmployee(Id=:id)",isArray:!1,transformResponse:function(n){return angular.fromJson(n)}};return n("/odata/VacationBalance(:id)?:query",{id:"@id",query:"@query"},{get:t,query:i,forEmployment:r,forEmployee:u})}])})(t=n.resources||(n.resources={}))})(t=n.vacation||(n.vacation={}))}(app||(app={}));angular.module("app.vacation").service("VacationReport",["$resource",function(n){return n("/odata/VacationReports(:id)?:query&emailText=:emailText",{id:"@id",query:"@query",emailText:"@emailText"},{get:{method:"GET",isArray:!1,transformResponse:function(n){return angular.fromJson(n).value[0]}},create:{method:"POST",isArray:!1},approve:{method:"GET",isArray:!1,url:"/odata/VacationReports/Service.ApproveReport(Key=:id)"},reject:{method:"GET",isArray:!1,url:"/odata/VacationReports/Service.RejectReport(Key=:id)?comment=:comment"},update:{method:"PUT",isArray:!1},getLatest:{method:"GET",isArray:!1,url:"/odata/VacationReports/Service.GetLatestReportForUser?personId=:id",transformResponse:function(n){return angular.fromJson(n)}}})}]);